<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Open CASCADE Technology: Upgrade from older OCCT versions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Open CASCADE Technology"/>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="occ_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Open CASCADE Technology
   &#160;<span id="projectnumber">7.8.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.php" method="get">
              <img id="MSearchSelect" src="search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('occt__upgrade.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Upgrade from older OCCT versions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#upgrade_intro">Introduction</a><ul><li class="level2"><a href="#upgrade_intro_precautions">Precautions</a></li>
<li class="level2"><a href="#upgrade_intro_disclaim">Disclaimer</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_65">Upgrade to OCCT 6.5.0</a></li>
<li class="level1"><a href="#upgrade_651">Upgrade to OCCT 6.5.1</a></li>
<li class="level1"><a href="#upgrade_652">Upgrade to OCCT 6.5.2</a></li>
<li class="level1"><a href="#upgrade_653">Upgrade to OCCT 6.5.3</a></li>
<li class="level1"><a href="#upgrade_654">Upgrade to OCCT 6.5.4</a></li>
<li class="level1"><a href="#upgrade_660">Upgrade to OCCT 6.6.0</a></li>
<li class="level1"><a href="#upgrade_670">Upgrade to OCCT 6.7.0</a><ul><li class="level2"><a href="#upgrade_670_clipping">Object-level clipping and capping algorithm.</a></li>
<li class="level2"><a href="#upgrade_670_markers">Redesign of markers presentation</a></li>
<li class="level2"><a href="#upgrade_670_views">Default views are not created automatically</a></li>
<li class="level2"><a href="#upgrade_670_dimensions">Improved dimensions implementation</a></li>
<li class="level2"><a href="#upgrade_670_list_collection">NCollection_Set replaced by List collection</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_680">Upgrade to OCCT 6.8.0</a><ul><li class="level2"><a href="#upgrade_680_ncollection">Changes in NCollection classes</a></li>
<li class="level2"><a href="#upgrade_680_view_camera">3D View Camera</a></li>
<li class="level2"><a href="#upgrade_680_connected_objects">Redesign of Connected Interactive Objects</a></li>
<li class="level2"><a href="#upgrade_680_unicode">Support of UNICODE Characters</a></li>
<li class="level2"><a href="#upgrade_680_projection_shift">Elimination of Projection Shift Concept</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_690">Upgrade to OCCT 6.9.0</a><ul><li class="level2"><a href="#upgrade_690_shaders">3D Viewer initialization</a></li>
<li class="level2"><a href="#upgrade_690_selection">Changes in Selection</a><ul><li class="level3"><a href="#autotoc_md34">Standard selection</a></li>
<li class="level3"><a href="#autotoc_md35">Custom sensitive entities</a></li>
</ul>
</li>
<li class="level2"><a href="#upgrade_690_adaptor3d-curve">Changes in Adaptor3d_Curve class</a></li>
<li class="level2"><a href="#upgrade_690_v3d_view">Changes in V3d_View class</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_700">Upgrade to OCCT 7.0.0</a><ul><li class="level2"><a href="#upgrade_700_persist">Removal of legacy persistence</a><ul><li class="level3"><a href="#autotoc_md36">CSFDB files</a></li>
<li class="level3"><a href="#autotoc_md37">OCAF and XCAF documents</a></li>
</ul>
</li>
<li class="level2"><a href="#upgrade_occt700_cdl">Removal of CDL and WOK</a><ul><li class="level3"><a href="#upgrade_occt700_cdl_auto">Automatic upgrade</a></li>
<li class="level3"><a href="#upgrade_occt700_cdl_compiler">Possible compiler errors</a></li>
<li class="level3"><a href="#autotoc_md38">Missing header files</a></li>
<li class="level3"><a href="#autotoc_md39">Ambiguity of calls to overloaded functions</a></li>
<li class="level3"><a href="#autotoc_md40">Lack of implicit cast to base type</a></li>
<li class="level3"><a href="#autotoc_md41">Incorrect use of STANDARD_TYPE and Handle macros</a></li>
<li class="level3"><a href="#autotoc_md42">Use of class Standard_AncestorIterator</a></li>
<li class="level3"><a href="#autotoc_md43">Absence of cast to Standard_Transient*</a></li>
<li class="level3"><a href="#autotoc_md44">Method DownCast for non-base types</a></li>
<li class="level3"><a href="#upgrade_occt700_cdl_runtime">Possible runtime problems</a></li>
<li class="level3"><a href="#autotoc_md45">References to temporary objects</a></li>
<li class="level3"><a href="#upgrade_occt700_cdl_nocast">Option to avoid cast of handle to reference to base type</a></li>
<li class="level3"><a href="#upgrade_occt700_cdl_compat">Preserving compatibility with OCCT 6.x</a></li>
<li class="level3"><a href="#upgrade_occt700_cdl_wok">Applications based on CDL and WOK</a></li>
</ul>
</li>
<li class="level2"><a href="#upgrade_occt700_bspline">Separation of BSpline cache</a></li>
<li class="level2"><a href="#upgrade_occt700_booleanresult">Structural result of Boolean operations</a></li>
<li class="level2"><a href="#upgrade_occt700_brepextrema">BRepExtrema_ExtCC finds one solution only</a></li>
<li class="level2"><a href="#upgrade_occt700_sorttools">Removal of SortTools package</a></li>
<li class="level2"><a href="#upgrade_occt700_2dlayers">On-screen objects and ColorScale</a></li>
<li class="level2"><a href="#upgrade_occt700_userdraw">UserDraw and Visual3d</a><ul><li class="level3"><a href="#autotoc_md46">Visual3d package</a></li>
<li class="level3"><a href="#autotoc_md47">Custom OpenGL rendering and UserDraw</a></li>
</ul>
</li>
<li class="level2"><a href="#upgrade_occt700_localcontext">Deprecation of Local Context</a></li>
<li class="level2"><a href="#upgrade_occt700_separate_caf_visualisation">Separation of visualization part from TKCAF</a></li>
<li class="level2"><a href="#upgrade_euler_angles">Correction of interpretation of Euler angles in gp_Quaternion</a></li>
<li class="level2"><a href="#upgrade_zoom_persistent_selection">Zoom Persistent Selection</a></li>
<li class="level2"><a href="#upgrade_occt700_correction_of_texture">Texture mapping of objects</a></li>
<li class="level2"><a href="#upgrade_occt700_wfshape">Shape presentation builders</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_occt710">Upgrade to OCCT 7.1.0</a><ul><li class="level2"><a href="#upgrade_710_aspects">Presentation attributes</a></li>
<li class="level2"><a href="#upgrade_710_types">Typedefs</a></li>
<li class="level2"><a href="#upgrade_710_ffp">Programmable Pipeline</a></li>
<li class="level2"><a href="#upgrade_710_trsfpers">Transformation persistence</a></li>
<li class="level2"><a href="#upgrade_710_selprops">Dynamic highlight and selection properties</a></li>
<li class="level2"><a href="#upgrade_occt710_correction_of_TObj_Model">Correction in TObj_Model class</a></li>
<li class="level2"><a href="#upgrade_710_env">Redundant environment variables</a></li>
<li class="level2"><a href="#upgrade_710_removed">Removed features</a></li>
<li class="level2"><a href="#upgrade_710_changed_methods">Other changes</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_occt720">Upgrade to OCCT 7.2.0</a><ul><li class="level2"><a href="#upgrade_720_removed">Removed features</a></li>
<li class="level2"><a href="#upgrade_occt720_reshape_oriented_removed">Corrections in BRepOffset API</a></li>
<li class="level2"><a href="#upgrade_occt720_correction_of_Offset_API">Corrections in BRepOffset API</a></li>
<li class="level2"><a href="#upgrade_720_highlight">Highlight style</a></li>
<li class="level2"><a href="#upgrade_720_implicit_viewer_update">Elimination of implicit 3D Viewer updates</a></li>
<li class="level2"><a href="#upgrade_720_v3d_colorname">Elimination of Quantity_NameOfColor from TKV3d interface classes</a></li>
<li class="level2"><a href="#upgrade_720_Result_Of_BOP_On_Containers">Result of Boolean operations on containers</a></li>
<li class="level2"><a href="#upgrade_720_changes_methods">Other changes</a></li>
<li class="level2"><a href="#upgrade_720_BOP_DataStructure">BOP - Pairs of interfering indices</a></li>
<li class="level2"><a href="#upgrade_720_Removal_Of_Old_Boolean_Operations_Draw">Removal of the Draw commands based on old Boolean operations</a></li>
<li class="level2"><a href="#upgrade_720_Change_Of_FaceFace_Intersection">Change of Face/Face intersection in Boolean operations</a></li>
<li class="level2"><a href="#upgrade_720_persistence">Restore OCCT 6.9.1 persistence</a></li>
<li class="level2"><a href="#upgrade_720_Change_In_BRepLib_MakeFace_Algo">Change in BRepLib_MakeFace algorithm</a></li>
<li class="level2"><a href="#upgrade_720_Change_In_BRepFill_OffsetWire">Change in BRepFill_OffsetWire algorithm</a></li>
<li class="level2"><a href="#upgrade_720_Change_In_GeomAdaptor_Curve">Change in Geom(2d)Adaptor_Curve::IsPeriodic</a></li>
<li class="level2"><a href="#upgrade_720_UnifySameDomain">Change in algorithm ShapeUpgrade_UnifySameDomain</a></li>
<li class="level2"><a href="#upgrade_720_Change_In_RWStl">Changes in STL Reader / Writer</a></li>
<li class="level2"><a href="#upgrade_720_New_Error_Warning_system_in_BOA">Refactoring of the Error/Warning reporting system in Boolean Component</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_occt721">Upgrade to OCCT 7.2.1</a><ul><li class="level2"><a href="#upgrade_721_Changes_In_USD">Changes in ShapeUpgrade_UnifySameDomain</a></li>
<li class="level2"><a href="#upgrade_721_Move_BuildPCurveForEdgeOnPlane">Moving BuildPCurveForEdgeOnPlane from BOPTools_AlgoTools2D to BRepLib</a></li>
<li class="level2"><a href="#upgrade_721_removed">Removed features</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_occt730">Upgrade to OCCT 7.3.0</a><ul><li class="level2"><a href="#upgrade_730_lights">Light sources</a></li>
<li class="level2"><a href="#upgrade_730_shadingmodels">Shading Models</a></li>
<li class="level2"><a href="#upgrade_730_tkopengl">Custom low-level OpenGL elements</a></li>
<li class="level2"><a href="#upgrade_730_BOPAlgo_Section">Changes in BOPAlgo_Section</a></li>
<li class="level2"><a href="#upgrade_730_BRepAdaptor_CompCurve">Changes in BRepAdaptor_CompCurve</a></li>
<li class="level2"><a href="#upgrade_730_removed">Removed features</a></li>
<li class="level2"><a href="#upgrade_730_BuilderSolid">Boolean Operations - Solid Builder algorithm</a></li>
<li class="level2"><a href="#upgrade_730_BRepAlgoBO">Boolean Operation classes in BRepAlgo are deprecated</a></li>
<li class="level2"><a href="#upgrade_730_replace_CDM_MessageDriver_interface_by_Message_Messenger">Unification of the Error/Warning reporting system of Application Framework</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_occt740">Upgrade to OCCT 7.4.0</a><ul><li class="level2"><a href="#upgrade_740_BRepPrimAPI_MakeRevol">Changes in BRepPrimAPI_MakeRevol algorithm</a></li>
<li class="level2"><a href="#upgrade_740_removed">Removed features</a></li>
<li class="level2"><a href="#upgrade_740_localcontext">Local Context removal</a></li>
<li class="level2"><a href="#upgrade_740_geomconvert">Changes in behavior of Convert algorithms</a></li>
<li class="level2"><a href="#upgrade_740_selection">Changes in selection API and picked point calculation algorithm.</a></li>
<li class="level2"><a href="#upgrade_740_ocafpersistence">Document format version management improvement.</a></li>
<li class="level2"><a href="#upgrade_740_changed_api_of_brepmesh">BRepMesh - revision of the data model</a></li>
<li class="level2"><a href="#upgrade_740_chamfer">Changes in API of Chamfer algorithms</a></li>
<li class="level2"><a href="#upgrade_740_aspects">Aspects unification</a></li>
<li class="level2"><a href="#upgrade_740_materials">Material definition</a></li>
<li class="level2"><a href="#upgrade_740_text">Changes in Graphic3d_Text and OpenGl_Text API</a></li>
<li class="level2"><a href="#upgrade_740_prsupdate">Presentation invalidation</a></li>
<li class="level2"><a href="#upgrade_740_interiorstyles">Interior styles</a></li>
<li class="level2"><a href="#upgrade_740_modedprs">PrsMgr and SelectMgr hierarchy clean up</a></li>
<li class="level2"><a href="#upgrade_740_offset">Polygon offset defaults</a></li>
<li class="level2"><a href="#upgrade_740_zlayer">Adding ZLayers in given position</a></li>
<li class="level2"><a href="#upgrade_740_enum_changed">Modified enumerations</a></li>
<li class="level2"><a href="#upgrade_740_geproj">Custom defines within env.bat</a></li>
<li class="level2"><a href="#upgrade_740_BVH_in_BOP">Switching Boolean Operations algorithm to use BVH tree instead of UB tree</a></li>
<li class="level2"><a href="#upgrade_740_stdnamespace">Standard_Stream.hxx no more has &quot;using std::&quot; statements</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_occt750">Upgrade to OCCT 7.5.0</a><ul><li class="level2"><a href="#upgrade_750_srgb_color">RGB color definition</a></li>
<li class="level2"><a href="#upgrade_750_aspectwindow">Aspect_Window interface change</a></li>
<li class="level2"><a href="#upgrade_750_rename">Renaming of types</a></li>
<li class="level2"><a href="#upgrade_750_BRepOffset_MakeOffset">change in construction of offset faces</a></li>
<li class="level2"><a href="#upgrade_750_tkv3d">TKV3d/TKService toolkits changes</a></li>
<li class="level2"><a href="#upgrade_750_hlrangle">Prs3d_Drawer deviation angle</a></li>
<li class="level2"><a href="#upgrade_750_hlrprs">Changes in HLR presentation API</a></li>
<li class="level2"><a href="#upgrade_750_dimensions">Dimension and Relation presentations moved from AIS to PrsDim</a></li>
<li class="level2"><a href="#upgrade_750_sensitiveEntity">Select3D_SensitiveEntity interface change</a></li>
<li class="level2"><a href="#upgrade_750_Booleans">Changes in Boolean operations algorithm</a></li>
<li class="level2"><a href="#upgrade_750_Adaptor2d_OffsetCurve">Offset direction change</a></li>
<li class="level2"><a href="#upgrade_750_ProgressIndicator">Change of progress indication API</a></li>
<li class="level2"><a href="#upgrade_750_message_messenger">Message_Messenger interface change</a></li>
<li class="level2"><a href="#upgrade_750_message_printer">Message_Printer interface change</a></li>
<li class="level2"><a href="#upgrade_750_prd3d_root">Prs3d_Root deprecation</a></li>
<li class="level2"><a href="#upgrade_750_cdf_session">Support of multiple OCAF application instances</a></li>
<li class="level2"><a href="#upgrade_750_draw_hotkeys">Draw Harness hotkeys</a></li>
<li class="level2"><a href="#upgrade_750_msgfile_utf8">Utf-8 encoding for message files</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_occt760">Upgrade to OCCT 7.6.0</a><ul><li class="level2"><a href="#upgrade_760_handle_adaptors">Simplification of surface/curve adaptor</a></li>
<li class="level2"><a href="#upgrade_760_extendedstring_cout">Output of TCollection_ExtendedString to stream</a></li>
<li class="level2"><a href="#upgrade_760_trimming_surface">Trimming surface</a></li>
<li class="level2"><a href="#upgrade_760_storageformatversion">Storage format version of OCAF document</a></li>
<li class="level2"><a href="#upgrade_760_createdocument">New OCAF document</a></li>
<li class="level2"><a href="#upgrade_760_changesInStorageOfShapes">Changes in storage of shapes</a></li>
<li class="level2"><a href="#upgrade_760_changesBinaryFormat">Changes in storage of binary document format</a></li>
<li class="level2"><a href="#upgrade_occt760_poly">Changes in &lt;em&gt;Poly&lt;/em&gt; package and &lt;em&gt;Poly_Triangulation&lt;/em&gt; class</a></li>
<li class="level2"><a href="#upgrade_occt760_glsl">Custom GLSL programs</a></li>
<li class="level2"><a href="#upgrade_occt760_noral_colors">Nodal color modulation</a></li>
<li class="level2"><a href="#upgrade_occt760_tkopengles">TKOpenGles library</a></li>
<li class="level2"><a href="#upgrade_occt760_fast_access_to_labels">Fast access to OCAF label</a></li>
<li class="level2"><a href="#upgrade_occt760_bop_progress_indicator">Progress indicator in Boolean operations</a></li>
<li class="level2"><a href="#upgrade_occt760_change_check_to_adaptors">Changes in BRepLib_CheckCurveOnSurface &amp; GeomLib_CheckCurveOnSurface interfaces</a></li>
<li class="level2"><a href="#upgrade_occt760_old_bop_removed">Removal of old Boolean operations algorithm (BRepAlgo_BooleanOperation)</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_occt770">Upgrade to OCCT 7.7.0</a><ul><li class="level2"><a href="#upgrade_770_removed_features">Removed features</a></li>
<li class="level2"><a href="#upgrade_occt770_parallel_flag_removed">Removed parameter theIsParallel from Put/Compute/Perform</a></li>
<li class="level2"><a href="#upgrade_occt770_drawer_aspects">Prs3d_Drawer aspects</a></li>
<li class="level2"><a href="#upgrade_occt770_opengl">OpenGL functions</a></li>
<li class="level2"><a href="#upgrade_occt770_tooltriangulatedshape">StdPrs_ToolTriangulatedShape</a></li>
<li class="level2"><a href="#upgrade_occt770_shapeproximity">BRepExtrema_ShapeProximity</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_occt780">Upgrade to OCCT 7.8.0</a><ul><li class="level2"><a href="#upgrade_780_recommendations">New Features and Recommendations</a></li>
<li class="level2"><a href="#upgrade_780_ncollection_update">Change in Default Clear Behavior for Containers</a></li>
<li class="level2"><a href="#upgrade_780_hash_utils">Reworked Hash Mechanism for Hash Map (NCollection&#39;s map)</a></li>
<li class="level2"><a href="#upgrade_780_removed_files">Removed Hash Specialization Classes</a></li>
<li class="level2"><a href="#upgrade_780_tk_rework">Reorganized DE TK</a></li>
<li class="level2"><a href="#upgrade_780_step_thread_safety">Implemented STEP Thread-safety Interface</a></li>
<li class="level2"><a href="#upgrade_780_new_memory_manager">New Memory Management Functionality</a></li>
<li class="level2"><a href="#upgrade_780_optimization_profiles">New CMake Variable for Optimization Profiles</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="upgrade_intro"></a>
Introduction</h1>
<p>This document provides technical details on changes made in particular versions of OCCT. It can help to upgrade user applications based on previous versions of OCCT to newer ones.</p>
<p><a class="el" href="occt__upgrade.html#upgrade_occt780">SEEK TO THE LAST CHAPTER (UPGRADE TO 7.8.0)</a></p>
<h2><a class="anchor" id="upgrade_intro_precautions"></a>
Precautions</h2>
<p>Back-up your code before the upgrade. We strongly recommend using version control system during the upgrade process and saving one or several commits at each step of upgrade, until the overall result is verified. This will facilitate identification and correction of possible problems that can occur at the intermediate steps of upgrade. It is advisable to document each step carefully to be able to repeat it if necessary.</p>
<h2><a class="anchor" id="upgrade_intro_disclaim"></a>
Disclaimer</h2>
<p>This document describes known issues that have been encountered during porting of OCCT and some applications and approaches that have helped to resolve these issues in known cases. It does not pretend to cover all possible migration issues that can appear in your application. Take this document with discretion; apply your expertise and knowledge of your application to ensure the correct result.</p>
<p>The automatic upgrade tool is provided as is, without warranty of any kind, and we explicitly disclaim any liability for possible errors that may appear due to use of this tool. It is your responsibility to ensure that the changes you made in your code are correct. When you upgrade the code by an automatic script, make sure to carefully review the introduced changes at each step before committing them.</p>
<h1><a class="anchor" id="upgrade_65"></a>
Upgrade to OCCT 6.5.0</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.5 requires taking into account the following major changes:</p><ul>
<li>If you are not comfortable with dependence on Intel TBB, FreeImage, or Gl2Ps libraries, you will need to (re)build OCCT with these dependencies disabled.</li>
<li>The low-level format version of OCAF binary and XML persistence has been incremented. Hence, the files saved by OCCT 6.5 to OCAF binary or XML format will not be readable by previous versions of OCCT.</li>
<li>The <em>BRepMesh</em> triangulation algorithm has been seriously revised and now tries hard to fulfill the requested deflection and angular tolerance parameters. If you experience any problems with performance or triangulation quality (in particular, display of shapes in shading mode), consider revising the values of these parameters used in your application.</li>
<li>If you were using method <em>ToPixMap()</em> of class <em>V3d_View</em> to get a buffer for passing to Windows API functions (e.g. <em>BitBlt</em>), this will not work anymore. You will need to use method <em>Image_PixMap::AccessBuffer()</em> to get the raw buffer data that can be further passed to WinAPI functions.</li>
<li>As the processing of message gravity parameter in <em>Message</em> package has been improved, some application messages (especially the ones generated by IGES or STEP translators) can be suppressed or new messages appear in the application. Use relevant message level parameter to tune this behavior.</li>
</ul>
<h1><a class="anchor" id="upgrade_651"></a>
Upgrade to OCCT 6.5.1</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.5.1 requires taking into account the following major changes:</p>
<ul>
<li>Method <em>Graphic3d_Structure::Groups()</em> now returns <em>Graphic3d_SequenceOfGroup</em>. If this method has been used, the application code should be updated to iterate another collection type or, if <em>Graphic3d_HSetOfGroup</em> is required, to fill its own collection: <div class="fragment"><div class="line"><span class="keyword">const</span> Graphic3d_SequenceOfGroup&amp; aGroupsSeq = theStructure.Groups();</div>
<div class="line">Handle(Graphic3d_HSetOfGroup) aGroupSet = <span class="keyword">new</span> Graphic3d_HSetOfGroup();</div>
<div class="line">Standard_Integer aLen = aGroupsSeq.Length();</div>
<div class="line"><span class="keywordflow">for</span> (Standard_Integer aGr = 1; aGr &lt;= aLen; ++aGr)</div>
<div class="line">{</div>
<div class="line"> aGroupSet-&gt;Add (aGroupsSeq.Value (aGr));</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>All occurrences of <em>Select3D_Projector</em> in the application code (if any) should be replaced with <em>Handle(Select3D_Projector)</em>.</li>
<li>The code of inheritors of <em>Select3D_SensitiveEntity</em> should be updated if they override <em>Matches()</em> (this is probable, if clipping planes are used).</li>
<li>Constructor for <em>V3d_Plane</em> has been changed, so the extra argument should be removed if used in the application. It is necessary to add a new plane using method <em>V3d_Viewer::AddPlane()</em> if <em>V3d_Viewer</em> has been used to manage clipping planes list (this does not affect clipping planes representation). Have a look at the source code for new DRAWEXE <em>vclipplane</em> command in <em>ViewerTest_ObjectsCommands.cxx, VClipPlane</em> to see how clipping planes can be managed in the application.</li>
</ul>
<h1><a class="anchor" id="upgrade_652"></a>
Upgrade to OCCT 6.5.2</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.5.2 requires taking into account the following major changes:</p><ul>
<li>Any code that has been generated by WOK from CDL generic classes <em>Tcollection_DataMap</em> and <em>Tcollection_IndexedDataMap</em> needs to be regenerated by WOK to take into account the change in the interface of these classes.</li>
<li>The enumerations <em>CDF_StoreStatus</em> and <em>CDF_RetrievableStatus</em> have been replaced by the enumerations <em>PCDM_StoreStatus</em> and <em>PCDM_ReaderStatus</em>. Correspondingly, the methods <em>Open, Save</em> and <em>SaveAs</em> of the class <em>TDocStd_Application</em> have changed their return value. Any code, which uses these enumerations, needs to be updated.</li>
<li><em>BRepLib_MakeFace</em> has been modified to receive tolerance value for resolution of degenerated edges. This tolerance parameter has no default value to ensure that the client code takes care of passing a meaningful value, not just <em>Precision::Confusion</em>, so some porting overheads are expected.</li>
<li>If the callback mechanism in call_togl_redraw function was used in the application code, it is necessary to revise it to take into account the new callback execution and provide a check of reason value of Aspect_GraphicCallbackStruct in callback methods to confirm that the callback code is executed at the right moment. Now the callbacks are executed before redrawing the underlayer, before redrawing the overlayer and at the end of redrawing. The information about the moment when the callback is invoked is provided with the reason value in form of an additional bit flag <em>(OCC_PRE_REDRAW, OCC_PRE_OVERLAY)</em>. The state of OpenGl changed in callback methods will not be restored automatically, which might lead to unwanted behavior in redrawing procedure.</li>
<li>The print method used in the application code might need to be revised to take into account the ability to choose between print algorithms: tile and stretch. The stretch algorithm will be selected by default during porting.</li>
<li>It is recommended to <em>BRepMesh_DiscretFactory</em> users, to check <em>BRepMesh_DiscretFactory::SetDefault()</em> return value to determine plugin availability / validity. <em>BRepMesh_DiscretFactory::Discret()</em> method now returns handle instead of pointer. The code should be updated in the following manner: <div class="fragment"><div class="line">Handle(BRepMesh_DiscretRoot) aMeshAlgo = BRepMesh_DiscretFactory::Get().Discret (theShape, theDeflection, theAngularToler);</div>
<div class="line"> <span class="keywordflow">if</span> (!aMeshAlgo.IsNull())  {}</div>
</div><!-- fragment --></li>
<li>The default state of <em>BRepMesh</em> parallelization has been turned off. The user should switch this flag explicitly:<ul>
<li>by using methods <em>BRepMesh_IncrementalMesh::SetParallel(Standard_True)</em> for each <em>BRepMesh_IncrementalMesh</em> instance before <em>Perform()</em>;</li>
<li>by calling <em>BRepMesh_IncrementalMesh::SetParallelDefault(Standard_True)</em> when <em>BRepMesh_DiscretFactory</em> is used to retrieve the meshing tool (this also affects auto-triangulation in <em>AIS</em>).</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="upgrade_653"></a>
Upgrade to OCCT 6.5.3</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.5.3 requires taking into account the following major changes:</p><ul>
<li>As a result of code clean-up and redesign of <em>TKOpenGl</em> driver, some obsolete functions and rendering primitives <em>(TriangleMesh, TriangleSet, Bezier, Polyline, Polygon, PolygonHoles, QuadrangleMesh</em> and <em>QuadrangleSet</em>) have been removed. Instead, the application developers should use primitive arrays that provide the same functionality but are hardware-accelerated. The details can be found in OCCT Visualization User's Guide, “Primitive Arrays” chapter.</li>
<li>Applications should not call <em>AIS_InteractiveObject::SetPolygonOffsets()</em> method for an instance of <em>AIS_TexturedShape</em> class after it has been added to <em>AIS_InteractiveContext</em>. More generally, modification of <em>Graphic3d_AspectFillArea3d</em> parameters for the computed groups of any <em>AIS_InteractiveObject</em> subclass that uses texture mapping should be avoided, because this results in broken texture mapping (see issue 23118). It is still possible to apply non-default polygon offsets to <em>AIS_TexturedShape</em> by calling <em>SetPolygonOffsets()</em> before displaying the shape.</li>
<li>The applications that might have used internal functions provided by <em>TKOpenGl</em> or removed primitives will need to be updated.</li>
<li>In connection with the implementation of Z-layers it might be necessary to revise the application code or revise the custom direct descendant classes of <em>Graphic3d_GraphicDriver</em> and <em>Graphic3d_StructureManager</em> to use the Z-layer feature.</li>
<li>Global variables <em>Standard_PI</em> and <em>PI</em> have been eliminated (use macro <em>M_PI</em> instead).</li>
<li>Method <em>HashCode()</em> has been removed from class <em>Standard_Transient</em>. It is advisable to use global function <em>HashCode()</em> for Handle objects instead.</li>
<li>Declaration of operators new/delete for classes has become consistent and is encapsulated in macros.</li>
<li>Memory management has been changed to use standard heap <em>(MMGT_OPT=0)</em> and reentrant mode <em>(MMGT_REENTRANT=1)</em> by default.</li>
<li>Map classes in <em>NCollection</em> package now receive one more argument defining a hash tool.</li>
</ul>
<h1><a class="anchor" id="upgrade_654"></a>
Upgrade to OCCT 6.5.4</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.5.4 requires taking into account the following major changes:</p><ul>
<li>The code using obsolete classes <em>Aspect_PixMap, Xw_PixMap</em> and <em>WNT_PixMap</em> should be rewritten implementing class <em>Image_PixMap</em>, which is now retrieved by <em>ToPixMap</em> methods as argument. A sample code using <em>ToPixMap</em> is given below: <div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Image_AlienPixMap.hxx&gt;</span></div>
<div class="line"><span class="keywordtype">void</span> dump (Handle(V3d_View)&amp; theView3D)</div>
<div class="line">{</div>
<div class="line">  Standard_Integer aWndSizeX = 0;</div>
<div class="line">  Standard_Integer aWndSizeY = 0;</div>
<div class="line">  theView3D-&gt;Window()-&gt;Size (aWndSizeX, aWndSizeY);</div>
<div class="line">  Image_AlienPixMap aPixMap;</div>
<div class="line">  theView3D-&gt;ToPixMap (aPixMap, aWndSizeX, aWndSizeY);</div>
<div class="line">  aPixMap.Save (<span class="stringliteral">&quot;c:\\image.png&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>Now OpenGL resources related to Interactive Objects are automatically freed when the last view (window) is removed from graphical driver. To avoid presentation data loss, the application should replace an old view with a new one in the proper order: first the new view is created and activated and only then the old one is detached and removed.</li>
<li>It is recommended to use <em>NCollection</em> containers with hasher parameter (introduced in 6.5.3) instead of global definition <em>IsEqual()/HashCode()</em> as well as to use explicit namespaces to avoid name collision.</li>
</ul>
<h1><a class="anchor" id="upgrade_660"></a>
Upgrade to OCCT 6.6.0</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.6.0 requires taking into account the following major changes:</p><ul>
<li>Due to the changes in the implementation of Boolean Operations, the order of sub-shapes resulting from the same operation performed with OCCT 6.5.x and OCCT 6.6.0 can be different. It is necessary to introduce the corresponding changes in the applications for which the order of sub-shapes resulting from a Boolean operation is important. It is strongly recommended to use identification methods not relying on the order of sub-shapes (e.g. OCAF naming).</li>
<li>If you need to use OCCT on Mac OS X with X11 (without Cocoa), build OCCT with defined pre-processor macro <em>CSF_MAC_USE_GLX11</em>. XLib front-end (previously the only way for unofficial OCCT builds on Mac OS X) is now disabled by default on this platform. If your application has no support for Cocoa framework you may build OCCT with XLib front-end adding <em>MACOSX_USE_GLX</em> macro to compiler options (you may check the appropriate option in WOK configuration GUI and in CMake configuration). Notice that XQuartz (XLib implementation for Mac OS X) now is an optional component and does not provide a sufficient level of integrity with native (Cocoa-based) applications in the system. It is not possible to build OCCT with both XLib and Cocoa at the same time due to symbols conflict in OpenGL functions.</li>
<li>Animation mode and degeneration presentation mode (simplified presentation for animation) and associated methods have been removed from 3D viewer functionality. Correspondingly, the code using methods <em>SetAnimationModeOn(), SetAnimationModeOff(), AnimationModeIsOn(), AnimationMode(), Tumble(), SetDegenerateModeOn(), SetDegenerateModeOff()</em> and <em>DegenerateModeIsOn()</em> of classes <em>V3d_View</em> and <em>Visual3d_View</em> will need to be removed or redesigned. Hidden Line Removal presentation was not affected; however, the old code that used methods <em>V3d_View::SetDegenerateModeOn</em> or <em>V3d_View::SetDegenerateModeOff</em> to control HLR presentation should be updated to use <em>V3d_View::SetComputedMode</em> method instead.</li>
<li>Calls of <em>Graphic3d_Group::BeginPrimitives()</em> and <em>Graphic3d_Group::EndPrimitives()</em> should be removed from the application code.</li>
<li>Application functionality for drawing 2D graphics that was formerly based on <em>TKV2d</em> API should be migrated to <em>TKV3d</em> API. The following changes are recommended for this migration:<ul>
<li>A 2D view can be implemented as a <em>V3d_View</em> instance belonging to <em>V3d_Viewer</em> managed by <em>AIS_InteractiveContext</em> instance. To turn <em>V3d_View</em> into a 2D view, the necessary view orientation should be set up at the view initialization stage using <em>V3d_View::SetProj()</em> method, and view rotation methods simply should not be called.</li>
<li>Any 2D graphic entity (formerly represented with <em>AIS2D_InteractiveObject</em>) should become a class derived from <em>AIS_InteractiveObject</em> base. These entities should be manipulated in a view using <em>AIS_InteractiveContext</em> class API.</li>
<li>All drawing code should be put into <em>Compute()</em> virtual method of a custom interactive object class and use API of <em>Graphic3d</em> package. In particular, all geometry should be drawn using class hierarchy derived from <em>Graphic3d_ArrayOfPrimitives</em>. Normally, the Z coordinate for 2D geometry should be constant, unless the application implements some advanced 2D drawing techniques like e.g. multiple "Z layers" of drawings.</li>
<li>Interactive selection of 2D presentations should be set up inside <em>ComputeSelection()</em> virtual method of a custom interactive object class, using standard sensitive entities from <em>Select3D</em> package and standard or custom entity owners derived from <em>SelectMgr_EntityOwner</em> base. Refer to the Visualization User's Guide for further details concerning OCCT 3D visualization and selection classes. See also <em>Viewer2D</em> OCCT sample application, which shows how 2D drawing can be implemented using TKV3d API.</li>
</ul>
</li>
<li>Run-time graphic driver library loading mechanism based on <em>CSF_GraphicShr</em> environment variable usage has been replaced by explicit linking against <em>TKOpenGl</em> library. The code sample below shows how the graphic driver should be created and initialized in the application code: <div class="fragment"><div class="line"><span class="comment">// initialize a new viewer with OpenGl graphic driver</span></div>
<div class="line">Handle(Graphic3d_GraphicDriver) aGraphicDriver = </div>
<div class="line"><span class="keyword">new</span> OpenGl_GraphicDriver (<span class="stringliteral">&quot;TKOpenGl&quot;</span>);</div>
<div class="line">  aGraphicDriver-&gt;Begin (<span class="keyword">new</span> Aspect_DisplayConnection());</div>
<div class="line">  TCollection_ExtendedString aNameOfViewer (<span class="stringliteral">&quot;Visu3D&quot;</span>);</div>
<div class="line">  Handle(V3d_Viewer) aViewer </div>
<div class="line">= <span class="keyword">new</span> V3d_Viewer (aGraphicDriver, aNameOfViewer.ToExtString());</div>
<div class="line">  aViewer-&gt;Init();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// create a new window or a wrapper over the existing window, </span></div>
<div class="line"><span class="comment">// provided by a 3rd-party framework (Qt, MFC, C# or Cocoa)</span></div>
<div class="line"><span class="preprocessor">#if defined(_WIN32) || defined(__WIN32__)</span></div>
<div class="line">  Aspect_Handle aWindowHandle = (Aspect_Handle )winId();</div>
<div class="line">  Handle(WNT_Window) aWindow = <span class="keyword">new</span> WNT_Window (winId());</div>
<div class="line"><span class="preprocessor">#elif defined(__APPLE__) &amp;&amp; !defined(MACOSX_USE_GLX)</span></div>
<div class="line">  NSView* aViewHandle = (NSView* )winId();</div>
<div class="line">  Handle(Cocoa_Window) aWindow = <span class="keyword">new</span> Cocoa_Window (aViewHandle);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"> Aspect_Handle aWindowHandle = (Aspect_Handle )winId();</div>
<div class="line">  Handle(Xw_Window) aWindow = </div>
<div class="line">     <span class="keyword">new</span> Xw_Window (aGraphicDriver-&gt;GetDisplayConnection(), aWindowHandle);</div>
<div class="line"><span class="preprocessor">#endif // WNT</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// setup the window for a new view</span></div>
<div class="line">  Handle(V3d_View) aView = aViewer-&gt;CreateView();</div>
<div class="line">  aView-&gt;SetWindow (aWindow);</div>
</div><!-- fragment --></li>
<li>The following changes should be made in the application-specific implementations of texture aspect:<ul>
<li><em>Graphic3d_TextureRoot</em> inheritors now should return texture image by overloading of <em>Graphic3d_TextureRoot::GetImage()</em> method instead of the old logic.</li>
<li>Now you can decide if the application should store the image copy as a field of property or reload it dynamically each time (to optimize the memory usage). The default implementation (which loads the image content from the provided file path) does not hold an extra copy since it will be uploaded to the graphic memory when first used.</li>
<li>Notice that the image itself should be created within <em>Image_PixMap</em> class from <em>AlienImage</em> package, while <em>Image_Image</em> class is no more supported and will be removed in the next OCCT release.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="upgrade_670"></a>
Upgrade to OCCT 6.7.0</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.7.0 requires taking into account the following major changes.</p>
<h2><a class="anchor" id="upgrade_670_clipping"></a>
Object-level clipping and capping algorithm.</h2>
<ul>
<li>It might be necessary to revise and port code related to management of view-level clipping to use <em>Graphic3d_ClipPlane</em> instead of <em>V3d_Plane</em> instances. Note that <em>V3d_Plane</em> class has been preserved &ndash; as previously, it can be used as plane representation. Another approach to represent <em>Graphic3d_ClipPlane</em> in a view is to use custom presentable object.</li>
<li>The list of arguments of <em>Select3D_SensitiveEntity::Matches()</em> method for picking detection has changed. Since now, for correct selection clipping, the implementations should perform a depth clipping check and return (as output argument) minimum depth value found at the detected part of sensitive. Refer to CDL / Doxygen documentation to find descriptive hints and snippets.</li>
<li><em>Select3D_SensitiveEntity::ComputeDepth()</em> abstract method has been removed. Custom implementations should provide depth checks by method <em>Matches()</em> instead &ndash; all data required for it is available within a scope of single method.</li>
<li>It might be necessary to revise the code of custom sensitive entities and port <em>Matches()</em> and <em>ComputeDepth()</em> methods to ensure proper selection clipping. Note that obsolete signature of <em>Matches</em> is not used anymore by the selector. If your class inheriting <em>Select3D_SensitiveEntity</em> redefines the method with old signature the code should not compile as the return type has been changed. This is done to prevent override of removed methods.</li>
</ul>
<h2><a class="anchor" id="upgrade_670_markers"></a>
Redesign of markers presentation</h2>
<ul>
<li>Due to the redesign of <em>Graphic3d_AspectMarker3d</em> class the code of custom markers initialization should be updated. Notice that you can reuse old markers definition code as <em>TColStd_HArray1OfByte</em>; however, <em>Image_PixMap</em> is now the preferred way (and supports full-color images on modern hardware).</li>
<li>Logics and arguments of methods <em>AIS_InteractiveContext::Erase()</em> and <em>AIS_InteractiveContext::EraseAll()</em> have been changed. Now these methods do not remove resources from <em>Graphic3d_Structure</em>; they simply change the visibility flag in it. Therefore, the code that deletes and reсomputes resources should be revised.</li>
<li><em>Graphic3d_Group::MarkerSet()</em> has been removed. <em>Graphic3d_Group::AddPrimitiveArray()</em> should be used instead to specify marker(s) array.</li>
</ul>
<h2><a class="anchor" id="upgrade_670_views"></a>
Default views are not created automatically</h2>
<p>As the obsolete methods <em>Init(), DefaultOrthographicView()</em> and <em>DefaultPerspectiveView()</em> have been removed from <em>V3d_Viewer</em> class, the two default views are no longer created automatically. It is obligatory to create <em>V3d_View</em> instances explicitly, either directly by operator new or by calling <em>V3d_Viewer::CreateView()</em>.</p>
<p>The call <em>V3d_Viewer::SetDefaultLights()</em> should also be done explicitly at the application level, if the application prefers to use the default light source configuration. Otherwise, the application itself should set up the light sources to obtain a correct 3D scene.</p>
<h2><a class="anchor" id="upgrade_670_dimensions"></a>
Improved dimensions implementation</h2>
<ul>
<li>It might be necessary to revise and port code related to management of <em>AIS_LengthDimension, AIS_AngleDimension</em> and <em>AIS_DiameterDimension</em> presentations. There is no more need to compute value of dimension and pass it as string to constructor argument. The value is computed internally. The custom value can be set with <em>SetCustomValue()</em> method.</li>
<li>The definition of units and general aspect properties is now provided by <em>Prs3d_DimensionUnits</em> and <em>Prs3d_DimensionApsect</em> classes.</li>
<li>It might be also necessary to revise code of your application related to usage of <em>AIS_DimensionDisplayMode enumeration</em>. If it used for specifying the selection mode, then it should be replaced by a more appropriate enumeration <em>AIS_DimensionSelectionMode</em>.</li>
</ul>
<h2><a class="anchor" id="upgrade_670_list_collection"></a>
NCollection_Set replaced by List collection</h2>
<p>It might be necessary to revise your application code, which uses non-ordered <em>Graphic3d_SetOfHClipPlane</em> collection type and replace its occurrences by ordered <em>Graphic3d_SequenceOfHClipPlane</em> collection type.</p>
<h1><a class="anchor" id="upgrade_680"></a>
Upgrade to OCCT 6.8.0</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.8.0 requires taking into account the following major changes.</p>
<h2><a class="anchor" id="upgrade_680_ncollection"></a>
Changes in NCollection classes</h2>
<p>Method <em>Assign()</em> in <em>NCollection</em> classes does not allow any more copying between different collection types. Such copying should be done manually.</p>
<p>List and map classes in <em>NCollection</em> package now require that their items be copy-constructible, but do not require items to have default constructor. Thus the code using <em>NCollection</em> classes for non-copy-constructible objects needs be updated. One option is to provide copy constructor; another possibility is to use Handle or other smart pointer.</p>
<h2><a class="anchor" id="upgrade_680_view_camera"></a>
3D View Camera</h2>
<p>If <em>ViewMapping</em> and <em>ViewOrientation</em> were used directly, this functionality has to be ported to the new camera model. The following methods should be considered as an alternative to the obsolete <em>Visual3d</em> services (all points and directions are supposed to be in world coordinates):</p><ul>
<li><em>Graphic3d_Camera::ViewDimensions()</em> or <em>V3d_View::Size()/ZSize()</em> &ndash; returns view width, height and depth (or "Z size"). Since the view is symmetric now, you can easily compute top, bottom, left and right limits. <em>Graphic3d_Camera::ZNear()/ZFar()</em> can be used to obtain the near and far clipping distances with respect to the eye.</li>
<li><em>Graphic3d_Camera::Up()</em> or <em>V3d_View::Up()</em> &ndash; returns Y direction of the view.</li>
<li><em>Graphic3d_Camera::Direction()</em> returns the reverse view normal directed from the eye, <em>V3d_View::Proj()</em> returns the old-style view normal.</li>
<li><em>Graphic3d_Camera::Eye()</em> or <em>V3d_View::Eye()</em> &ndash; returns the camera position (same as projection reference point in old implementation).</li>
<li><em>Graphic3d_Camera::Center()</em> or <em>V3d_View::At()</em> &ndash; returns the point the camera looks at (or view reference point according to old terminology).</li>
</ul>
<p>The current perspective model is not fully backward compatible, so the old perspective-related functionality needs to be reviewed.</p>
<p>Revise application-specific custom presentations to provide a proper bounding box, otherwise the object might become erroneously clipped by automatic <em>ZFit</em> or frustum culling algorithms enabled by default.</p>
<h2><a class="anchor" id="upgrade_680_connected_objects"></a>
Redesign of Connected Interactive Objects</h2>
<p>The new implementation of connected Interactive Objects makes it necessary to take the following steps if you use connected Interactive Objects in your application.</p><ul>
<li>Use new <em>PrsMgr_PresentableObject</em> transformation API.</li>
<li>Call <em>RemoveChild()</em> from the original object after connect if you need the original object and <em>AIS_ConnectedInteractive</em> to move independently.</li>
<li>Access instances of objects connected to <em>AIS_MultiplyConnectedInteractive</em> with <em>Children()</em> method.</li>
<li>For <em>PrsMgr_PresentableObject</em> transformation:<ul>
<li><em>SetLocation (TopLoc_Location) -&gt; SetLocalTransformation (gp_Trsf)</em></li>
<li><em>Location -&gt; LocalTransformation</em></li>
<li><em>HasLocation -&gt; HasTransformation</em></li>
<li><em>ResetLocation -&gt; ResetTransformation</em></li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="upgrade_680_unicode"></a>
Support of UNICODE Characters</h2>
<p>Support of UNICODE characters introduced in OCCT breaks backward compatibility with applications, which currently use filenames in extended ASCII encoding bound to the current locale. Such applications should be updated to convert such strings to UTF-8 format.</p>
<p>The conversion from UTF-8 to wchar_t is made using little-endian approach. Thus, this code will not work correctly on big-endian platforms. It is needed to complete this in the way similar as it is done for binary persistence (see the macro <em>DO_INVERSE</em> in <em>FSD_FileHeader.hxx).</em></p>
<h2><a class="anchor" id="upgrade_680_projection_shift"></a>
Elimination of Projection Shift Concept</h2>
<p>It might be necessary to revise the application code, which deals with <em>Center()</em> method of <em>V3d_View</em>.</p>
<p>This method was used to pan a <em>V3d</em> view by virtually moving the screen center with respect to the projection ray passed through Eye and At points. There is no more need to derive the panning from the Center parameter to get a camera-like eye position and look at the coordinates. <em>Eye()</em> and <em>At()</em> now return these coordinates directly. When porting code dealing with <em>Center()</em>, the parameters <em>Eye()</em> and <em>At()</em> can be adjusted instead. Also <em>V3d_View::SetCenter(Xpix, Ypix)</em> method can be used instead of <em>V3d_View::Center(X, Y)</em> to center the view at the given point. However, if the center coordinates X and Y come from older OCCT releases, calling <em>V3d_View::Panning(-X, -Y)</em> can be recommended to compensate missing projection shift effect.</p>
<p>There are several changes introduced to <em>Graphic3d_Camera</em>. The internal data structure of the camera is based on <em>Standard_Real</em> data types to avoid redundant application-level conversions and precision errors. The transformation matrices now can be evaluated both for <em>Standard_Real</em> and <em>Standard_ShortReal</em> value types. <em>ZNear</em> and <em>ZFar</em> planes can be either negative or positive for orthographic camera projection, providing a trade-off between the camera distance and the range of <em>ZNear</em> or <em>ZFar</em> to reduce difference of exponents of values composing the orientation matrix - to avoid calculation errors. The negative values can be specified to avoid Z-clipping if the reference system of camera goes inside of the model when decreasing camera distance.</p>
<p>The auto z fit mode, since now, has a parameter defining Z-range margin (the one which is usually passed as argument to <em>ZFitAll()</em> method). The methods <em>SetAutoZFitMode(), AutoZFitScaleFactor()</em> and <em>ZFitAll()</em> from class <em>V3d_View</em> deal with the new parameter.</p>
<p>The class <em>Select3D_Projector</em> now supports both orientation and projection transformation matrices, which can be naturally set for the projector. The definition of projector was revised in <em>StdSelect_ViewerSelector3d</em>: perspective and orthographic projection parameters are handled properly. Orthographic projector is based only on direction of projection - no more <em>Center</em> property. This makes it possible to avoid unnecessary re-projection of sensitive while panning, zooming or moving along the projection ray of the view. These operations do not affect the orthographic projection.</p>
<h1><a class="anchor" id="upgrade_690"></a>
Upgrade to OCCT 6.9.0</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.9.0 requires taking into account the following major changes.</p>
<h2><a class="anchor" id="upgrade_690_shaders"></a>
3D Viewer initialization</h2>
<p>3D Viewer now uses GLSL programs for managing frame buffer and stereoscopic output. For proper initialization, application should configure <b>CSF_ShadersDirectory</b> environment variable pointing to a folder with GLSL resources - files from folder <b>CASROOT</b>/src/Shaders. <em>Note that <b>CSF_ShadersDirectory</b> become optional since OCCT 7.1.0 release</em>.</p>
<h2><a class="anchor" id="upgrade_690_selection"></a>
Changes in Selection</h2>
<p>Selection mechanism of 3D Viewer has been redesigned to use 3-level BVH tree traverse directly in 3D space instead of projection onto 2D screen space (updated on each rotation). This architectural redesign may require appropriate changes at application level in case if custom Interactive Objects are used.</p>
<h3><a class="anchor" id="autotoc_md34"></a>
Standard selection</h3>
<p>Usage of standard OCCT selection entities would require only minor updates.</p>
<p>Custom Interactive Objects should implement new virtual method <em>SelectMgr_SelectableObject::BoundingBox().</em></p>
<p>Now the method <em>SelectMgr_Selection::Sensitive()</em> does not return <em>SelectBasics_SensitiveEntity</em>. It returns an instance of <em>SelectMgr_SensitiveEntity</em>, which belongs to a different class hierarchy (thus <em>DownCast()</em> will fail). To access base sensitive it is necessary to use method <em>SelectMgr_SensitiveEntity::BaseSensitive()</em>. For example:</p>
<div class="fragment"><div class="line">Handle(SelectMgr_Selection) aSelection = anInteractiveObject-&gt;Selection (aMode);</div>
<div class="line"><span class="keywordflow">for</span> (aSelection-&gt;Init(); aSelection-&gt;More(); aSelection-&gt;Next())</div>
<div class="line">{</div>
<div class="line">   Handle(SelectBasics_SensitiveEntity) anEntity = aSelection-&gt;Sensitive()-&gt;BaseSensitive();</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md35"></a>
Custom sensitive entities</h3>
<p>Custom sensitive entities require more complex changes, since the selection algorithm has been redesigned and requires different output from the entities.</p>
<p>The method <em>SelectBasics_SensitiveEntity::Matches()</em> of the base class should be overridden following the new signature:</p>
<p><em>Standard_Boolean Matches (SelectBasics_SelectingVolumeManager&amp; theMgr, SelectBasics_PickResult&amp; thePickResult)</em>, where <em>theMgr</em> contains information about the currently selected frustum or set of frustums (see <em>SelectMgr_RectangularFrustum, SelectMgr_TrangularFrustum, SelectMgr_TriangularFrustumSet)</em> and <em>SelectBasics_PickResult</em> is an output parameter, containing information about the depth of the detected entity and distance to its center of geometry.</p>
<p>In the overridden method it is necessary to implement an algorithm of overlap and inclusion detection (the active mode is returned by <em>theMgr.IsOverlapAllowed()</em>) with triangular and rectangular frustums.</p>
<p>The depth and distance to the center of geometry must be calculated for the 3D projection of user-picked screen point in the world space. You may use already implemented overlap and inclusion detection methods for different primitives from <em>SelectMgr_RectangularFrustum</em> and <em>SelectMgr_TriangularFrustum</em>, including triangle, point, axis-aligned box, line segment and planar polygon.</p>
<p>Here is an example of overlap/inclusion test for a box:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (!theMgr.IsOverlapAllowed()) <span class="comment">// check for inclusion</span></div>
<div class="line">{</div>
<div class="line">  Standard_Boolean isInside = Standard_True;</div>
<div class="line">  <span class="keywordflow">return</span> theMgr.Overlaps (myBox.CornerMin(), myBox.CornerMax(), &amp;isInside) &amp;&amp; isInside;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">Standard_Real aDepth;</div>
<div class="line"><span class="keywordflow">if</span> (!theMgr.Overlaps (myBox, aDepth)) <span class="comment">// check for overlap</span></div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> Standard_False;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">thePickResult =</div>
<div class="line">SelectBasics_PickResult (aDepth, theMgr.DistToGeometryCenter (myCenter3d));</div>
</div><!-- fragment --><p>The interface of <em>SelectBasics_SensitiveEntity</em> now contains four new pure virtual functions that should be implemented by each custom sensitive:</p><ul>
<li><em>BoundingBox()</em> – returns a bounding box of the entity;</li>
<li><em>Clear()</em> – clears up all the resources and memory allocated for complex sensitive entities;</li>
<li><em>BVH()</em> – builds a BVH tree for complex sensitive entities, if it is needed;</li>
<li><em>NbSubElements()</em> – returns atomic sub-entities of a complex sensitive entity, which will be used as primitives for BVH building. If the entity is simple and no BVH is required, this method returns 1.</li>
</ul>
<p>Each sensitive entity now has its own tolerance, which can be overridden by method <em>SelectBasics_SensitiveEntity::SetSensitivityFactor()</em> called from constructor.</p>
<h2><a class="anchor" id="upgrade_690_adaptor3d-curve"></a>
Changes in Adaptor3d_Curve class</h2>
<p>All classes inheriting <em>Adaptor3d_Curve</em> (directly or indirectly) must be updated in application code to use new signature of methods <em>Intervals()</em> and <em>NbIntervals()</em>. Note that no compiler warning will be generated if this is not done.</p>
<h2><a class="anchor" id="upgrade_690_v3d_view"></a>
Changes in V3d_View class</h2>
<p>The methods <em>V3d_View::Convert</em> and <em>V3d_View::ConvertWithProj()</em> have ceased to return point on the active grid. It might be necessary to revise the code of your application so that <em>V3d_View::ConvertToGrid()</em> was called explicitly for the values returned by <em>V3d_View::Convert</em> to get analogous coordinates on the grid. The methods <em>V3d_View::Convert</em> and <em>V3d_View::ConvertWithProj</em> convert point into reference plane of the view corresponding to the intersection with the projection plane of the eye/view point vector.</p>
<h1><a class="anchor" id="upgrade_700"></a>
Upgrade to OCCT 7.0.0</h1>
<p>Porting of user applications from an earlier OCCT version to version 7.0.0 requires taking into account the following major changes.</p>
<p>Building OCCT now requires compiler supporting some C++11 features. The supported compilers are:</p><ul>
<li>MSVC: version 10 (Visual Studio 2010) or later</li>
<li>GCC: version 4.3 or later</li>
<li>CLang: version 3.6 or later</li>
<li>ICC: version XE 2013 SP 1 or later</li>
</ul>
<p>When compiling code that uses OCCT with GCC and CLang compilers, it is necessary to use compiler option -std=c++0x (or its siblings) to enable C++11 features.</p>
<h2><a class="anchor" id="upgrade_700_persist"></a>
Removal of legacy persistence</h2>
<p>Legacy persistence for shapes and OCAF data based on <em>Storage_Schema</em> (toolkits <em>TKPShape</em>, <em>TKPLCAF</em>, <em>TKPCAF</em>, <em>TKShapeShcema, TLStdLSchema, TKStdSchema</em>, and <em>TKXCAFSchema</em>) has been removed in OCCT 7.0.0. The applications that used these data persistence tools need to be updated to use other persistence mechanisms.</p>
<dl class="section note"><dt>Note</dt><dd>For compatibility with previous versions, the possibility to read standard OCAF data (<em>TKLCAF</em> and <em>TKCAF</em>) from files stored in the old format is preserved (toolkits <em>TKStdL</em> and <em>TKStd</em>).</dd></dl>
<p>The existing data files in standard formats can be converted using OCCT 6.9.1 or a previous version, as follows.</p>
<dl class="section note"><dt>Note</dt><dd>Reading / writing custom files capability from OCCT 6.9.1 is restored in OCCT 7.2.0. See details in <a class="el" href="occt__upgrade.html#upgrade_720_persistence">Restore OCCT 6.9.1 persistence</a> section.</dd></dl>
<h3><a class="anchor" id="autotoc_md36"></a>
CSFDB files</h3>
<p>Files in <em>CSFDB</em> format (usually with extension .csfdb) contain OCCT shape data that can be converted to BRep format. The easiest way to do that is to use ImportExport sample provided with OCCT 6.9.0 (or earlier):</p>
<ul>
<li>Start ImportExport sample;</li>
<li>Select File / New;</li>
<li>Select File / Import / CSFDB... and specify the file to be converted;</li>
<li>Drag the mouse with the right button pressed across the view to select all shapes by the rectangle;</li>
<li>Select File / Export / BREP... and specify the location and name for the resulting file</li>
</ul>
<h3><a class="anchor" id="autotoc_md37"></a>
OCAF and XCAF documents</h3>
<p>Files containing OCAF data saved in the old format usually have extensions <em>.std, .sgd</em> or <em>.dxc</em> (XDE documents). These files can be converted to XML or binary OCAF formats using DRAW Test Harness commands. Note that if the file contains only attributes defined in <em>TKLCAF</em> and <em>TKCAF</em>, this action can be performed in OCCT 7.0; otherwise OCCT 6.9.1 or earlier should be used.</p>
<p>For that, start <em>DRAWEXE</em> and perform the following commands:</p>
<ul>
<li>To convert <em>*.std</em> and <em>*.sgd</em> file formats to binary format <em>*.cbf</em> (The created document should be in <em>BinOcaf</em> format instead of <em>MDTV-Standard</em>):</li>
</ul>
<div class="fragment"><div class="line">Draw[]&gt; pload ALL</div>
<div class="line">Draw[]&gt; Open [path to *.std or *.sgd file] Doc</div>
<div class="line">Draw[]&gt; Format Doc BinOcaf</div>
<div class="line">Draw[]&gt; SaveAs Doc [path to the new file]</div>
</div><!-- fragment --><ul>
<li>To convert <em>*.dxc</em> file format to binary format <em>*.xbf</em> (The created document should be in <em>BinXCAF</em> format instead of <em>MDTV-XCAF</em>):</li>
</ul>
<div class="fragment"><div class="line">Draw[]&gt; pload ALL</div>
<div class="line">Draw[]&gt; XOpen [path to *.dxc file] Doc</div>
<div class="line">Draw[]&gt; Format Doc BinXCAF</div>
<div class="line">Draw[]&gt; XSave Doc [path to the new file]</div>
</div><!-- fragment --><p>On Windows, it is necessary to replace back slashes in the file path by direct slashes or pairs of back slashes.</p>
<p>Use <em>XmlOcaf</em> or <em>XmlXCAF</em> instead of <em>BinOcaf</em> and <em>BinXCAF</em>, respectively, to save in XML format instead of binary one.</p>
<h2><a class="anchor" id="upgrade_occt700_cdl"></a>
Removal of CDL and WOK</h2>
<p>OCCT code has been completely refactored in version 7.0 to get rid of obsolete technologies used since its inception: CDL (Cas.Cade Definition Language) and WOK (Workshop Organization Kit).</p>
<p>C++ code previously generated by WOK from CDL declarations is now included directly in OCCT sources.</p>
<p>This modification did not change names, API, and behavior of existing OCCT classes, thus in general the code based on OCCT 6.x should compile and work fine with OCCT 7.0. However, due to redesign of basic mechanisms (CDL generic classes, Handles and RTTI) using C++ templates, some changes may be necessary in the code when porting to OCCT 7.0, as described below.</p>
<p>WOK is not necessary anymore for building OCCT from sources, though it still can be used in a traditional way &ndash; auxiliary files required for that are preserved. The recommended method for building OCCT 7.x is CMake, see <a class="el" href="build_upgrade__building_occt.html#build_occt_win_cmake">Building with CMake tool</a>. The alternative solution is to use project files generated by OCCT legacy tool <b>genproj</b>, see <a class="el" href="build_upgrade__building_occt.html#build_occt_genproj">Building with Genproj tool</a>.</p>
<h3><a class="anchor" id="upgrade_occt700_cdl_auto"></a>
Automatic upgrade</h3>
<p>Most of typical changes required for upgrading code for OCCT 7.0 can be done automatically using the <em>upgrade</em> tool included in OCCT 7.0. This tool is a Tcl script, thus Tcl should be available on your workstation to run it.</p>
<p>Example: </p><div class="fragment"><div class="line">$ tclsh</div>
<div class="line">% source &lt;path_to_occt&gt;/adm/upgrade.tcl</div>
<div class="line">% upgrade -recurse -all -src=&lt;path_to_your_sources&gt;</div>
</div><!-- fragment --><p>On Windows, the helper batch script <em>upgrade.bat</em> can be used, provided that Tcl is either available in <em>PATH</em>, or configured via <em>custom.bat</em> script (for instance, if you use OCCT installed from Windows installer package). Start it from the command prompt:</p>
<div class="fragment"><div class="line">cmd&gt; &lt;path_to_occt&gt;\upgrade.bat -recurse -all -inc=&lt;path_to_occt&gt;\inc -src=&lt;path_to_your_sources&gt; [options]</div>
</div><!-- fragment --><p>Run the upgrade tool without arguments to see the list of available options.</p>
<p>The upgrade tool performs the following changes in the code.</p>
<ol type="1">
<li><p class="startli">Replaces macro <em>DEFINE_STANDARD_RTTI</em> by <em>DEFINE_STANDARD_RTTIEXT</em>, with second argument indicating base class for the main argument class (if inheritance is recognized by the script): </p><div class="fragment"><div class="line">DEFINE_STANDARD_RTTI(Class) -&gt; DEFINE_STANDARD_RTTIEXT(Class, Base)</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>If macro <em>DEFINE_STANDARD_RTTI</em> with two arguments (used in intermediate development versions of OCCT 7.0) is found, the script will convert it to either <em>DEFINE_STANDARD_RTTIEXT</em> or <em>DEFINE_STANDARD_RTTI_INLINE</em>. The former case is used if current file is header and source file with the same name is found in the same folder. In this case, macro <em>IMPLEMENT_STANDARD_RTTI</em> is injected in the corresponding source file. The latter variant defines all methods for RTTI as inline, and does not require <em>IMPLEMENT_STANDARD_RTTIEXT</em> macro.</dd></dl>
</li>
<li>Replaces forward declarations of collection classes previously generated from CDL generics (defined in <em>TCollection</em> package) by inclusion of the corresponding header: <div class="fragment"><div class="line"><span class="keyword">class </span>TColStd_Array1OfReal; -&gt; #include &lt;TColStd_Array1OfReal.hxx&gt;</div>
</div><!-- fragment --></li>
<li><p class="startli">Replaces underscored names of <em>Handle</em> classes by usage of a macro: </p><div class="fragment"><div class="line">Handle_Class -&gt; Handle(Class)</div>
</div><!-- fragment --><p class="startli">This change is not applied if the source or header file is recognized as containing the definition of Qt class with signals or slots, to avoid possible compilation errors of MOC files caused by inability of MOC to recognize macros (see <a href="https://doc.qt.io/qt-4.8/signalsandslots.html">https://doc.qt.io/qt-4.8/signalsandslots.html</a>). The file is considered as defining a Qt object if it contains strings <em>Q_OBJECT</em> and either <em>slots:</em> or <em>signals:</em>.</p>
</li>
<li>Removes forward declarations of classes with names <em>Handle(C)</em> or <em>Handle_C</em>, replacing them either by forward declaration of its argument class, or (for files defining Qt objects) <em>#include</em> statement for a header with the name of the argument class and extension .hxx: <div class="fragment"><div class="line"><span class="keyword">class </span>Handle(TColStd_HArray1OfReal); -&gt; #include &lt;TColStd_HArray1OfReal.hxx&gt;</div>
</div><!-- fragment --></li>
<li>Removes <em> #includes </em> of files <em>Handle_...hxx</em> that have disappeared in OCCT 7.0: <div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Handle_Geom_Curve.hxx&gt;</span> -&gt;</div>
</div><!-- fragment --></li>
<li>Removes <em>typedef</em> statements that use <em>Handle</em> macro to generate the name: <div class="fragment"><div class="line"><span class="keyword">typedef</span> NCollection_Handle&lt;Message_Msg&gt; Handle(Message_Msg); -&gt;</div>
</div><!-- fragment --></li>
<li>Converts C-style casts applied to Handles into calls to <em>DownCast()</em> method: <div class="fragment"><div class="line">((Handle(A)&amp;)b)     -&gt; Handle(A)::DownCast(b)</div>
<div class="line">(Handle(A)&amp;)b       -&gt; Handle(A)::DownCast(b)</div>
<div class="line">(*((Handle(A)*)&amp;b)) -&gt; Handle(A)::DownCast(b)</div>
<div class="line">*((Handle(A)*)&amp;b)   -&gt; Handle(A)::DownCast(b)</div>
<div class="line">(*(Handle(A)*)&amp;b)   -&gt; Handle(A)::DownCast(b)</div>
</div><!-- fragment --></li>
<li>Moves <em>Handle()</em> macro out of namespace scope: <div class="fragment"><div class="line">Namespace::Handle(Class) -&gt; Handle(Namespace::Class)</div>
</div><!-- fragment --></li>
<li>Converts local variables of reference type, which are initialized by a temporary object returned by call to <em>DownCast()</em>, to the variables of non-reference type (to avoid using references to destroyed memory): <div class="fragment"><div class="line"><span class="keyword">const</span> Handle(A)&amp; a = Handle(B)::DownCast (b); -&gt; Handle(A) a (Handle(B)::DownCast (b));</div>
</div><!-- fragment --></li>
<li>Adds <em>#include</em> for all classes used as argument to macro <em>STANDARD_TYPE()</em>, except for already included ones;</li>
<li><p class="startli">Removes uses of obsolete macros <em>IMPLEMENT_DOWNCAST</em> and <em>IMPLEMENT_STANDARD_</em>..., except <em>IMPLEMENT_STANDARD_RTTIEXT</em>.</p>
<dl class="section note"><dt>Note</dt><dd>If you plan to keep compatibility of your code with older versions of OCCT, add option <em>-compat</em> to avoid this change. See also <a class="el" href="occt__upgrade.html#upgrade_occt700_cdl_compat">Preserving compatibility with OCCT 6.x</a>.</dd></dl>
</li>
</ol>
<p>As long as the upgrade routine runs, some information messages are sent to the standard output. In some cases the warnings or errors like the following may appear:</p>
<div class="fragment"><div class="line">Error in {HEADER_FILE}: Macro DEFINE_STANDARD_RTTI used for class {CLASS_NAME} whose declaration is not found in this file, cannot fix</div>
</div><!-- fragment --><p>Be sure to check carefully all reported errors and warnings, as the corresponding code will likely require manual corrections. In some cases these messages may help you to detect errors in your code, for instance, cases where <em>DEFINE_STANDARD_RTTI</em> macro is used with incorrect class name as an argument.</p>
<h3><a class="anchor" id="upgrade_occt700_cdl_compiler"></a>
Possible compiler errors</h3>
<p>Some situations requiring upgrade cannot be detected and / or handled by the automatic procedure. If you get compiler errors or warnings when trying to build the upgraded code, you will need to fix them manually. The following paragraphs list known situations of this kind.</p>
<h3><a class="anchor" id="autotoc_md38"></a>
Missing header files</h3>
<p>The use of handle objects (construction, comparison using operators == or !=, use of function <em>STANDRAD_TYPE()</em> and method <em>DownCast()</em>) now requires the type of the object pointed by Handle to be completely known at compile time. Thus it may be necessary to include header of the corresponding class to make the code compilable.</p>
<p>For example, the following lines will fail to compile if <em>Geom_Line.hxx</em> is not included:</p>
<div class="fragment"><div class="line">Handle(Geom_Line) aLine = 0;</div>
<div class="line"><span class="keywordflow">if</span> (aLine != aCurve) {...} </div>
<div class="line"><span class="keywordflow">if</span> (aCurve-&gt;IsKind(STANDARD_TYPE(Geom_Line)) {...}</div>
<div class="line">aLine = Handle(Geom_Line)::DownCast (aCurve);</div>
</div><!-- fragment --><p>Note that it is not necessary to include header of the class to declare Handle to it. However, if you define a class <em>B</em> that uses Handle(<em>A</em>) in its fields, or contains a method returning Handle(<em>A</em>), it is advisable to have header defining <em>A</em> included in the header of <em>B</em>. This will eliminate the need to include the header <em>A</em> in each source file where class <em>B</em> is used.</p>
<h3><a class="anchor" id="autotoc_md39"></a>
Ambiguity of calls to overloaded functions</h3>
<p>This issue appears in the compilers that do not support default arguments in template functions (known cases are Visual C++ 10 and 11): the compiler reports an ambiguity error if a handle is used in the argument of a call to the function that has two or more overloaded versions, receiving handles to different types. The problem is that operator <em> const handle&lt;T2&gt;&amp; </em> is defined for any type <em>T2</em>, thus the compiler cannot make the right choice.</p>
<p>Example: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> func (<span class="keyword">const</span> Handle(Geom_Curve)&amp;);</div>
<div class="line"><span class="keywordtype">void</span> func (<span class="keyword">const</span> Handle(Geom_Surface)&amp;);</div>
<div class="line"> </div>
<div class="line">Handle(Geom_TrimmedCurve) aCurve = <span class="keyword">new</span> Geom_TrimmedCurve (...);</div>
<div class="line">func (aCurve); <span class="comment">// ambiguity error in VC++ 10</span></div>
</div><!-- fragment --><p>Note that this problem can be avoided in many cases if macro <em>OCCT_HANDLE_NOCAST</em> is used, see <a class="el" href="occt__upgrade.html#upgrade_occt700_cdl_nocast">below</a>.</p>
<p>To resolve this ambiguity, change your code so that argument type should correspond exactly to the function signature. In some cases this can be done by using the relevant type for the corresponding variable, like in the example above:</p>
<div class="fragment"><div class="line">Handle(Geom_Curve) aCurve = <span class="keyword">new</span> Geom_TrimmedCurve (...);  </div>
</div><!-- fragment --><p>Other variants consist in assigning the argument to a local variable of the correct type and using the direct cast or constructor:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> Handle(Geom_Curve)&amp; aGCurve (aTrimmedCurve);</div>
<div class="line">func (aGCurve); <span class="comment">// OK - argument has exact type</span></div>
<div class="line">func (static_cast(aCurve)); <span class="comment">// OK - direct cast </span></div>
<div class="line">func (Handle(Geom_Curve)(aCurve)); <span class="comment">// OK - temporary handle is constructed</span></div>
</div><!-- fragment --><p>Another possibility consists in defining additional template variant of the overloaded function causing ambiguity, and using <em>SFINAE</em> to resolve the ambiguity. This technique can be illustrated by the definition of the template variant of method <em>IGESData_IGESWriter::Send()</em>.</p>
<h3><a class="anchor" id="autotoc_md40"></a>
Lack of implicit cast to base type</h3>
<p>As the cast of a handle to the reference to another handle to the base type has become a user-defined operation, the conversions that require this cast together with another user-defined cast will not be resolved automatically by the compiler.</p>
<p>For example:</p>
<div class="fragment"><div class="line">Handle(Geom_Geometry) aC = GC_MakeLine (p, v); <span class="comment">// compiler error</span></div>
</div><!-- fragment --><p>The problem is that the class <em>GC_MakeLine</em> has a user-defined conversion to <em>const Handle(Geom_TrimmedCurve)&amp;,</em> which is not the same as the type of the local variable <em>aC</em>.</p>
<p>To resolve this, use method <em>Value()</em>:</p>
<div class="fragment"><div class="line">Handle(Geom_Geometry) aC = GC_MakeLine (p, v).Value(); <span class="comment">// ok</span></div>
</div><!-- fragment --><p>or use variable of the appropriate type:</p>
<div class="fragment"><div class="line">Handle(Geom_TrimmedCurve) aC = GC_MakeLine (p, v); <span class="comment">// ok</span></div>
</div><!-- fragment --><p>A similar problem appears with GCC compiler, when <em>const</em> handle to derived type is used to construct handle to base type via assignment (and in some cases in return statement), for instance:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> Handle(Geom_Line) aLine;</div>
<div class="line">Handle(Geom_Curve) c1 = aLine; <span class="comment">// GCC error </span></div>
<div class="line">Handle(Geom_Curve) c2 (aLine); <span class="comment">// ok</span></div>
</div><!-- fragment --><p>This problem is specific to GCC and it does not appear if macro <em>OCCT_HANDLE_NOCAST</em> is used, see <a class="el" href="occt__upgrade.html#upgrade_occt700_cdl_nocast">below</a>.</p>
<h3><a class="anchor" id="autotoc_md41"></a>
Incorrect use of STANDARD_TYPE and Handle macros</h3>
<p>You might need to clean your code from incorrect use of macros <em>STANDARD_TYPE</em>() and <em>Handle</em>().</p>
<ol type="1">
<li><p class="startli">Explicit definitions of static functions with names generated by macro <em>STANDARD_TYPE()</em>, which are artifacts of old implementation of RTTI, should be removed.</p>
<p class="startli">Example: </p><div class="fragment"><div class="line"><span class="keyword">const</span> Handle(Standard_Type)&amp; STANDARD_TYPE(math_GlobOptMin)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">static</span> Handle(Standard_Type) _atype = <span class="keyword">new</span> Standard_Type (<span class="stringliteral">&quot;math_GlobOptMin&quot;</span>, <span class="keyword">sizeof</span> (math_GlobOptMin));</div>
<div class="line">  <span class="keywordflow">return</span> _atype;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli">Incorrect location of closing parenthesis of <em>Handle()</em> macro that was not detectable in OCCT 6.x will cause a compiler error and must be corrected.</p>
<p class="startli">Example (note misplaced closing parenthesis): </p><div class="fragment"><div class="line">aBSpline = Handle( Geom2d_BSplineCurve::DownCast(BS-&gt;Copy()) );</div>
</div><!-- fragment --></li>
</ol>
<h3><a class="anchor" id="autotoc_md42"></a>
Use of class Standard_AncestorIterator</h3>
<p>Class <em>Standard_AncestorIterator</em> has been removed; use method <em>Parent()</em> of <em>Standard_Type</em> class to parse the inheritance chain.</p>
<h3><a class="anchor" id="autotoc_md43"></a>
Absence of cast to Standard_Transient*</h3>
<p>Handles in OCCT 7.0 do not have the operator of conversion to <em>Standard_Transient*,</em> which was present in earlier versions. This is done to prevent possible unintended errors like this:</p>
<div class="fragment"><div class="line">Handle(Geom_Line) aLine = ...;</div>
<div class="line">Handle(Geom_Surface) aSurf = ...;</div>
<div class="line">...</div>
<div class="line">if (aLine == aSurf) {...} <span class="comment">// will cause a compiler error in OCCT 7.0, but not OCCT 6.x</span></div>
</div><!-- fragment --><p>The places where this implicit cast has been used should be corrected manually. The typical situation is when Handle is passed to stream:</p>
<div class="fragment"><div class="line">Handle(Geom_Line) aLine = ...;</div>
<div class="line">os &lt;&lt; aLine; <span class="comment">// in OCCT 6.9.0, resolves to operator &lt;&lt; (void*) </span></div>
</div><!-- fragment --><p>Call method <em>get()</em> explicitly to output the address of the Handle.</p>
<h3><a class="anchor" id="autotoc_md44"></a>
Method DownCast for non-base types</h3>
<p>Method <em>DownCast()</em> in OCCT 7.0 is made templated; if its argument is not a base class, "deprecated" compiler warning is generated. This is done to prevent possible unintended errors like this:</p>
<div class="fragment"><div class="line">Handle(Geom_Surface) aSurf = ;</div>
<div class="line">Handle(Geom_Line) aLine = </div>
<div class="line">  Handle(Geom_Line)::DownCast (aSurf); <span class="comment">// will cause a compiler warning in OCCT 7.0, but not OCCT 6.x</span></div>
</div><!-- fragment --><p>The places where this cast has been used should be corrected manually.</p>
<p>If down casting is used in a template context where the argument can have the same or unrelated type so that <em>DownCast()</em> may be not available in all cases, use C++ <em>dynamic_cast&lt;&gt;</em> instead, e.g.:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;</div>
<div class="line"><span class="keywordtype">bool</span> CheckLine (<span class="keyword">const</span> Handle(T) theArg)</div>
<div class="line">{</div>
<div class="line">  Handle(Geom_Line) aLine = <span class="keyword">dynamic_cast&lt;</span>Geom_Line<span class="keyword">&gt;</span> (theArg.get());</div>
<div class="line">  ...</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="upgrade_occt700_cdl_runtime"></a>
Possible runtime problems</h3>
<p>Here is the list of known possible problems at run time after the upgrade to OCCT 7.0.</p>
<h3><a class="anchor" id="autotoc_md45"></a>
References to temporary objects</h3>
<p>In previous versions, the compiler was able to detect the situation when a local variable of a "reference to a Handle" type is initialized by temporary object, and ensured that lifetime of that object is longer than that of the variable. In OCCT 7.0 with default options, it will not work if types of the temporary object and variable are different (due to involvement of user-defined type cast), thus such temporary object will be destroyed immediately.</p>
<p>This problem does not appear if macro <em>OCCT_HANDLE_NOCAST</em> is used during compilation, see below.</p>
<p>Example:</p>
<div class="fragment"><div class="line"><span class="comment">// note that DownCast() returns new temporary object!</span></div>
<div class="line"><span class="keyword">const</span> Handle(Geom_BoundedCurve)&amp; aBC =</div>
<div class="line">Handle(Geom_TrimmedCurve)::DownCast(aCurve);</div>
<div class="line">aBC-&gt;Transform (T); <span class="comment">// access violation in OCCT 7.0</span></div>
</div><!-- fragment --><h3><a class="anchor" id="upgrade_occt700_cdl_nocast"></a>
Option to avoid cast of handle to reference to base type</h3>
<p>In OCCT 6.x and earlier versions the handle classes formed a hierarchy echoing the hierarchy of the corresponding object classes . This automatically enabled the possibility to use the handle to a derived class in all contexts where the handle to a base class was needed, e.g. to pass it in a function by reference without copying:</p>
<div class="fragment"><div class="line">Standard_Boolean GetCurve (Handle(Geom_Curve)&amp; theCurve);</div>
<div class="line">....</div>
<div class="line">Handle(Geom_Line) aLine;</div>
<div class="line"><span class="keywordflow">if</span> (GetCurve (aLine)) {</div>
<div class="line">  <span class="comment">// use aLine, unsafe</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>This feature was used in multiple places in OCCT and dependent projects. However it is potentially unsafe: in the above example no checks are done at compile time or at run time to ensure that the type assigned to the argument handle is compatible with the type of the handle passed as argument. If an object of incompatible type (e.g. Geom_Circle) is assigned to <em>theCurve</em>, the behavior will be unpredictable.</p>
<p>For compatibility with the existing code, OCCT 7.0 keeps this possibility by default, providing operators of type cast to the handle to a base type. However, this feature is unsafe and in specific situations it may cause compile-time or run-time errors as described above.</p>
<p>To provide a safer behavior, this feature can be disabled by a compile-time macro <em>OCCT_HANDLE_NOCAST</em>. When it is used, constructors and assignment operators are defined (instead of type cast operators) to convert handles to a derived type into handles to a base type. This implies creation of temporary objects and hence may be more expensive at run time in some circumstances, however this way is more standard, safer, and in general recommended.</p>
<p>The code that relies on the possibility of casting to base should be amended to always use the handle of argument type in function call and to use <em>DownCast()</em> to safely convert the result to the desired type. For instance, the code from the example below can be changed as follows:</p>
<div class="fragment"><div class="line">Handle(Geom_Line) aLine;</div>
<div class="line">Handle(Geom_Curve) aCurve;</div>
<div class="line"><span class="keywordflow">if</span> (GetCurve (aCure) &amp;&amp; !(aLine = Handle(Geom_Line)::DownCast (aCurve)).IsNull()) {</div>
<div class="line">  <span class="comment">// use aLine safely</span></div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="upgrade_occt700_cdl_compat"></a>
Preserving compatibility with OCCT 6.x</h3>
<p>If you like to preserve the compatibility of your application code with OCCT versions 6.x even after the upgrade to 7.0, consider the following suggestions:</p>
<ol type="1">
<li>If your code used sequences of macros <em>IMPLEMENT_STANDARD_</em>... generated by WOK, replace them by single macro <em>IMPLEMENT_STANDARD_RTTIEXT</em></li>
<li>When running automatic upgrade tool, add option <em>-compat</em>.</li>
<li><p class="startli">Define macros <em>DEFINE_STANDARD_RTTIEXT</em> and <em>DEFINE_STANDARD_RTTI_INLINE</em> when building with previous versions of OCCT, resolving to <em>DEFINE_STANDARD_RTTI</em> with single argument</p>
<p class="startli">Example: </p><div class="fragment"><div class="line"><span class="preprocessor">#if OCC_VERSION_HEX &lt; 0x070000</span></div>
<div class="line"><span class="preprocessor">  #define DEFINE_STANDARD_RTTIEXT(C1,C2) DEFINE_STANDARD_RTTI(C1)</span></div>
<div class="line"><span class="preprocessor">  #define DEFINE_STANDARD_RTTI_INLINE(C1,C2) DEFINE_STANDARD_RTTI(C1)</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --></li>
</ol>
<h3><a class="anchor" id="upgrade_occt700_cdl_wok"></a>
Applications based on CDL and WOK</h3>
<p>If your application is essentially based on CDL, and you need to upgrade it to OCCT 7.0, you will very likely need to convert your application code to non-CDL form. This is a non-trivial effort; the required actions would depend strongly on the structure of the code and used CDL features.</p>
<p>The upgrade script and sources of a specialized WOK version used for OCCT code upgrade can be found in WOK Git repository in branch <a href="https://git.dev.opencascade.org/gitweb/?p=occt-wok.git;a=log;h=refs/heads/CR0_700_2">CR0_700_2</a>.</p>
<p><a href="https://www.opencascade.com/contact/">Contact us</a> if you need more help.</p>
<h2><a class="anchor" id="upgrade_occt700_bspline"></a>
Separation of BSpline cache</h2>
<p>Implementation of NURBS curves and surfaces has been revised: the cache of polynomial coefficients, which is used to accelerate the calculation of values of a B-spline, has been separated from data objects <em>Geom2d_BSplineCurve, Geom_BSplineCurve</em> and <em>Geom_BSplineSurface</em> into the dedicated classes <em>BSplCLib_Cache</em> and <em>BSplSLib_Cache</em>.</p>
<p>The benefits of this change are:</p><ul>
<li>Reduced memory footprint of OCCT shapes (up to 20% on some cases)</li>
<li>Possibility to evaluate the same B-Spline concurrently in parallel threads without data races and mutex locks</li>
</ul>
<p>The drawback is that direct evaluation of B-Splines using methods of curves and surfaces becomes slower due to the absence of cache. The slow-down can be avoided by using adaptor classes <em>Geom2dAdaptor_Curve, GeomAdaptor_Curve</em> and <em>GeomAdaptor_Surface</em>, which now use cache when the curve or surface is a B-spline.</p>
<p>OCCT algorithms have been changed to use adaptors for B-spline calculations instead of direct methods for curves and surfaces. The same changes (use of adaptors instead of direct call to curve and surface methods) should be implemented in relevant places in the applications based on OCCT to get the maximum performance.</p>
<h2><a class="anchor" id="upgrade_occt700_booleanresult"></a>
Structural result of Boolean operations</h2>
<p>The result of Boolean operations became structured according to the structure of the input shapes. Therefore it may impact old applications that always iterate on direct children of the result compound assuming to obtain solids as iteration items, regardless of the structure of the input shapes. In order to get always solids as iteration items it is recommended to use TopExp_Explorer instead of TopoDS_Iterator.</p>
<h2><a class="anchor" id="upgrade_occt700_brepextrema"></a>
BRepExtrema_ExtCC finds one solution only</h2>
<p>Extrema computation between non-analytical curves in shape-shape distance calculation algorithm has been changed in order to return only one solution. So, if e.g. two edges are created on parallel b-spline curves the algorithm BRepExtrema_DistShapeShape will return only one solution instead of enormous number of solutions. There is no way to get algorithm working in old manner.</p>
<h2><a class="anchor" id="upgrade_occt700_sorttools"></a>
Removal of SortTools package</h2>
<p>Package <em>SortTools</em> has been removed. The code that used the tools provided by that package should be corrected manually. The recommended approach is to use sorting algorithms provided by STL.</p>
<p>For instance: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;SortTools_StraightInsertionSortOfReal.hxx&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;SortTools_ShellSortOfReal.hxx&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;TCollection_CompareOfReal.hxx&gt;</span></div>
<div class="line">...</div>
<div class="line">TCollection_Array1OfReal aValues = ...;</div>
<div class="line">...</div>
<div class="line">TCollection_CompareOfReal aCompReal;</div>
<div class="line">SortTools_StraightInsertionSortOfReal::Sort(aValues, aCompReal);</div>
</div><!-- fragment --><p>can be replaced by: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line">...</div>
<div class="line">TCollection_Array1OfReal aValues = ...;</div>
<div class="line">...</div>
<div class="line">std::stable_sort (aValues.begin(), aValues.end());</div>
</div><!-- fragment --><h2><a class="anchor" id="upgrade_occt700_2dlayers"></a>
On-screen objects and ColorScale</h2>
<p>The old mechanism for rendering Underlay and Overlay on-screen 2D objects based on <em>Visual3d_Layer</em> and immediate drawing model (uncached and thus slow) has been removed. Classes <em>Aspect_Clayer2d, OpenGl_GraphicDriver_Layer, Visual3d_Layer, Visual3d_LayerItem, V3d_LayerMgr</em> and <em>V3d_LayerMgrPointer</em> have been deleted. The following auxiliary definition have been removed as well: Aspect_TypeOfPrimitive, Aspect_TypeOfLayer, Aspect_TypeOfEdge, Aspect_TypeOfDrawMode, Aspect_TypeOfConstraint, Aspect_DriverDefinitionError, Aspect_BadAccess.</p>
<p>General AIS interactive objects with transformation persistence flag <em>Graphic3d_TMF_2d</em> can be used as a replacement of <em>Visual3d_LayerItem</em>. The anchor point specified for transformation persistence defines the window corner of (or center in case of (0, 0) point). To keep on-screen 2D objects on top of the main screen, they can be assigned to the appropriate Z-layer. Predefined Z-layers <em>Graphic3d_ZLayerId_TopOSD</em> and <em>Graphic3d_ZLayerId_BotOSD</em> are intended to replace Underlay and Overlay layers within the old API.</p>
<p><em>ColorScale</em> object previously implemented using <em>Visual3d_LayerItem</em> has been moved to a new class <em>AIS_ColorScale</em>, with width and height specified explicitly. The property of <em>V3d_View</em> storing the global <em>ColorScale</em> object has been removed with associated methods <em>V3d_View::ColorScaleDisplay(), V3d_View::ColorScaleErase(), V3d_View::ColorScaleIsDisplayed()</em> and <em>V3d_View::ColorScale()</em> as well as the classes <em>V3d_ColorScale, V3d_ColorScaleLayerItem</em> and <em>Aspect_ColorScale</em>. Here is an example of creating <em>ColorScale</em> using the updated API:</p>
<div class="fragment"><div class="line">Handle(AIS_ColorScale) aCS = <span class="keyword">new</span> AIS_ColorScale();</div>
<div class="line"><span class="comment">// configuring</span></div>
<div class="line">Standard_Integer aWidth, aHeight;</div>
<div class="line">aView-&gt;Window()-&gt;Size (aWidth, aHeight);</div>
<div class="line">aCS-&gt;SetSize              (aWidth, aHeight);</div>
<div class="line">aCS-&gt;SetRange             (0.0, 10.0);</div>
<div class="line">aCS-&gt;SetNumberOfIntervals (10);</div>
<div class="line"><span class="comment">// displaying</span></div>
<div class="line">aCS-&gt;SetZLayer (Graphic3d_ZLayerId_TopOSD);</div>
<div class="line">aCS-&gt;SetTransformPersistence (Graphic3d_TMF_2d, gp_Pnt (-1,-1,0));</div>
<div class="line">aCS-&gt;SetToUpdate();</div>
<div class="line">theContextAIS-&gt;Display (aCS);</div>
</div><!-- fragment --><p>To see how 2d objects are implemented in OCCT you can call Draw commands <em>vcolorscale, vlayerline</em> or <em>vdrawtext</em> (with <em>-2d</em> option). Draw command <em>vcolorscale</em> now requires the name of <em>ColorScale</em> object as argument. To display this object use command <em>vdisplay</em>. For example:</p>
<div class="fragment"><div class="line">pload VISUALIZATION</div>
<div class="line">vinit</div>
<div class="line">vcolorscale cs -demo</div>
<div class="line">pload MODELING</div>
<div class="line">box b 100 100 100</div>
<div class="line">vdisplay b</div>
<div class="line">vsetdispmode 1</div>
<div class="line">vfit</div>
<div class="line">vlayerline 0 300 300 300 10</div>
<div class="line">vdrawtext t <span class="stringliteral">&quot;2D-TEXT&quot;</span> -2d -pos 0 150 0 -color red</div>
</div><!-- fragment --><p>Here is a small example in C++ illustrating how to display a custom AIS object in 2d: </p><div class="fragment"><div class="line">Handle(AIS_InteractiveContext) aContext = ...;</div>
<div class="line">Handle(AIS_InteractiveObject) anObj =...; <span class="comment">// create an AIS object</span></div>
<div class="line">anObj-&gt;SetZLayer(Graphic3d_ZLayerId_TopOSD); <span class="comment">// display object in overlay</span></div>
<div class="line">anObj-&gt;SetTransformPersistence (Graphic3d_TMF_2d, gp_Pnt (-1,-1,0)); <span class="comment">// set 2d flag, coordinate origin is set to down-left corner</span></div>
<div class="line">aContext-&gt;Display (anObj); <span class="comment">// display the object</span></div>
</div><!-- fragment --><h2><a class="anchor" id="upgrade_occt700_userdraw"></a>
UserDraw and Visual3d</h2>
<h3><a class="anchor" id="autotoc_md46"></a>
Visual3d package</h3>
<p>Package <em>Visual3d</em> implementing the intermediate layer between high-level <em>V3d</em> classes and low-level OpenGl classes for views and graphic structures management has been dropped.</p>
<p>The <em>OpenGl_View</em> inherits from the new class <em>Graphic3d_CView</em>. <em>Graphic3d_CView</em> is an interface class that declares abstract methods for managing displayed structures, display properties and a base layer code that implements computation and management of HLR (or more broadly speaking view-depended) structures.</p>
<p>In the new implementation it takes place of the eliminated <em>Visual3d_View</em>. As before the instance of <em>Graphic3d_CView</em> is still completely managed by <em>V3d_View</em> classes. It can be accessed through <em>V3d_View</em> interface but normally it should not be required as all its methods are completely wrapped.</p>
<p>In more details, a concrete specialization of <em>Graphic3d_CView</em> is created and returned by the graphical driver on request. Right after the creation the views are directly used for setting rendering properties and adding graphical structures to be displayed.</p>
<p>The rendering of graphics is possible after mapping a window and activating the view. The direct setting of properties obsoletes the use of intermediate structures with display parameter like <em>Visual3d_ContextView</em>, etc. This means that the whole package <em>Visual3d</em> becomes redundant.</p>
<p>The functionality previously provided by <em>Visual3d</em> package has been redesigned in the following way :</p><ul>
<li>The management of display of structures has been moved from <em>Visual3d_ViewManager</em> into <em>Graphic3d_StructureManager</em>.</li>
<li>The class <em>Visual3d_View</em> has been removed. The management of computed structures has been moved into the base layer of <em>Graphi3d_CView</em>.</li>
<li>All intermediate structures for storing view parameters, e.g. <em>Visual3d_ContextView</em>, have been removed. The settings are now kept by instances of <em>Graphic3d_CView</em>.</li>
<li>The intermediate class <em>Visual3d_Light</em> has been removed. All light properties are stored in <em>Graphic3d_CLight</em> structure, which is directly accessed by instances of <em>V3d_Light</em> classes.</li>
<li>All necessary enumerations have been moved into <em>Graphic3d</em> package.</li>
</ul>
<h3><a class="anchor" id="autotoc_md47"></a>
Custom OpenGL rendering and UserDraw</h3>
<p>Old APIs based on global callback functions for creating <em>UserDraw</em> objects and for performing custom OpenGL rendering within the view have been dropped. <em>UserDraw</em> callbacks are no more required since <em>OpenGl_Group</em> now inherits <em>Graphic3d_Group</em> and thus can be accessed directly from <em>AIS_InteractiveObject</em>:</p>
<div class="fragment"><div class="line"><span class="comment">//! Class implementing custom OpenGL element.</span></div>
<div class="line"><span class="comment"></span><span class="keyword">class </span>UserDrawElement : <span class="keyword">public</span> OpenGl_Element {};</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">//! Implementation of virtual method AIS_InteractiveObject::Compute().</span></div>
<div class="line"><span class="comment"></span><span class="keywordtype">void</span> UserDrawObject::Compute (<span class="keyword">const</span> Handle(PrsMgr_PresentationManager)&amp; thePrsMgr,</div>
<div class="line">                              <span class="keyword">const</span> Handle(Prs3d_Presentation)&amp; thePrs,</div>
<div class="line">                              <span class="keyword">const</span> Standard_Integer theMode)</div>
<div class="line">{</div>
<div class="line">  Graphic3d_Vec4 aBndMin (myCoords[0], myCoords[1], myCoords[2], 1.0f);</div>
<div class="line">  Graphic3d_Vec4 aBndMax (myCoords[3], myCoords[4], myCoords[5], 1.0f);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// casting to OpenGl_Group should be always true as far as application uses OpenGl_GraphicDriver for rendering</span></div>
<div class="line">  Handle(OpenGl_Group) aGroup = Handle(OpenGl_Group)::DownCast (thePrs-&gt;NewGroup());</div>
<div class="line">  aGroup-&gt;SetMinMaxValues (aBndMin.x(), aBndMin.y(), aBndMin.z(),</div>
<div class="line">                           aBndMax.x(), aBndMax.y(), aBndMax.z());</div>
<div class="line">  UserDrawElement* anElem = <span class="keyword">new</span> UserDrawElement (<span class="keyword">this</span>);</div>
<div class="line">  aGroup-&gt;AddElement(anElem);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// invalidate bounding box of the scene</span></div>
<div class="line">  thePrsMgr-&gt;StructureManager()-&gt;Update();</div>
<div class="line">}</div>
</div><!-- fragment --><p>To perform a custom OpenGL code within the view, it is necessary to inherit from class <em>OpenGl_View</em>. See the following code sample:</p>
<div class="fragment"><div class="line"><span class="comment">//! Custom view.</span></div>
<div class="line"><span class="comment"></span><span class="keyword">class </span>UserView : <span class="keyword">public</span> OpenGl_View</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><span class="comment">  //! Override rendering into the view.</span></div>
<div class="line"><span class="comment"></span>  <span class="keyword">virtual</span> <span class="keywordtype">void</span> render (Graphic3d_Camera::Projection theProjection,</div>
<div class="line">                       OpenGl_FrameBuffer*          theReadDrawFbo,</div>
<div class="line">                       <span class="keyword">const</span> Standard_Boolean       theToDrawImmediate)</div>
<div class="line">  {</div>
<div class="line">    OpenGl_View::render (theProjection, theReadDrawFbo, theToDrawImmediate);</div>
<div class="line">    <span class="keywordflow">if</span> (theToDrawImmediate)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// perform custom drawing</span></div>
<div class="line">    <span class="keyword">const</span> Handle(OpenGl_Context)&amp; aCtx = myWorkspace-&gt;GetGlContext();</div>
<div class="line">    GLfloat aVerts[3] = { 0.0f, 0,0f, 0,0f };</div>
<div class="line">    aCtx-&gt;core20-&gt;glEnableClientState(GL_VERTEX_ARRAY);</div>
<div class="line">    aCtx-&gt;core20-&gt;glVertexPointer(3, GL_FLOAT, 0, aVerts);</div>
<div class="line">    aCtx-&gt;core20-&gt;glDrawArrays(GL_POINTS, 0, 1);</div>
<div class="line">    aCtx-&gt;core20-&gt;glDisableClientState(GL_VERTEX_ARRAY);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">};</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">//! Custom driver for creating UserView.</span></div>
<div class="line"><span class="comment"></span><span class="keyword">class </span>UserDriver : <span class="keyword">public</span> OpenGl_GraphicDriver</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><span class="comment">  //! Create instance of own view.</span></div>
<div class="line"><span class="comment"></span>  <span class="keyword">virtual</span> Handle(Graphic3d_CView) CreateView (<span class="keyword">const</span> Handle(Graphic3d_StructureManager)&amp; theMgr) Standard_OVERRIDE</div>
<div class="line">  {</div>
<div class="line">    Handle(UserView) aView = <span class="keyword">new</span> UserView (theMgr, <span class="keyword">this</span>, myCaps, myDeviceLostFlag, &amp;myStateCounter);</div>
<div class="line">    myMapOfView.Add (aView);</div>
<div class="line">    <span class="keywordflow">for</span> (TColStd_SequenceOfInteger::Iterator aLayerIt (myLayerSeq); aLayerIt.More(); aLayerIt.Next())</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">const</span> Graphic3d_ZLayerId        aLayerID  = aLayerIt.Value();</div>
<div class="line">      <span class="keyword">const</span> Graphic3d_ZLayerSettings&amp; aSettings = myMapOfZLayerSettings.Find (aLayerID);</div>
<div class="line">      aView-&gt;AddZLayer         (aLayerID);</div>
<div class="line">      aView-&gt;SetZLayerSettings (aLayerID, aSettings);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> aView;</div>
<div class="line">  }</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="upgrade_occt700_localcontext"></a>
Deprecation of Local Context</h2>
<p>The conception of Local Context has been deprecated. The related classes, e.g. <em>AIS_LocalContext</em>, and methods ( <em>AIS_InteractiveContext::OpenLocalContext()</em> and others) will be removed in a future OCCT release.</p>
<p>The main functionality provided by Local Context - selection of object subparts - can be now used within Neutral Point without opening any Local Context.</p>
<p>The property <em>SelectionMode()</em> has been removed from the class <em>AIS_InteractiveObject</em>. This property contradicts to selection logic, since it is allowed to activate several Selection modes at once. Therefore keeping one selection mode as object field makes no sense. Applications that used this method should implement selection mode caching at application level, if it is necessary for some reason.</p>
<h2><a class="anchor" id="upgrade_occt700_separate_caf_visualisation"></a>
Separation of visualization part from TKCAF</h2>
<p>Visualization CAF attributes have been moved into a new toolkit <em>TKVCAF</em>. If your application uses the classes from <em>TPrsStd</em> package then add link to <em>TKVCAF</em> library.</p>
<p>Version numbers of <em>BinOCAF</em> and <em>XmlOCAF</em> formats are incremented; new files cannot be read by earlier versions of OCCT.</p>
<p>Before loading the OCAF files saved by previous versions and containing <em>TPrsStd_AISPresentation</em> attribute it is necessary to define the environment variable <em>CSF_MIGRATION_TYPES</em>, pointing to file <em>src/StdResources/MigrationSheet.txt</em>. When using documents loaded from a file, make sure to call method <em>TPrsStd_AISViewer::New()</em> prior to accessing <em>TPrsStd_AISPresentation</em> attributes in this document as that method creates them.</p>
<h2><a class="anchor" id="upgrade_euler_angles"></a>
Correction of interpretation of Euler angles in gp_Quaternion</h2>
<p>Conversion of <em>gp_Quaternion</em> to and from intrinsic Tait-Bryan angles (including <em>gp_YawPitchRoll</em>) is fixed.</p>
<p>Before that fix the sequence of rotation axes was opposite to the intended; e.g. <em>gp_YawPitchRoll</em> (equivalent to <em>gp_Intrinsic_ZYX</em>) actually defined intrinsic rotations around X, then Y, then Z. Now the rotations are made in the correct order.</p>
<p>The applications that use <em>gp_Quaternion</em> to convert Yaw-Pitch-Roll angles (or other intrinsic Tait-Bryan sequences) may need to be updated to take this change into account.</p>
<h2><a class="anchor" id="upgrade_zoom_persistent_selection"></a>
Zoom Persistent Selection</h2>
<p>Zoom persistent selection introduces a new structure <em>Graphic3d_TransformPers</em> to transform persistence methods and parameters and a new class <em>Graphic3d_WorldViewProjState</em> to refer to the camera transformation state. You might need to update your code to deal with the new classes if you were using the related features. Keep in mind the following:</p><ul>
<li><em>Graphic3d_Camera::ModelViewState</em> has been renamed to <em>Graphic3d_Camera::WorldViewState</em>.</li>
<li>Transformation matrix utilities from <em>OpenGl_Utils</em> namespace have been moved to <em>Graphic3d_TransformUtils</em> and <em>Graphic3d_TransformUtils.hxx</em> header respectively.</li>
<li>Matrix stack utilities from <em>OpenGl_Utils</em> namespace have been moved to <em>OpenGl_MatrixStack</em> class and <em>OpenGl_MatrixStack.hxx</em> header respectively.</li>
<li><em>OpenGl_View</em> methods <em>Begin/EndTransformPersistence</em> have been removed. Use <em>Graphic3d_TransformPers::Apply()</em> instead to apply persistence to perspective and world-view projection matrices.</li>
</ul>
<h2><a class="anchor" id="upgrade_occt700_correction_of_texture"></a>
Texture mapping of objects</h2>
<p>Textured objects now have the priority over the environment mapping.</p>
<p>Redundant enumerations <em>V3d_TypeOfSurface</em> and <em>Graphic3d_TypeOfSurface</em>, class <em>OpenGl_SurfaceDetailState</em>, the corresponding methods from <em>Graphic3d_CView, OpenGl_ShaderManager, OpenGl_View, V3d_View</em> and <em>V3d_Viewer</em> have been deleted. Draw command <em>VSetTextureMode</em> has been deleted.</p>
<h2><a class="anchor" id="upgrade_occt700_wfshape"></a>
Shape presentation builders</h2>
<p>Presentation tools for building Wireframe presentation have been refactored to eliminate duplicated code and interfaces. Therefore, the following classes have been modified:</p><ul>
<li><em>StdPrs_WFDeflectionShape</em> and <em>Prs3d_WFShape</em> have been removed. <em>StdPrs_WFShape</em> should be used instead.</li>
<li><em>StdPrs_ToolShadedShape</em> has been renamed to <em>StdPrs_ToolTriangulatedShape</em>.</li>
</ul>
<h1><a class="anchor" id="upgrade_occt710"></a>
Upgrade to OCCT 7.1.0</h1>
<h2><a class="anchor" id="upgrade_710_aspects"></a>
Presentation attributes</h2>
<p>This section should be considered if application defines custom presentations, i.e. inherited from <em>AIS_InteractiveObject</em>. The previous versions of OCCT have three levels for defining presentation properties (e.g. colors, materials, etc.):</p>
<ol type="1">
<li>For the entire structure - <em>Graphic3d_Structure</em> / <em>Prs3d_Presentation</em>.</li>
<li>For a specific group of primitives - <em>Graphic3d_Group::SetGroupPrimitivesAspect()</em> overriding structure aspects.</li>
<li>For a specific primitive array within the graphic group - <em>Graphic3d_Group::SetPrimitivesAspect()</em>.</li>
</ol>
<p>The structure level has de facto not been used for a long time since OCCT presentations always define aspects at the graphic group level (overriding any structure aspects). Within this OCCT release, structure level of aspects has been completely removed. In most cases the application code should just remove missing methods. In those rare cases, when this functionality was intentionally used, the application should explicitly define aspects to the appropriate graphic groups.</p>
<p>Note that defining several different aspects within the same graphic group should also be avoided in the application code since it is a deprecated functionality which can be removed in further releases. <em>Graphic3d_Group::SetGroupPrimitivesAspect()</em> should be the main method defining presentation attributes.</p>
<p>The implementation of <em>Graphic3d_Group::SetGroupPrimitivesAspect()</em> has been changed from copying aspect values to keeping the passed object. Although it was not documented, previously it was possible to modify a single aspect instance, like <em>Graphic3d_AspectFillArea3d</em> and set it to multiple groups. Now such code would produce an unexpected result and therefore should be updated to create the dedicated aspect instance.</p>
<h2><a class="anchor" id="upgrade_710_types"></a>
Typedefs</h2>
<p>The following type definitions in OCCT has been modified to use C++11 types:</p><ul>
<li><em>Standard_Boolean</em> is now <em>bool</em> (previously <em>unsigned int</em>).</li>
<li><em>Standard_ExtCharacter</em> is now <em>char16_t</em> (previously <em>short</em>).</li>
<li><em>Standard_ExtString;</em> is now <em>const char16_t</em> (previously <em>const short</em>).</li>
<li><em>Standard_Utf16Char</em> is now <em>char16_t</em> (previously <em>uint16_t</em> for compatibility with old compilers).</li>
<li><em>Standard_Utf32Char</em> is now <em>char32_t</em> (previously <em>uint32_t</em> for compatibility with old compilers).</li>
</ul>
<p>For most applications this change should be transparent on the level of source code. Binary compatibility is not maintained, as <em>bool</em> has a different size in comparison with <em>unsigned int</em>.</p>
<h2><a class="anchor" id="upgrade_710_ffp"></a>
Programmable Pipeline</h2>
<p>Fixed-function pipeline has been already deprecated since OCCT 7.0.0. Release 7.1.0 disables this functionality by default in favor of Programmable Pipeline (based on GLSL programs).</p>
<p>Method <em>V3d_View::Export()</em>, based on <em>gl2ps</em> library, requires fixed pipeline and will return error if used with default settings. Applications should explicitly enable fixed pipeline by setting <em>OpenGl_Caps::ffpEnable</em> flag to TRUE within <em>OpenGl_GraphicDriver::ChangeOptions()</em> before creating the viewer to use <em>V3d_View::Export()</em>. This method is declared as deprecated and will be removed in one of the next OCCT releases. The recommended way to generate a vector image of a 3D model or scene is to use an application-level solution independent from OpenGL.</p>
<h2><a class="anchor" id="upgrade_710_trsfpers"></a>
Transformation persistence</h2>
<p>The behavior of transformation persistence flags <em>Graphic3d_TMF_ZoomPers</em> and <em>Graphic3d_TMF_TriedronPers</em> has been changed for consistency with a textured fixed-size 2D text. An object with these flags is considered as defined in pixel units, and the presentation is no more scaled depending on the view height. The applications that need to scale such objects depending on viewport size should update them manually.</p>
<p>Flags <em>Graphic3d_TMF_PanPers</em> and <em>Graphic3d_TMF_FullPers</em> have been removed. <em>Graphic3d_TMF_TriedronPers</em> or <em>Graphic3d_TMF_2d</em> can be used instead depending on the context.</p>
<p><em>Graphic3d_TransModeFlags</em> is not an integer bitmask anymore - enumeration values should be specified instead. Several transformation persistence methods in <em>PrsMgr_PresentableObject</em> have been marked deprecated. Transformation persistence should be defined using <em>Graphic3d_TransformPers</em> constructor directly and passed by a handle, not value.</p>
<h2><a class="anchor" id="upgrade_710_selprops"></a>
Dynamic highlight and selection properties</h2>
<p>Release 7.1.0 introduces <em>Graphic3d_HighlightStyle</em> - an entity that allows flexible customization of highlighting parameters (such as highlighting method, color, and transparency). Therefore, the signatures of the following methods related to highlighting:</p><ul>
<li><em>AIS_InteractiveContext::Hilight()</em>;</li>
<li><em>AIS_InteractiveContext::HilightWithColor()</em>;</li>
<li><em>PrsMgr_PresentationManager::Color()</em>;</li>
<li><em>SelectMgr_EntityOwner::HilightWithColor()</em>; have been changed to receive <em>Graphic3d_HighlightStyle</em> instead of <em>Quantity_Color</em>.</li>
</ul>
<p>Method <em>AIS_InteractiveContext::Hilight</em> is now deprecated and highlights the interactive object with selection style.</p>
<p>A group of methods <em>AIS_InteractiveContext::IsHilighted</em> has changed its behavior - now they only check highlight flags of the object or the owner in the global status. If the highlight color is required on the application level, it is necessary to use overloaded methods <em>AIS_InteractiveContext::HighlightStyle</em> for the owner and the object.</p>
<p>The following methods have been replaced in <em>AIS_InteractiveContext</em> class:</p><ul>
<li><em>HilightColor</em> and <em>SetHilightColor</em> by <em>HighlightStyle</em> and <em>SetHighlightStyle</em>;</li>
<li><em>SelectionColor</em> setter and getter by <em>SelectionStyle</em> and <em>SetSelectionStyle</em>.</li>
</ul>
<p>The API of <em>Prs3d_Drawer</em> has been extended to allow setting up styles for both dynamic selection and highlighting. Therefore, it is possible to change the highlight style of a particular object on the application level via <em>SelectMgr_SelectableObject::HilightAttributes()</em> and process it in the entity owner.</p>
<h2><a class="anchor" id="upgrade_occt710_correction_of_TObj_Model"></a>
Correction in TObj_Model class</h2>
<p>Methods <em>TObj_Model::SaveAs</em> and <em>TObj_Model::Load</em> now receive <em>TCollection_ExtendedString</em> filename arguments instead of char*. UTF-16 encoding can be used to pass file names containing Unicode symbols.</p>
<h2><a class="anchor" id="upgrade_710_env"></a>
Redundant environment variables</h2>
<p>The following environment variables have become redundant:</p>
<ul>
<li><em>CSF_UnitsLexicon</em> and <em>CSF_UnitsDefinition</em> are no more used. Units definition (<em>UnitsAPI/Lexi_Expr.dat</em> and <em>UnitsAPI/Units.dat</em>) is now embedded into source code.</li>
<li><em>CSF_XSMessage</em> and <em>CSF_XHMessage</em> are now optional. English messages (XSMessage/*XSTEP.us* and SHMessage/*SHAPE.us*) are now embedded into source code and automatically loaded when environment variables are not set.</li>
<li><em>CSF_ShadersDirectory</em> is not required any more, though it still can be used to load custom shaders. Mandatory GLSL resources are now embedded into source code.</li>
<li><em>CSF_PluginDefaults</em> and other variables pointing to OCAF plugin resources (<em>CSF_StandardDefaults</em>, <em>CSF_XCAFDefaults</em>, <em>CSF_StandardLiteDefaults</em> and <em>CSF_XmlOcafResource</em>) are not necessary if method <em>TDocStd_Application::DefineFormat()</em> is used to enable persistence of OCAF documents.</li>
</ul>
<p>Other environment variables still can be used to customize behavior of relevant algorithms but are not necessary any more (all required resources are embedded).</p>
<h2><a class="anchor" id="upgrade_710_removed"></a>
Removed features</h2>
<p>The following obsolete features have been removed:</p><ul>
<li>Anti-aliasing API <em>V3d_View::SetAntialiasingOn()</em>. This method was intended to activate deprecated OpenGL functionality <em>GL_POLYGON_SMOOTH, GL_LINE_SMOOTH</em> and <em>GL_POINT_SMOOTH</em>. Instead of the old API, the application should request MSAA buffers for anti-aliasing by assigning <em>Graphic3d_RenderingParams::NbMsaaSamples</em> property of the structure returned by <em>V3d_View::ChangeRenderingParams()</em>.</li>
<li><em>Prs3d_Drawer::ShadingAspectGlobal()</em> flag has been removed as not used. The corresponding calls can be removed safely from the application code.</li>
<li>The methods managing ZClipping planes and ZCueing: <em>V3d_View::SetZClippingType()</em>, <em>V3d_View::SetZCueingOn()</em>, etc. have been removed. ZClipping planes can be replaced by general-purpose clipping planes (the application should update plane definition manually).</li>
<li>The 3D viewer printing API <em>V3d_View::Print()</em> has been removed. This functionality was available on Windows platforms only. The applications should use the general image dump API <em>V3d_View::ToPixMap()</em> and manage printing using a platform-specific API at the application level. Text resolution can be managed by rendering parameter <em>Graphic3d_RenderingParams::Resolution</em>, returned by <em>V3d_View::ChangeRenderingParams()</em>.</li>
<li>Methods <em>PrsMgr_PresentationManager::BoundBox</em>, <em>PrsMgr_PresentationManager::Hilight</em> and <em>SelectMgr_EntityOwner::Hilight</em> have been removed as not used. The corresponding method in custom implementations of <em>SelectMgr_EntityOwner</em> can be removed safely. <em>PrsMgr_PresentationManager::Color</em> with the corresponding style must be used instead.</li>
<li>Class <em>NCollection_QuickSort</em> has been removed. The code that used the tools provided by that class should be corrected manually. The recommended approach is to use sorting algorithms provided by STL (std::sort). See also <a class="el" href="occt__upgrade.html#upgrade_occt700_sorttools">Removal of SortTools package</a> above.</li>
<li>Package <em>Dico</em>. The code that used the tools provided by that package should be corrected manually. The recommended approach is to use <em>NCollection_DataMap</em> and <em>NCollection_IndexedDataMap</em> classes.</li>
</ul>
<h2><a class="anchor" id="upgrade_710_changed_methods"></a>
Other changes</h2>
<p>The following classes have been changed:</p>
<ul>
<li><em>BVH_Sorter</em> class has become abstract. The list of arguments of both <em>Perform</em> methods has been changed and the methods became pure virtual.</li>
<li><em>Extrema_FuncExtPS</em> has been renamed to <em>Extrema_FuncPSNorm</em>.</li>
<li>The default constructor and the constructor taking a point and a surface have been removed from class <em>Extrema_GenLocateExtPS</em>. Now the only constructor takes the surface and optional tolerances in U and V directions. The new method <em>Perform</em> takes the point with the start solution and processes it. The class has become not assignable and not copy-constructable.</li>
<li>Constructors with arguments *(const gp_Ax22d&amp; D, const gp_Pnt2d&amp; F)* have been removed from <em>GCE2d_MakeParabola</em>, <em>gce_MakeParab2d</em> and <em>gp_Parab2d</em>. The objects created with some constructors of class <em>gp_Parab2d</em> may differ from the previous version (see the comments in <em>gp_Parab2d.hxx</em>). The result returned by <em>gp_Parab2d::Directrix()</em> method has an opposite direction in comparison with the previous OCCT versions.</li>
<li><em>BRepTools_Modifier</em> class now has two modes of work. They are defined by the boolean parameter <em>MutableInput</em>, which is turned off by default. This means that the algorithm always makes a copy of a sub-shape (e.g. vertex) if its tolerance is to be increased in the output shape. The old mode corresponds to <em>MutableInput</em> turned on. This change may impact an application if it implements a class derived from <em>BRepTools_Modifier</em>.</li>
<li>The second parameter <em>theIsOuterWire</em> of method <em>ShapeAnalysis_Wire::CheckSmallArea</em> has been removed.</li>
<li>In class <em>GeomPlate_CurveConstraint</em>, two constructors taking boundary curves of different types have been replaced with one constructor taking the curve of an abstract type.</li>
<li>The last optional argument <em>RemoveInvalidFaces</em> has been removed from the constructor of class <em>BRepOffset_MakeOffset</em> and method <em>Initialize</em>.</li>
<li>The public method <em>BOPDS_DS::VerticesOnIn</em> has been renamed into <em>SubShapesOnIn</em> and the new output parameter <em>theCommonPB</em> has been added.</li>
</ul>
<h1><a class="anchor" id="upgrade_occt720"></a>
Upgrade to OCCT 7.2.0</h1>
<h2><a class="anchor" id="upgrade_720_removed"></a>
Removed features</h2>
<p>The following obsolete features have been removed:</p><ul>
<li><em>AIS_InteractiveContext::PreSelectionColor()</em>, <em>DefaultColor()</em>, <em>WasCurrentTouched()</em>, <em>ZDetection()</em>. These properties were unused, and therefore application should remove occurrences of these methods.</li>
<li><em>AIS_InteractiveObject::SelectionPriority()</em>. These property was not implemented.</li>
<li>The class <em>LocOpe_HBuilder</em> has been removed as obsolete.</li>
<li>The package <em>TestTopOpe</em> has been removed;</li>
<li>The package <em>TestTopOpeDraw</em> has been removed;</li>
<li>The package <em>TestTopOpeTools</em> has been removed.</li>
<li>The packages <em>QANewModTopOpe</em>, <em>QANewBRepNaming</em> and <em>QANewDBRepNaming</em> have been removed as containing obsolete features.</li>
<li>The following methods of the <em>IntPolyh_Triangle</em> class have been removed as unused:<ul>
<li><em>CheckCommonEdge</em></li>
<li><em>SetEdgeandOrientation</em></li>
<li><em>MultipleMiddleRefinement2</em>.</li>
</ul>
</li>
<li>The method <em>IntPolyh_Triangle::TriangleDeflection</em> has been renamed to <em>IntPolyh_Triangle::ComputeDeflection</em>.</li>
<li>The following methods of the <em>IntPolyh_MaillageAffinage</em> class have been removed as unused:<ul>
<li><em>LinkEdges2Triangles</em>;</li>
<li><em>TriangleEdgeContact2</em>;</li>
<li><em>StartingPointsResearch2</em>;</li>
<li><em>NextStartingPointsResearch2</em>;</li>
<li><em>TriangleComparePSP</em>;</li>
<li><em>StartPointsCalcul</em>.</li>
</ul>
</li>
<li>The method PerformAdvanced of the <em>ShapeConstruct_ProjectCurveOnSurface</em> class has been removed as unused.</li>
<li>The method Perform of the <em>ShapeConstruct_ProjectCurveOnSurface</em> class is modified:<ul>
<li>input arguments <em>continuity</em>, <em>maxdeg</em>, <em>nbinterval</em> have been removed as unused;</li>
<li>input arguments <em>TolFirst</em>, <em>TolLast</em> have been added at the end of arguments' list.</li>
</ul>
</li>
<li>Typedefs Quantity_Factor, Quantity_Parameter, Quantity_Ratio, Quantity_Coefficient, Quantity_PlaneAngle, Quantity_Length, V3d_Parameter and V3d_Coordinate have been removed; Standard_Real should be used instead.</li>
</ul>
<h2><a class="anchor" id="upgrade_occt720_reshape_oriented_removed"></a>
Corrections in BRepOffset API</h2>
<p>In classes <em>BRepTools_ReShape</em> and <em>ShapeBuild_ReShape</em>, the possibility to process shapes different only by orientation in different ways has been removed. Thus methods <em>Remove()</em> and <em>Replace()</em> do not have any more the last argument 'oriented'; they work always as if <em>Standard_False</em> was passed before (default behavior). Methods <em>ModeConsiderLo()</em> and <em>Apply()</em> with three arguments have been removed.</p>
<h2><a class="anchor" id="upgrade_occt720_correction_of_Offset_API"></a>
Corrections in BRepOffset API</h2>
<p>Class <em>BRepOffsetAPI_MakeOffsetShape</em>:</p><ul>
<li><em>BRepOffsetAPI_MakeOffsetShape::BRepOffsetAPI_MakeOffsetShape()</em> - constructor with parameters has been deleted.</li>
<li><em>BRepOffsetAPI_MakeOffsetShape::PerformByJoin()</em> - method has been added. This method is old algorithm behaviour.</li>
</ul>
<p>The code below shows new calling procedure: </p><div class="fragment"><div class="line">BRepOffsetAPI_MakeOffsetShape OffsetMaker;</div>
<div class="line">OffsetMaker.PerformByJoin(Shape, OffsetValue, Tolerance);</div>
<div class="line">NewShape = OffsetMaker.Shape();</div>
</div><!-- fragment --><p>Class <em>BRepOffsetAPI_MakeThickSolid</em>:</p><ul>
<li><em>BRepOffsetAPI_MakeThickSolid::BRepOffsetAPI_MakeThickSolid()</em> - constructor with parameters has been deleted.</li>
<li><em>BRepOffsetAPI_MakeThickSolid::MakeThickSolidByJoin()</em> - method has been added. This method is old algorithm behaviour.</li>
</ul>
<p>The code below shows new calling procedure: </p><div class="fragment"><div class="line">BRepOffsetAPI_MakeThickSolid BodyMaker;</div>
<div class="line">BodyMaker.MakeThickSolidByJoin(myBody, facesToRemove, -myThickness / 50, 1.e-3);</div>
<div class="line">myBody = BodyMaker.Shape();</div>
</div><!-- fragment --><h2><a class="anchor" id="upgrade_720_highlight"></a>
Highlight style</h2>
<p>Management of highlight attributes has been revised and might require modifications from application side:</p><ul>
<li>New class <em>Graphic3d_PresentationAttributes</em> defining basic presentation attributes has been introduced. It's definition includes properties previously defined by class Graphic3d_HighlightStyle (<em>Color</em>, <em>Transparency</em>), and new properties (<em>Display mode</em>, <em>ZLayer</em>, optional <em>FillArea aspect</em>).</li>
<li>Class <em>Prs3d_Drawer</em> now inherits class <em>Graphic3d_PresentationAttributes</em>. So that overall presentation attributes are now split into two parts - Basic attributes and Detailed attributes.</li>
<li>Class <em>Graphic3d_HighlightStyle</em> has been dropped. It is now defined as a typedef to <em>Prs3d_Drawer</em>. Therefore, highlight style now also includes not only Basic presentation attributes, but also Detailed attributes which can be used by custom presentation builders.</li>
<li>Highlighting style defined by class <em>Graphic3d_PresentationAttributes</em> now provides more options:<ul>
<li><em>Graphic3d_PresentationAttributes::BasicFillAreaAspect()</em> property providing complete Material definition. This option, when defined, can be used instead of the pair Object Material + Highlight Color.</li>
<li><em>Graphic3d_PresentationAttributes::ZLayer()</em> property specifying the Layer where highlighted presentation should be shown. This property can be set to Graphic3d_ZLayerId_UNKNOWN, which means that ZLayer of main presentation should be used instead.</li>
<li><em>Graphic3d_PresentationAttributes::DisplayMode()</em> property specifying Display Mode for highlight presentation.</li>
</ul>
</li>
<li>Since Highlight and Selection styles within <em>AIS_InteractiveContext</em> are now defined by <em>Prs3d_Drawer</em> inheriting from <em>Graphic3d_PresentationAttributes</em>, it is now possible to customize default highlight attributes like <em>Display Mode</em> and <em>ZLayer</em>, which previously could be defined only on Object level.</li>
<li>Properties <em>Prs3d_Drawer::HighlightStyle()</em> and <em>Prs3d_Drawer::SelectionStyle()</em> have been removed. Instead, <em>AIS_InteractiveObject</em> now defines <em>DynamicHilightAttributes()</em> for dynamic highlighting in addition to <em>HilightAttributes()</em> used for highlighting in selected state. Note that <em>AIS_InteractiveObject::HilightAttributes()</em> and <em>AIS_InteractiveObject::DynamicHilightAttributes()</em> override highlighting properties for both - entire object and for part coming from decomposition. This includes Z-layer settings, which will be the same when overriding properties through AIS_InteractiveObject, while <em>AIS_InteractiveContext::HighlightStyle()</em> allows customizing properties for local and global selection independently (with Graphic3d_ZLayerId_Top used for dynamic highlighting of entire object and Graphic3d_ZLayerId_Topmost for dynamic highlighting of object part by default).</li>
<li>The following protected fields have been removed from class <em>AIS_InteractiveObject</em>:<ul>
<li><em>myOwnColor</em>, replaced by <em>myDrawer-&gt;Color()</em></li>
<li><em>myTransparency</em>, replaced by <em>myDrawer-&gt;Transparency()</em></li>
<li><em>myZLayer</em>, replaced by <em>myDrawer-&gt;ZLayer()</em></li>
</ul>
</li>
<li>The method <em>PrsMgr_PresentationManager::Unhighlight()</em> taking Display Mode as an argument has been marked deprecated. Implementation now performs unhighlighting of all highlighted presentation mode.</li>
<li>The methods taking/returning <em>Quantity_NameOfColor</em> (predefined list of colors) and duplicating methods operating with <em>Quantity_Color</em> (definition of arbitrary RGB color) in AIS have been removed. <em>Quantity_Color</em> should be now used instead.</li>
</ul>
<h2><a class="anchor" id="upgrade_720_implicit_viewer_update"></a>
Elimination of implicit 3D Viewer updates</h2>
<p>Most AIS_InteractiveContext methods are defined with a flag to update viewer immediately or not. Within previous version of OCCT, this argument had default value TRUE. While immediate viewer updates are useful for beginners (the result is displayed as soon as possible), this approach is inefficient for batch viewer updates, and having default value as TRUE lead to non-intended accidental updates which are difficult to find.</p>
<p>To avoid such issues, the interface has been modified and default value has been removed. Therefore, old application code should be updated to set the flag theToUpdateViewer explicitly to desired value (TRUE to preserve old previous behavior), if it was not already set.</p>
<p>The following AIS_InteractiveContext methods have been changed: Display, Erase, EraseAll, DisplayAll, EraseSelected, DisplaySelected, ClearPrs, Remove, RemoveAll, Hilight, HilightWithColor, Unhilight, Redisplay, RecomputePrsOnly, Update, SetDisplayMode, UnsetDisplayMode, SetColor, UnsetColor, SetWidth, UnsetWidth, SetMaterial, UnsetMaterial, SetTransparency, UnsetTransparency, SetLocalAttributes, UnsetLocalAttributes, SetPolygonOffsets, SetTrihedronSize, SetPlaneSize, SetPlaneSize, SetDeviationCoefficient, SetDeviationAngle, SetAngleAndDeviation, SetHLRDeviationCoefficient, SetHLRDeviationAngle, SetHLRAngleAndDeviation, SetSelectedAspect, MoveTo, Select, ShiftSelect, SetSelected, UpdateSelected, AddOrRemoveSelected, HilightSelected, UnhilightSelected, ClearSelected, ResetOriginalState, SubIntensityOn, SubIntensityOff, FitSelected, EraseGlobal, ClearGlobal, ClearGlobalPrs.</p>
<p>In addition, the API for immediate viewer update has been removed from V3d_View and Graphic3d_StructureManager classes (enumerations <em>Aspect_TypeOfUpdate</em> and <em>V3d_TypeOfUpdate</em>): V3d::SetUpdateMode(), V3d::UpdateMode(), Graphic3d_StructureManager::SetUpdateMode(), Graphic3d_StructureManager::UpdateMode().</p>
<p>The argument theUpdateMode has been removed from methods Graphic3d_CView::Display(), Erase(), Update(). Method Graphic3d_CView::Update() does not redraw the view and does not re-compute structures anymore.</p>
<p>The following Grid management methods within class V3d_Viewer do not implicitly redraw the viewer: ActivateGrid, DeactivateGrid, SetRectangularGridValues, SetCircularGridValues, RectangularGridGraphicValues, CircularGridGraphicValues, SetPrivilegedPlane, DisplayPrivilegedPlane.</p>
<h2><a class="anchor" id="upgrade_720_v3d_colorname"></a>
Elimination of Quantity_NameOfColor from TKV3d interface classes</h2>
<p>The duplicating interface methods accepting <em>Quantity_NameOfColor</em> (in addition to methods accepting <em>Quantity_Color</em>) of TKV3d toolkit have been removed. In most cases this change should be transparent, however applications implementing such interface methods should also remove them (compiler will automatically highlight this issue for methods marked with Standard_OVERRIDE keyword).</p>
<h2><a class="anchor" id="upgrade_720_Result_Of_BOP_On_Containers"></a>
Result of Boolean operations on containers</h2>
<ul>
<li>The result of Boolean operations on arguments of collection types (WIRE/SHELL/COMPSOLID) is now filtered from duplicating containers.</li>
</ul>
<h2><a class="anchor" id="upgrade_720_changes_methods"></a>
Other changes</h2>
<ul>
<li><em>MMgt_TShared</em> class definition has been removed - Standard_Transient should be used instead (MMgt_TShared is marked as deprecated typedef of Standard_Transient for smooth migration).</li>
<li>Class GeomPlate_BuildPlateSurface accepts base class Adaptor3d_HCurve (instead of inherited Adaptor3d_HCurveOnSurface accepted earlier).</li>
<li>Types GeomPlate_Array1OfHCurveOnSurface and GeomPlate_HArray1OfHCurveOnSurface have been replaced with GeomPlate_Array1OfHCurve and GeomPlate_HArray1OfHCurve correspondingly (accept base class Adaptor3d_HCurve instead of Adaptor3d_HCurveOnSurface).</li>
<li>Enumeration <em>Image_PixMap::ImgFormat</em>, previously declared as nested enumeration within class <em>Image_PixMap</em>, has been moved to global namespace as <em>Image_Format</em> following OCCT coding rules. The enumeration values have suffix Image_Format_ and preserve previous name scheme for easy renaming of old values - e.g. Image_PixMap::ImgGray become Image_Format_Gray. Old definitions are preserved as depreacated aliases to the new ones;</li>
<li>Methods <em>Image_PixMap::PixelColor()</em> and <em>Image_PixMap::SetPixelColor()</em> now take/return Quantity_ColorRGBA instead of Quantity_Color/NCollection_Vec4.</li>
<li>The method BOPAlgo_Builder::Origins() returns BOPCol_DataMapOfShapeListOfShape instead of BOPCol_DataMapOfShapeShape.</li>
<li>The methods BOPDS_DS::IsToSort(const Handle(BOPDS_CommonBlock)&amp;, Standard_Integer&amp;) and BOPDS_DS::SortPaveBlocks(const Handle(BOPDS_CommonBlock)&amp;) have been removed. The sorting is now performed during the addition of the Pave Blocks into Common Block.</li>
<li>The methods BOPAlgo_Tools::MakeBlocks() and BOPAlgo_Tools::MakeBlocksCnx() have been replaced with the single template method BOPAlgo_Tools::MakeBlocks(). The chains of connected elements are now stored into the list of list instead of data map.</li>
<li>The methods BOPAlgo_Tools::FillMap() have been replaced with the single template method BOPAlgo_Tools::FillMap().</li>
<li>Package BVH now uses opencascade::handle instead of NCollection_Handle (for classes BVH_Properties, BVH_Builder, BVH_Tree, BVH_Object). Application code using BVH package directly should be updated accordingly.</li>
<li>AIS_Shape now computes UV texture coordinates for AIS_Shaded presentation in case if texture mapping is enabled within Shaded Attributes. Therefore, redundant class <em>AIS_TexturedShape is now deprecated</em> - applications can use <em>AIS_Shape</em> directly (texture mapping should be defined through AIS_Shape::Attributes()).</li>
<li>Methods for managing active texture within OpenGl_Workspace class (ActiveTexture(), DisableTexture(), EnableTexture()) have been moved to <em>OpenGl_Context::BindTextures()</em>.</li>
</ul>
<h2><a class="anchor" id="upgrade_720_BOP_DataStructure"></a>
BOP - Pairs of interfering indices</h2>
<ul>
<li>The classes <em>BOPDS_PassKey</em> and <em>BOPDS_PassKeyBoolean</em> are too excessive and not used any more in Boolean Operations. To replace them the new <em>BOPDS_Pair</em> class has been implemented. Thus:<ul>
<li>The method <em>BOPDS_DS::Interferences()</em> now returns the <em>BOPDS_MapOfPair</em>;</li>
<li>The method <em>BOPDS_Iterator::Value()</em> takes now only two parameters - the indices of interfering sub-shapes.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="upgrade_720_Removal_Of_Old_Boolean_Operations_Draw"></a>
Removal of the Draw commands based on old Boolean operations</h2>
<ul>
<li>The commands <em>fubl</em> and <em>cubl</em> have been removed. The alternative for these commands are the commands <em>bfuseblend</em> and <em>bcutblend</em> respectively.</li>
<li>The command <em>ksection</em> has been removed. The alternative for this command is the command <em>bsection</em>.</li>
</ul>
<h2><a class="anchor" id="upgrade_720_Change_Of_FaceFace_Intersection"></a>
Change of Face/Face intersection in Boolean operations</h2>
<ul>
<li>Previously, the intersection tolerance for all section curves between pair of faces has been calculated as the maximal tolerance among all curves. Now, each curve has its own valid tolerance calculated as the maximal deviation of the 3D curve from its 2D curves or surfaces in case there are no 2D curves.</li>
<li>The methods <em>IntTools_FaceFace::TolReached3d()</em>, <em>IntTools_FaceFace::TolReal()</em> and <em>IntTools_FaceFace::TolReached2d()</em> have been removed.</li>
<li>Intersection tolerances of the curve can be obtained from the curve itself:<ul>
<li><em>IntTools_Curve::Tolerance()</em> - returns the valid tolerance for the curve;</li>
<li><em>IntTools_Curve::TangentialTolerance()</em> - returns the tangential tolerance, which reflects the size of the common between faces.</li>
</ul>
</li>
<li>2d tolerance (<em>IntTools_FaceFace::TolReached2d()</em>) has been completely removed from the algorithm as unused.</li>
</ul>
<h2><a class="anchor" id="upgrade_720_persistence"></a>
Restore OCCT 6.9.1 persistence</h2>
<p>The capability of reading / writing files in old format using <em>Storage_ShapeSchema</em> functionality from OCCT 6.9.1 has been restored in OCCT 7.2.0.</p>
<p>One can use this functionality in two ways:</p><ul>
<li>invoke DRAW Test Harness commands <em>fsdread / fsdwrite</em> for shapes;</li>
<li>call <em>StdStorage</em> class <em>Read / Write</em> functions in custom code.</li>
</ul>
<p>The code example below demonstrates how to read shapes from a storage driver using <em>StdStorage</em> class.</p>
<div class="fragment"><div class="line"><span class="comment">// aDriver should be created and opened for reading</span></div>
<div class="line">Handle(StdStorage_Data) aData;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Read data from the driver</span></div>
<div class="line"><span class="comment">// StdStorage::Read creates aData instance automatically if it is null</span></div>
<div class="line">Storage_Error anError = StdStorage::Read(*aDriver, aData);</div>
<div class="line"><span class="keywordflow">if</span> (anError != Storage_VSOk)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Error processing</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get root objects</span></div>
<div class="line">Handle(StdStorage_RootData) aRootData = aData-&gt;RootData();</div>
<div class="line">Handle(StdStorage_HSequenceOfRoots) aRoots = aRootData-&gt;Roots();</div>
<div class="line"><span class="keywordflow">if</span> (!aRoots.IsNull())</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Iterator over the sequence of root objects</span></div>
<div class="line">  <span class="keywordflow">for</span> (StdStorage_HSequenceOfRoots::Iterator anIt(*aRoots); anIt.More(); anIt.Next())</div>
<div class="line">  {</div>
<div class="line">    Handle(StdStorage_Root)&amp; aRoot = anIt.ChangeValue();</div>
<div class="line">    <span class="comment">// Get a persistent root&#39;s object</span></div>
<div class="line">    Handle(StdObjMgt_Persistent) aPObject = aRoot-&gt;Object();</div>
<div class="line">    <span class="keywordflow">if</span> (!aPObject.IsNull())</div>
<div class="line">    {</div>
<div class="line">      Handle(ShapePersistent_TopoDS::HShape) aHShape = Handle(ShapePersistent_TopoDS::HShape)::DownCast(aPObject);</div>
<div class="line">      <span class="keywordflow">if</span> (aHShape) <span class="comment">// Downcast to an expected type to import transient data</span></div>
<div class="line">      {</div>
<div class="line">        TopoDS_Shape aShape = aHShape-&gt;Import();</div>
<div class="line">        shapes.Append(aShape);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>The following code demonstrates how to write shapes in OCCT 7.2.0 using <em>StdStorage</em> class.</p>
<div class="fragment"><div class="line"><span class="comment">// Create a file driver</span></div>
<div class="line">NCollection_Handle&lt;Storage_BaseDriver&gt; aFileDriver(<span class="keyword">new</span> FSD_File());</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Try to open the file driver for writing</span></div>
<div class="line"><span class="keywordflow">try</span></div>
<div class="line">{</div>
<div class="line">  OCC_CATCH_SIGNALS</div>
<div class="line">  PCDM_ReadWriter::Open (*aFileDriver, TCollection_ExtendedString(theFilename), Storage_VSWrite);</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">catch</span> (Standard_Failure&amp; e)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Error processing</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create a storage data instance</span></div>
<div class="line">Handle(StdStorage_Data) aData = <span class="keyword">new</span> StdStorage_Data();</div>
<div class="line"><span class="comment">// Set an axiliary application name (optional)</span></div>
<div class="line">aData-&gt;HeaderData()-&gt;SetApplicationName(TCollection_ExtendedString(<span class="stringliteral">&quot;Application&quot;</span>));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Provide a map to track sharing</span></div>
<div class="line">StdObjMgt_TransientPersistentMap aMap;</div>
<div class="line"><span class="comment">// Iterator over a collection of shapes</span></div>
<div class="line"><span class="keywordflow">for</span> (Standard_Integer i = 1; i &lt;= shapes.Length(); ++i)</div>
<div class="line">{</div>
<div class="line">  TopoDS_Shape aShape = shapes.Value(i);</div>
<div class="line">  <span class="comment">// Translate a shape to a persistent object</span></div>
<div class="line">  Handle(ShapePersistent_TopoDS::HShape) aPShape =</div>
<div class="line">    ShapePersistent_TopoDS::Translate(aShape, aMap, ShapePersistent_WithTriangle);</div>
<div class="line">  <span class="keywordflow">if</span> (aPShape.IsNull())</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// Error processing</span></div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Construct a root name</span></div>
<div class="line">  TCollection_AsciiString aName = TCollection_AsciiString(<span class="stringliteral">&quot;Shape_&quot;</span>) + i;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Add a root to storage data</span></div>
<div class="line">  Handle(StdStorage_Root) aRoot = <span class="keyword">new</span> StdStorage_Root(aName, aPShape);</div>
<div class="line">  aData-&gt;RootData()-&gt;AddRoot(aRoot);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Write storage data to the driver</span></div>
<div class="line">Storage_Error anError = StdStorage::Write(*aFileDriver, aData);</div>
<div class="line"><span class="keywordflow">if</span> (anError != Storage_VSOk)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Error processing</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="upgrade_720_Change_In_BRepLib_MakeFace_Algo"></a>
Change in BRepLib_MakeFace algorithm</h2>
<p>Previously, <em>BRepLib_MakeFace</em> algorithm changed orientation of the source wire in order to avoid creation of face as a hole (i.e. it is impossible to create the entire face as a hole; the hole can be created in context of another face only). New algorithm does not reverse the wire if it is open. Material of the face for the open wire will be located on the left side from the source wire.</p>
<h2><a class="anchor" id="upgrade_720_Change_In_BRepFill_OffsetWire"></a>
Change in BRepFill_OffsetWire algorithm</h2>
<p>From now on, the offset will always be directed to the outer region in case of positive offset value and to the inner region in case of negative offset value. Inner/Outer region for an open wire is defined by the following rule: when we go along the wire (taking into account edges orientation) the outer region will be on the right side, the inner region will be on the left side. In case of a closed wire, the inner region will always be inside the wire (at that, the edges orientation is not taken into account).</p>
<h2><a class="anchor" id="upgrade_720_Change_In_GeomAdaptor_Curve"></a>
Change in Geom(2d)Adaptor_Curve::IsPeriodic</h2>
<p>Since 7.2.0 version, method <em>IsPeriodic()</em> returns the corresponding status of periodicity of the basis curve regardless of closure status of the adaptor curve (see method <em>IsClosed()</em>). Method <em>IsClosed()</em> for adaptor can return false even on periodic curve, in the case if its parametric range is not full period, e.g. for adaptor on circle in range [0, \( \pi \)]. In previous versions, <em>IsPeriodic()</em> always returned false if <em>IsClosed()</em> returned false.</p>
<h2><a class="anchor" id="upgrade_720_UnifySameDomain"></a>
Change in algorithm ShapeUpgrade_UnifySameDomain</h2>
<p>The history of the changing of the initial shape was corrected:</p><ul>
<li>all shapes created by the algorithm are considered as modified shapes instead of generated ones;</li>
<li>method Generated was removed and its calls should be replaced by calls of method History()-&gt;Modified.</li>
</ul>
<h2><a class="anchor" id="upgrade_720_Change_In_RWStl"></a>
Changes in STL Reader / Writer</h2>
<p>Class RWStl now uses class Poly_Triangulation for storing triangular mesh instead of StlMesh data classes; the latter have been removed.</p>
<h2><a class="anchor" id="upgrade_720_New_Error_Warning_system_in_BOA"></a>
Refactoring of the Error/Warning reporting system in Boolean Component</h2>
<p>The Error/Warning reporting system of the algorithms in Boolean Component (in all BOPAlgo_* and BRepAlgoAPI_* algorithms) has been refactored. The methods returning the status of errors and warnings of the algorithms (ErrorStatus() and WarningStatus()) have been removed. Instead use methods HasErrors() and HasWarnings() to check for presence of errors and warnings, respectively. The full list of errors and warnings, with associated data such as problematic sub-shapes, can be obtained by method GetReport().</p>
<h1><a class="anchor" id="upgrade_occt721"></a>
Upgrade to OCCT 7.2.1</h1>
<h2><a class="anchor" id="upgrade_721_Changes_In_USD"></a>
Changes in ShapeUpgrade_UnifySameDomain</h2>
<p>The following public methods in the class ShapeUpgrade_UnifySameDomain became protected:</p><ul>
<li><em>UnifyFaces</em></li>
<li><em>UnifyEdges</em></li>
</ul>
<p>The following public method has been removed:</p><ul>
<li><em>UnifyFacesAndEdges</em></li>
</ul>
<h2><a class="anchor" id="upgrade_721_Move_BuildPCurveForEdgeOnPlane"></a>
Moving BuildPCurveForEdgeOnPlane from BOPTools_AlgoTools2D to BRepLib</h2>
<p>The methods BuildPCurveForEdgeOnPlane and BuildPCurveForEdgesOnPlane have been moved from the class BOPTools_AlgoTools2D to the more lower level class BRepLib.</p>
<h2><a class="anchor" id="upgrade_721_removed"></a>
Removed features</h2>
<p>The following obsolete features have been removed:</p><ul>
<li>The package BOPCol has been fully removed:<ul>
<li><em>BOPCol_BaseAllocator</em> is replaced with <em>Handle(NCollection_BaseAllocator)</em>;</li>
<li><em>BOPCol_BoxBndTree</em> is replaced with <em>BOPTools_BoxBndTree</em>;</li>
<li><em>BOPCol_Box2DBndTree</em> is removed as unused;</li>
<li><em>BOPCol_DataMapOfIntegerInteger</em> is replaced with <em>TColStd_DataMapOfIntegerInteger</em>;</li>
<li><em>BOPCol_DataMapOfIntegerListOfInteger</em> is replaced with <em>TColStd_DataMapOfIntegerListOfInteger</em>;</li>
<li><em>BOPCol_DataMapOfIntegerListOfShape</em> is replaced with <em>TopTools_DataMapOfIntegerListOfShape</em>;</li>
<li><em>BOPCol_DataMapOfIntegerMapOfInteger.hxx</em> is removed as unused;</li>
<li><em>BOPCol_DataMapOfIntegerReal</em> is replaced with <em>TColStd_DataMapOfIntegerReal</em>;</li>
<li><em>BOPCol_DataMapOfIntegerShape</em> is replaced with <em>TopTools_DataMapOfIntegerShape</em>;</li>
<li><em>BOPCol_DataMapOfShapeBox</em> is replaced with <em>TopTools_DataMapOfShapeBox</em>;</li>
<li><em>BOPCol_DataMapOfShapeInteger</em> is replaced with <em>TopTools_DataMapOfShapeInteger</em>;</li>
<li><em>BOPCol_DataMapOfShapeListOfShape</em> is replaced with <em>TopTools_DataMapOfShapeListOfShape</em>;</li>
<li><em>BOPCol_DataMapOfShapeReal</em> is replaced with <em>TopTools_DataMapOfShapeReal</em>;</li>
<li><em>BOPCol_DataMapOfShapeShape</em> is replaced with <em>TopTools_DataMapOfShapeShape</em>;</li>
<li><em>BOPCol_DataMapOfTransientAddress</em> is removed as unused;</li>
<li><em>BOPCol_IndexedDataMapOfIntegerListOfInteger</em> is removed as unused;</li>
<li><em>BOPCol_IndexedDataMapOfShapeBox</em> is removed as unused;</li>
<li><em>BOPCol_IndexedDataMapOfShapeInteger</em> is removed as unused;</li>
<li><em>BOPCol_IndexedDataMapOfShapeListOfShape</em> is replaced with <em>TopTools_IndexedDataMapOfShapeListOfShape</em>;</li>
<li><em>BOPCol_IndexedDataMapOfShapeReal</em> is removed as unused;</li>
<li><em>BOPCol_IndexedDataMapOfShapeShape</em> is replaced with <em>TopTools_IndexedDataMapOfShapeShape</em>;</li>
<li><em>BOPCol_IndexedMapOfInteger</em> is replaced with <em>TColStd_IndexedMapOfInteger</em>;</li>
<li><em>BOPCol_IndexedMapOfOrientedShape</em> is replaced with <em>TopTools_IndexedMapOfOrientedShape</em>;</li>
<li><em>BOPCol_IndexedMapOfShape</em> is replaced with <em>TopTools_IndexedMapOfShape</em>;</li>
<li><em>BOPCol_ListOfInteger</em> is replaced with <em>TColStd_ListOfInteger</em>;</li>
<li><em>BOPCol_ListOfListOfShape</em> is replaced with <em>TopTools_ListOfListOfShape</em>;</li>
<li><em>BOPCol_ListOfShape</em> is replaced with <em>TopTools_ListOfShape</em>;</li>
<li><em>BOPCol_MapOfInteger</em> is replaced with <em>TColStd_MapOfInteger</em>;</li>
<li><em>BOPCol_MapOfOrientedShape</em> is replaced with <em>TopTools_MapOfOrientedShape</em>;</li>
<li><em>BOPCol_MapOfShape</em> is replaced with <em>TopTools_MapOfShape</em>;</li>
<li><em>BOPCol_PListOfInteger</em> is removed as unused;</li>
<li><em>BOPCol_PInteger</em> is removed as unused</li>
<li><em>BOPCol_SequenceOfPnt2d</em> is replaced with <em>TColgp_SequenceOfPnt2d</em>;</li>
<li><em>BOPCol_SequenceOfReal</em> is replaced with <em>TColStd_SequenceOfReal</em>;</li>
<li><em>BOPCol_SequenceOfShape</em> is replaced with <em>TopTools_SequenceOfShape</em>;</li>
<li><em>BOPCol_Parallel</em> is replaced with <em>BOPTools_Parallel</em>;</li>
<li><em>BOPCol_NCVector</em> is replaced with <em>NCollection_Vector</em>;</li>
</ul>
</li>
<li>The class <em>BOPDS_PassKey</em> and containers for it have been removed as unused.</li>
<li>The unused containers from <em>IntTools</em> package have been removed:<ul>
<li><em>IntTools_DataMapOfShapeAddress</em> is removed as unused;</li>
<li><em>IntTools_IndexedDataMapOfTransientAddress</em> is removed as unused;</li>
</ul>
</li>
<li>The container <em>BiTgte_DataMapOfShapeBox</em> is replaced with <em>TopTools_DataMapOfShapeBox</em>;</li>
<li>The class <em>BOPTools</em> has been removed as duplicate of the class <em>TopExp</em>;</li>
<li>The method <em>BOPAlgo_Builder::Splits()</em> has been removed as excessive. The method <em>BOPAlgo_Builder::Images()</em> can be used instead.</li>
<li>The method <em>BOPTools_AlgoTools::CheckSameGeom()</em> has been removed as excessive. The method <em>BOPTools_AlgoTools::AreFacesSameDomain()</em> can be used instead.</li>
</ul>
<h1><a class="anchor" id="upgrade_occt730"></a>
Upgrade to OCCT 7.3.0</h1>
<h2><a class="anchor" id="upgrade_730_lights"></a>
Light sources</h2>
<p>Multiple changes have been applied to lights management within <em>TKV3d</em> and <em>TKOpenGl</em>:</p><ul>
<li><em>V3d_Light</em> class is now an alias to <em>Graphic3d_CLight</em>. <em>Graphic3d_CLight</em> is now a Handle class with refactored methods for managing light source parameters. Most methods of <em>V3d_Light</em> sub-classes have been preserved to simplify porting.</li>
<li>Obsolete debugging functionality for drawing a light source has been removed from <em>V3d_Light</em>. Methods and constructors that take parameters for debug display and do not affect the light definition itself have also been removed.</li>
<li>Light constructors taking <em>V3d_Viewer</em> have been marked as deprecated. Use method <em>AddLight()</em> of the class <em>V3d_Viewer</em> or <em>V3d_View</em> to add new light sources to a scene or a single view, respectively.</li>
<li>The upper limit of 8 light sources has been removed.</li>
<li>The classes for specific light source types: <em>V3d_AmbientLight, V3d_DirectionalLight, V3d_PositionalLight</em> and <em>V3d_SpotLight</em> have been preserved, but it is now possible to define the light of any type by creating base class <em>Graphic3d_CLight</em> directly. The specific classes only hide unrelated light properties depending on the type of light source.</li>
<li>It is no more required to call <em>V3d_Viewer::UpdateLights()</em> after modifying the properties of light sources (color, position, etc.)</li>
</ul>
<h2><a class="anchor" id="upgrade_730_shadingmodels"></a>
Shading Models</h2>
<p><em>Graphic3d_AspectFillArea3d</em> has been extended by a new property <em>ShadingModel()</em>, which previously has been defined globally for the entire View.</p>
<p>Previously, a triangle array without normal vertex attributes was implicitly considered as unshaded, but now such array will be shaded using <em>Graphic3d_TOSM_FACET</em> model (e.g. by computing per-triangle normals). Therefore, <em>Graphic3d_TOSM_UNLIT</em> should be explicitly specified to disable shading of triangles array. Alternatively, a material without reflectance properties can be used to disable shading (as before).</p>
<h2><a class="anchor" id="upgrade_730_tkopengl"></a>
Custom low-level OpenGL elements</h2>
<p>The following API changes should be considered while porting custom <em>OpenGl_Element</em> objects:</p><ul>
<li><em>OpenGl_ShaderManager::BindFaceProgram()</em>, <em>BindLineProgram()</em>, <em>BindMarkerProgram()</em> now take enumeration arguments instead of Boolean flags.</li>
</ul>
<h2><a class="anchor" id="upgrade_730_BOPAlgo_Section"></a>
Changes in BOPAlgo_Section</h2>
<p>The public method <em>BuildSection()</em> in the class <em>BOPAlgo_Section</em> has become protected. The methods <em>Perform()</em> or <em>PerformWithFiller()</em> should be called for construction of the result of SECTION operation.</p>
<h2><a class="anchor" id="upgrade_730_BRepAdaptor_CompCurve"></a>
Changes in BRepAdaptor_CompCurve</h2>
<p>The method <em>BRepAdaptor_CompCurve::SetPeriodic</em> has been eliminated. Since the new version, the method <em>BRepAdaptor_CompCurve::IsPeriodic()</em> will always return FALSE. Earlier, it could return TRUE in case if the wire contained only one edge based on a periodic curve.</p>
<h2><a class="anchor" id="upgrade_730_removed"></a>
Removed features</h2>
<ul>
<li>The methods <em>SetDeflection</em>, <em>SetEpsilonT</em>, <em>SetDiscretize</em> of the class <em>IntTools_EdgeFace</em> have been removed as redundant.</li>
<li>Deprecated functionality <em>V3d_View::Export()</em>, related enumerations Graphic3d_ExportFormat, Graphic3d_SortType as well as optional dependency from gl2ps library have been removed.</li>
</ul>
<h2><a class="anchor" id="upgrade_730_BuilderSolid"></a>
Boolean Operations - Solid Builder algorithm</h2>
<p>Previously, the unclassified faces of <em>BOPAlgo_BuilderSolid</em> algorithm (i.e. the faces not used for solids creation and located outside of all created solids) were used to form an additional (not closed) solid with INTERNAL orientation. Since the new version, these unclassified faces are no longer added into the resulting solids. Instead, the <a class="el" href="specification__boolean_operations.html#specification__boolean_ers">warning</a> with a list of these faces appears.</p>
<p>The following public methods of the <em>BOPAlgo_BuilderSolid</em> class have been removed as redundant:</p><ul>
<li><em>void SetSolid(const TopoDS_Solid&amp; theSolid);</em></li>
<li><em>const TopoDS_Solid&amp; Solid() const;</em></li>
</ul>
<h2><a class="anchor" id="upgrade_730_BRepAlgoBO"></a>
Boolean Operation classes in BRepAlgo are deprecated</h2>
<p>The API classes in the package BRepAlgo providing access to old Boolean operations are marked as deprecated:</p><ul>
<li>BRepAlgo_Fuse</li>
<li>BRepAlgo_Common</li>
<li>BRepAlgo_Cut</li>
<li>BRepAlgo_Section Corresponding classes from the package BRepAlgoAPI should be used instead.</li>
</ul>
<h2><a class="anchor" id="upgrade_730_replace_CDM_MessageDriver_interface_by_Message_Messenger"></a>
Unification of the Error/Warning reporting system of Application Framework</h2>
<p>Class <em>CDM_MessageDriver</em> and its descendants have been removed; class <em>Message_Messenger</em> is used instead in all OCAF packages. By default, messenger returned by <em>Message::DefaultMessenger()</em> is used, thus all messages generated by OCAF are directed in the common message queue of OCCT.</p>
<p>In classes implementing OCAF persistence for custom attributes (those inheriting from <em>BinMDF_ADriver</em>, <em>XmlMDF_ADriver</em>), uses of method <em>WriteMessage()</em> should be replaced by call to method <em>Send()</em> of the inherited field <em>myMessageDriver</em>. Note that this method takes additional argument indicating the gravity of the message (Trace, Info, Warning, Alarm, or Fail).</p>
<p>Class <em>Message_PrinterOStream</em> can be used instead of <em>CDM_COutMessageDriver</em> to direct all messages to a stream. If custom driver class is used in the application, that class shall be reimplemented inheriting from <em>Message_Printer</em> instead of <em>CDM_MessageDriver</em>. Method <em>Send()</em> should be redefined instead of method <em>Write()</em> of <em>CDM_MessageDriver</em>. To use the custom printer in OCAF, it can be either added to default messenger or set into the custom <em>Message_Messenger</em> object created in the method <em>MessageDriver()</em> of a class inheriting <em>CDF_Application</em>.</p>
<h1><a class="anchor" id="upgrade_occt740"></a>
Upgrade to OCCT 7.4.0</h1>
<h2><a class="anchor" id="upgrade_740_BRepPrimAPI_MakeRevol"></a>
Changes in BRepPrimAPI_MakeRevol algorithm</h2>
<p>Previously the algorithm could create a shape with the same degenerated edge shared between some faces. Now it is prevented. The algorithm creates the different copy of this edge for each face. The method <em>Generated(...)</em> has been changed in order to apply restriction to the input shape: input shape can be only of type VERTEX, EDGE, FACE or SOLID. For input shape of another type the method always returns empty list.</p>
<h2><a class="anchor" id="upgrade_740_removed"></a>
Removed features</h2>
<ul>
<li>The following methods of the class <em>BRepAlgoAPI_BooleanOperation</em> have been removed as obsolete or replaced:<ul>
<li><em>BuilderCanWork</em> can be replaced with <em>IsDone</em> or <em>HasErrors</em> method.</li>
<li><em>FuseEdges</em> removed as obsolete.</li>
<li><em>RefineEdges</em> replaced with new method <em>SimplifyResult</em>.</li>
</ul>
</li>
<li>The method <em>ImagesResult</em> of the class <em>BOPAlgo_BuilderShape</em> has been removed as unused. The functionality of this method can be completely replaced by the history methods <em>Modified</em> and <em>IsDeleted</em>.</li>
<li>The method <em>TrackHistory</em> of the classes <em>BOPAlgo_RemoveFeatures</em> and <em>BRepAlgoAPI_Defeaturing</em> has been renamed to <em>SetToFillHistory</em>.</li>
<li>The method <em>GetHistory</em> of the class <em>BRepAlgoAPI_Defeaturing</em> has been renamed to <em>History</em>.</li>
<li>The classes <em>BRepAlgo_BooleanOperations</em> and <em>BRepAlgo_DSAccess</em> have been removed as obsolete. Please use the BRepAlgoAPI_* classes to perform Boolean operations.</li>
<li><em>BRepAlgo_DataMapOfShapeBoolean</em> has been removed as unused.</li>
<li><em>BRepAlgo_DataMapOfShapeInterference</em> has been removed as unused.</li>
<li><em>BRepAlgo_EdgeConnector</em> has been removed as unused.</li>
<li><em>BRepAlgo_SequenceOfSequenceOfInteger</em> has been removed as unused.</li>
</ul>
<h2><a class="anchor" id="upgrade_740_localcontext"></a>
Local Context removal</h2>
<p>Previously deprecated Local Context functionality has been removed from AIS package, so that related methods have been removed from AIS_InteractiveContext interface: <em>HasOpenedContext()</em>, <em>HighestIndex()</em>, <em>LocalContext()</em>, <em>LocalSelector()</em>, <em>OpenLocalContext()</em>, <em>CloseLocalContext()</em>, <em>IndexOfCurrentLocal()</em>, <em>CloseAllContexts()</em>, <em>ResetOriginalState()</em>, <em>ClearLocalContext()</em>, <em>UseDisplayedObjects()</em>, <em>NotUseDisplayedObjects()</em>, <em>SetShapeDecomposition()</em>, <em>SetTemporaryAttributes()</em>, <em>ActivateStandardMode()</em>, <em>DeactivateStandardMode()</em>, <em>KeepTemporary()</em>, <em>SubIntensityOn()</em>, <em>SubIntensityOff()</em>, <em>ActivatedStandardModes()</em>, <em>IsInLocal()</em>, <em>AddOrRemoveSelected()</em> taking TopoDS_Shape.</p>
<p>A set of deprecated methods previously related to Local Context and now redirecting to other methods has been preserved to simplify porting; they will be removed in next release.</p>
<h2><a class="anchor" id="upgrade_740_geomconvert"></a>
Changes in behavior of Convert algorithms</h2>
<p>Now methods <em>GeomConvert::ConcatG1</em>, <em>GeomConvert::ConcatC1</em>, <em>Geom2dConvert::ConcatG1</em>, <em>Geom2dConvert::ConcatC1</em> modify the input argument representing the flag of closedness.</p>
<h2><a class="anchor" id="upgrade_740_selection"></a>
Changes in selection API and picked point calculation algorithm.</h2>
<p><em>SelectBasics_PickResult</em> structure has been extended, so that it now defines a 3D point on the detected entity in addition to Depth value along picking ray. <em>SelectMgr_SelectingVolumeManager::Overlap()</em> methods have been corrected to fill in <em>SelectBasics_PickResult</em> structure (depth and 3D point) instead of only depth value, so that custom <em>Select3D_SensitiveEntity</em> implementation should be updated accordingly (including <em>Select3D_SensitiveSet</em> subclasses).</p>
<h2><a class="anchor" id="upgrade_740_ocafpersistence"></a>
Document format version management improvement.</h2>
<p>Previously Document format version restored by <em>DocumentRetrievalDriver</em> was propagated using static methods of the corresponding units (like <em>MDataStd</em> or <em>MNaming</em>) to static variables of these units and after that became accessible to Drivers of these units. Now Document format version is available to drivers via <em>RelocationTable</em>. The Relocation table now keeps <em>HeaderData</em> of the document and a format version can be extracted in the following way: <em>theRelocTable.GetHeaderData()-&gt;StorageVersion()</em>. Obsolete methods: <em>static void SetDocumentVersion (const Standard_Integer DocVersion)</em> and <em>static Standard_Integer DocumentVersion()</em> have been removed from <em>BinMDataStd</em>, <em>BinMNaming</em>, <em>XmlMDataStd</em> and <em>XmlMNaming</em>.</p>
<h2><a class="anchor" id="upgrade_740_changed_api_of_brepmesh"></a>
BRepMesh - revision of the data model</h2>
<p>The entire structure of <em>BRepMesh</em> component has been revised and separated into several logically connected classes.</p>
<p>In new version, deflection is controlled more accurately, this may be necessary to tune parameters of call of the BRepMesh algorithm on the application side to obtain the same quality of presentation and/or performance as before.</p>
<p><em>BRepMesh_FastDiscret</em> and <em>BRepMesh_FastDiscretFace</em> classes have been removed.</p>
<p>The following changes have been introduced in the API of <em>BRepMesh_IncrementalMesh</em>, component entry point:</p><ul>
<li>Due to revised logic, <em>adaptiveMin</em> parameter of the constructor has been removed as meaningless;</li>
<li><em>BRepMesh_FastDiscret::Parameters</em> has been moved to a separate structure called <em>IMeshTools_Parameters</em>; the signatures of related methods have been changed correspondingly.</li>
<li>Interface of <em>BRepMesh_Delaun</em> class has been changed.</li>
</ul>
<p>Example of usage: Case 1 (explicit parameters): </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;IMeshData_Status.hxx&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;IMeshTools_Parameters.hxx&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;BRepMesh_IncrementalMesh.hxx&gt;</span></div>
<div class="line"> </div>
<div class="line">Standard_Boolean meshing_explicit_parameters()</div>
<div class="line">{</div>
<div class="line">  BRepMesh_IncrementalMesh aMesher (aShape, 0.1, Standard_False, 0.5, Standard_True);</div>
<div class="line">  <span class="keyword">const</span> Standard_Integer aStatus = aMesher.GetStatusFlags();</div>
<div class="line">  <span class="keywordflow">return</span> !aStatus;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">Standard_Boolean meshing_new()</div>
<div class="line">{</div>
<div class="line">  IMeshTools_Parameters aMeshParams;</div>
<div class="line">  aMeshParams.Deflection               = 0.1;</div>
<div class="line">  aMeshParams.Angle                    = 0.5;</div>
<div class="line">  aMeshParams.Relative                 = Standard_False;</div>
<div class="line">  aMeshParams.InParallel               = Standard_True;</div>
<div class="line">  aMeshParams.MinSize                  = Precision::Confusion();</div>
<div class="line">  aMeshParams.InternalVerticesMode     = Standard_True;</div>
<div class="line">  aMeshParams.ControlSurfaceDeflection = Standard_True;</div>
<div class="line"> </div>
<div class="line">  BRepMesh_IncrementalMesh aMesher (aShape, aMeshParams);</div>
<div class="line">  <span class="keyword">const</span> Standard_Integer aStatus = aMesher.GetStatusFlags();</div>
<div class="line">  <span class="keywordflow">return</span> !aStatus;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="upgrade_740_chamfer"></a>
Changes in API of Chamfer algorithms</h2>
<p>Some public methods of the class BRepFilletAPI_MakeChamfer are released from excess arguments:</p><ul>
<li>method Add for symmetric chamfer now takes only 2 arguments: distance and edge;</li>
<li>method GetDistAngle now takes only 3 arguments: index of contour, distance and angle.</li>
</ul>
<h2><a class="anchor" id="upgrade_740_aspects"></a>
Aspects unification</h2>
<p>Fill Area, Line and Marker aspects (classes <em>Graphic3d_AspectFillArea3d</em>, <em>Graphic3d_AspectLine3d</em>, <em>Graphic3d_AspectMarker3d</em> and <em>Graphic3d_AspectText3d</em>) have been merged into new class <em>Graphic3d_Aspects</em> providing a single state for rendering primitives of any type. The old per-primitive type aspect classes have been preserved as sub-classes of <em>Graphic3d_Aspects</em> with default values close to the previous behavior. All aspects except Graphic3d_AspectFillArea3d define Graphic3d_TOSM_UNLIT shading model.</p>
<p>The previous approach with dedicated aspects per primitive type was handy in simplified case, but lead to confusion otherwise. In fact, drawing points or lines with lighting applied is a valid use case, but only <em>Graphic3d_AspectFillArea3d</em> previously defined necessary material properties.</p>
<p>As aspects for different primitive types have been merged, Graphic3d_Group does no more provide per-type aspect properties. Existing code relying on old behavior and putting interleaved per-type aspects into single Graphic3d_Group should be updated. For example, the following pseudo-code will not work anymore, because all <em>SetGroupPrimitivesAspect</em> calls will setup the same property: </p><div class="fragment"><div class="line">Handle(Graphic3d_Group) aGroup = thePrs-&gt;NewGroup();</div>
<div class="line">aGroup-&gt;SetGroupPrimitivesAspect (myDrawer-&gt;ShadingAspect()-&gt;Aspect());</div>
<div class="line">aGroup-&gt;SetGroupPrimitivesAspect (myDrawer-&gt;LineAspect()-&gt;Aspect());    <span class="comment">//!&lt; overrides previous aspect</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line">Handle(Graphic3d_ArrayOfSegments) aLines = <span class="keyword">new</span> Graphic3d_ArrayOfSegments (2);</div>
<div class="line">Handle(Graphic3d_ArrayOfTriangles) aTris = <span class="keyword">new</span> Graphic3d_ArrayOfTriangles (3);</div>
<div class="line">aGroup-&gt;AddPrimitiveArray (aLines); <span class="comment">//!&lt; both arrays will use the same aspect</span></div>
<div class="line"><span class="comment"></span>aGroup-&gt;AddPrimitiveArray (aTris);</div>
</div><!-- fragment --><p>To solve the problem, the code should be modified to either put primitives into dedicated groups (preferred approach), or using <em>SetPrimitivesAspect</em> in proper order: </p><div class="fragment"><div class="line">Handle(Graphic3d_Group) aGroup = thePrs-&gt;NewGroup();</div>
<div class="line"> </div>
<div class="line">aGroup-&gt;SetGroupPrimitivesAspect (myDrawer-&gt;ShadingAspect()-&gt;Aspect());</div>
<div class="line">Handle(Graphic3d_ArrayOfTriangles) aTris = <span class="keyword">new</span> Graphic3d_ArrayOfTriangles (3);</div>
<div class="line">aGroup-&gt;AddPrimitiveArray (aTris);</div>
<div class="line"> </div>
<div class="line">Handle(Graphic3d_ArrayOfSegments) aLines = <span class="keyword">new</span> Graphic3d_ArrayOfSegments (2);</div>
<div class="line">aGroup-&gt;SetPrimitivesAspect (myDrawer-&gt;LineAspect()-&gt;Aspect()); <span class="comment">//!&lt; next array will use the new aspect</span></div>
<div class="line"><span class="comment"></span>aGroup-&gt;AddPrimitiveArray (aLines);</div>
</div><!-- fragment --><h2><a class="anchor" id="upgrade_740_materials"></a>
Material definition</h2>
<p>Decomposition of Ambient, Diffuse, Specular and Emissive properties has been eliminated within <em>Graphic3d_MaterialAspect</em> definition. As result, the following methods of <em>Graphic3d_MaterialAspect</em> class have been removed: SetReflectionMode(), SetReflectionModeOn(), Ambient(), Diffuse(), Emissive(), Specular(), SetAmbient(), SetDiffuse(), SetSpecular(), SetEmissive().</p>
<p>Previously, computation of final value required the following code: </p><div class="fragment"><div class="line">Graphic3d_MaterialAspect theMaterial; Quantity_Color theInteriorColor;</div>
<div class="line">Graphic3d_Vec3 anAmbient (0.0f);</div>
<div class="line"><span class="keywordflow">if</span> (theMaterial.ReflectionMode (Graphic3d_TOR_AMBIENT))</div>
<div class="line">{</div>
<div class="line">  anAmbient = theMaterial.MaterialType (Graphic3d_MATERIAL_ASPECT)</div>
<div class="line">            ? (Graphic3d_Vec3 )theInteriorColor           * theMaterial.Ambient()</div>
<div class="line">            : (Graphic3d_Vec3 )theMaterial.AmbientColor() * theMaterial.Ambient();</div>
<div class="line">}</div>
</div><!-- fragment --><p>New code looks like this: </p><div class="fragment"><div class="line">Graphic3d_MaterialAspect theMaterial; Quantity_Color theInteriorColor;</div>
<div class="line">Graphic3d_Vec3 anAmbient = theMaterial.AmbientColor();</div>
<div class="line"><span class="keywordflow">if</span> (theMaterial.MaterialType (Graphic3d_MATERIAL_ASPECT)) { anAmbient *= (Graphic3d_Vec3 )theInteriorColor; }</div>
</div><!-- fragment --><p>Existing code should be updated to:</p><ul>
<li>Replace Graphic3d_MaterialAspect::SetReflectionModeOff() with setting black color; SetReflectionModeOn() calls can be simply removed. R.g. theMaterial.SetAmbientColor(Quantity_NOC_BLACK).</li>
<li>Replace Graphic3d_MaterialAspect::Ambient(), SetAmbient(), Diffuse(), SetDiffuse(), Specular(), SetSpecular(), Emissive(), SetEmissive() with methods working with pre-multiplied color. E.g. theMaterial.SetAmbientColor(Graphic3d_Vec3 (1.0f, 0.0f, 0.0f) * 0.2f).</li>
<li>Avoid using Graphic3d_MaterialAspect::Color() and SetColor() with non-physical materials (Graphic3d_MATERIAL_ASPECT). These materials do not include color definition, because it is taken from Graphic3d_Aspects::InteriorColor() - this has not been changed. However, previously it was possible storing the color with SetColor() call and then fetching it with Color() by application code (the rendering ignored this value); now SetColor() explicitly ignores call for Graphic3d_MATERIAL_ASPECT materials and Color() returns DiffuseColor() multiplication coefficients.</li>
</ul>
<h2><a class="anchor" id="upgrade_740_text"></a>
Changes in Graphic3d_Text and OpenGl_Text API</h2>
<p>Parameters of <em>Text</em> in <em>Graphic3d_Group</em> are moved into a new <em>Graphic3d_Text</em> class. <em>AddText</em> of <em>Graphic3d_Group</em> should be used instead of the previous <em>Text</em>.</p>
<p>The previous code: </p><div class="fragment"><div class="line">Standard_Real x, y, z;</div>
<div class="line">theAttachmentPoint.Coord(x,y,z);</div>
<div class="line">theGroup-&gt;Text (theText,</div>
<div class="line">                Graphic3d_Vertex(x,y,z),</div>
<div class="line">                theAspect-&gt;Height(),</div>
<div class="line">                theAspect-&gt;Angle(),</div>
<div class="line">                theAspect-&gt;Orientation(),</div>
<div class="line">                theAspect-&gt;HorizontalJustification(),</div>
<div class="line">                theAspect-&gt;VerticalJustification());</div>
</div><!-- fragment --><p>should be replaced by the new code: </p><div class="fragment"><div class="line">Handle(Graphic3d_Text) aText = <span class="keyword">new</span> Graphic3d_Text (theAspect-&gt;Height());</div>
<div class="line">aText-&gt;SetText (theText.ToExtString());</div>
<div class="line">aText-&gt;SetPosition (theAttachmentPoint);</div>
<div class="line">aText-&gt;SetHorizontalAlignment (theAspect-&gt;HorizontalJustification());</div>
<div class="line">aText-&gt;SetVerticalAlignment (theAspect-&gt;VerticalJustification());</div>
<div class="line">theGroup-&gt;AddText (aText);</div>
</div><!-- fragment --><p><em>OpenGl_Text</em> contains <em>Graphic3d_Text</em> field.</p>
<p><em>OpenGl_TextParam</em> struct is removed. Constructor and <em>Init</em> of <em>OpenGl_Text</em> with <em>OpenGl_TextParam</em> are also removed. Instead of using them, change <em>OpenGl_Text</em>.</p>
<p>Please, note, that after modifying <em>OpenGl_Text</em>, <em>Reset</em> of <em>OpenGl_Text</em> should be called.</p>
<p><em>FormatParams</em> of <em>OpenGl_Text</em> is replaced by <em>Text</em>.</p>
<h2><a class="anchor" id="upgrade_740_prsupdate"></a>
Presentation invalidation</h2>
<p>Historically AIS_InteractiveObject provided two independent mechanisms invalidating presentation (asking presentation manager to recompute specific display mode or all modes):</p>
<ol type="1">
<li><em>AIS_InteractiveObject::SetToUpdate()</em>, marking existing presentation for update. This is main invalidation API, which is expected to be followed by <em>AIS_InteractiveContext::Update()</em> call.</li>
<li><em>AIS_InteractiveObject::myToRecomputeModes</em> + <em>myRecomputeEveryPrs</em>. This is auxiliary invalidation API, used internally by AIS_InteractiveContext::SetColor()/UnsetColor() and similar modification methods.</li>
</ol>
<p>The latter one has been removed to avoid confusion and unexpected behavior. In addition, two methods <em>AIS_InteractiveObject::Update()</em> have been deprecated in favor of new <em>AIS_InteractiveObject::UpdatePresentations()</em> recomputing only invalidated presentations.</p>
<p>Custom presentations implementing interface methods <em>AIS_InteractiveObject::SetColor()</em> and others should be revised to use <em>AIS_InteractiveObject::SetToUpdate()</em> or updating presentation without recomputation (see <em>AIS_InteractiveObject::SynchronizeAspects()</em> and <em>AIS_InteractiveObject::replaceAspects()</em>).</p>
<h2><a class="anchor" id="upgrade_740_interiorstyles"></a>
Interior styles</h2>
<ul>
<li><em>Aspect_IS_HOLLOW</em> is now an alias to <em>Aspect_IS_EMPTY</em> and does not implicitly enables drawing mesh edges anymore. Specify Graphic3d_AspectFillArea3d::SetDrawEdges(true) with Graphic3d_AspectFillArea3d::SetInteriorStyle(Aspect_IS_EMPTY) to get previous behavior of Aspect_IS_HOLLOW style.</li>
<li><em>Aspect_IS_HIDDENLINE</em> does not implicitly enables drawing mesh edges anymore. Specify Graphic3d_AspectFillArea3d::SetDrawEdges(true) with Graphic3d_AspectFillArea3d::SetInteriorStyle(Aspect_IS_HIDDENLINE) to get previous behavior of Aspect_IS_HIDDENLINE style.</li>
</ul>
<h2><a class="anchor" id="upgrade_740_modedprs"></a>
PrsMgr and SelectMgr hierarchy clean up</h2>
<p>Proxy classes <em>Prs3d_Presentation</em>, <em>PrsMgr_ModedPresentation</em> and <em>PrsMgr_Prs</em> have been removed. Code iterating through the list of low-level structures AIS_InteractiveObject::Presentations() should be updated to access PrsMgr_Presentation directly. Forward declarations of <em>Prs3d_Presentation</em> should be corrected, since it is now a typedef to <em>Graphic3d_Structure</em>.</p>
<p>Proxy classes <em>SelectBasics_SensitiveEntity</em> and <em>SelectBasics_EntityOwner</em> have been removed - <em>Select3D_SensitiveEntity</em> and <em>SelectMgr_EntityOwner</em> should be now used directly instead.</p>
<h2><a class="anchor" id="upgrade_740_offset"></a>
Polygon offset defaults</h2>
<p><em>Graphic3d_PolygonOffset</em> default constructor has been corrected to define Units=1 instead of Units=0. Default polygon offset settings Mode=Aspect_POM_Fill + Factor=1 + Units=1 are intended to push triangulation (Shaded presentation) a little bit behind of lines (Wireframe and Face Edges) for reducing z-fighting effect of Shaded+Wireframe combination. The change in defaults (Units changed from 0 to 1) is intended to cover scenario when camera direction is perpendicular to model plane (like 2D view).</p>
<p>Application observing unexpected visual difference on this change should consider customizing this property within AIS_InteractiveContext default attributes or on per-presentation basis via <em>Graphic3d_Aspects::SetPolygonOffset()</em> methods.</p>
<h2><a class="anchor" id="upgrade_740_zlayer"></a>
Adding ZLayers in given position</h2>
<p>Interface of insertion ZLayer in the viewer has been improved with ability to insert new layer before or after existing one. Previously undocumented behavior of <em>V3d_Viewer::AddZlayer()</em> method has been corrected to insert new layer before <em>Graphic3d_ZLayerId_Top</em>. Applications might need revising their custom layers creation code and specify precisely their order with new methods <em>V3d_Viewer::InsertLayerBefore()</em> and <em>V3d_Viewer::InsertLayerAfter()</em>.</p>
<h2><a class="anchor" id="upgrade_740_enum_changed"></a>
Modified enumerations</h2>
<p>Applications using integer values of the following enumerations in persistence should be corrected as these enumerations have been modified:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Name  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">AIS_TypeOfAttribute  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Aspect_InteriorStyle  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Font_FontAspect  </td></tr>
</table>
<h2><a class="anchor" id="upgrade_740_geproj"></a>
Custom defines within env.bat</h2>
<p><em>env.bat</em> produced by Visual Studio project generator <em>genproj.bat</em> has been modified so that <em>CSF_DEFINES%</em> variable is reset to initial state. Custom building environment relying on old behavior and setting extra macros within <em>CSF_DEFINES%</em> before env.bat should be updated to either modify custom.bat or setup new variable <em>CSF_DEFINES_EXTRA%</em> instead.</p>
<h2><a class="anchor" id="upgrade_740_BVH_in_BOP"></a>
Switching Boolean Operations algorithm to use BVH tree instead of UB tree</h2>
<p>Since OCCT 7.4.0 Boolean Operations algorithm uses BVH tree instead of UBTree to find the pairs of entities with interfering bounding boxes. The following API changes have been made:</p><ul>
<li>BOPTools_BoxBndTree and BOPTools_BoxBndTreeSelector have been removed. Use the BOPTools_BoxTree and BOPTools_BoxTreeSelector instead.</li>
<li>BOPTools_BoxSelector::SetBox() method now accepts the BVH_Box instead of Bnd_Box.</li>
<li>Methods BOPTools_BoxSelector::Reject and BOPTools_BoxSelector::Accept have been removed as unused.</li>
<li>The RunParallel flag has been removed from the list of parameters of BOPAlgo_Tools::IntersectVertices method. Earlier, it performed selection from the UB tree in parallel mode. Now all interfering pairs are found in one pass, using pair traverse of the same BVH tree.</li>
</ul>
<h2><a class="anchor" id="upgrade_740_stdnamespace"></a>
Standard_Stream.hxx no more has "using std::" statements</h2>
<p><em>Standard_Stream.hxx</em> header, commonly included by other OCCT header files, does no more add entities from <em>std namespace</em> related to streams (like <em>std::cout</em>, <em>std::istream</em> and others) into global namespace. The application code relying on this matter should be updated to either specify std namespace explicitly (like std::cout) or add "using std::" statements locally.</p>
<h1><a class="anchor" id="upgrade_occt750"></a>
Upgrade to OCCT 7.5.0</h1>
<h2><a class="anchor" id="upgrade_750_srgb_color"></a>
RGB color definition</h2>
<p>OCCT 3D Viewer has been improved to properly perform lighting using in linear RGB color space and then convert result into non-linear gamma-shifted sRGB color space before displaying on display. This change affects texture mapping, material definition and color definition.</p>
<p>Previously <em>Quantity_Color</em> definition was provided with unspecified RGB color space. In practice, mixed color spaces have been actually used, with non-linear sRGB prevailing in general. Since OCCT 7.5.0, <em>Quantity_Color</em> now specifies that components are defined in linear RGB color space.</p>
<p>This change affects following parts:</p><ul>
<li>Standard colors defined by <em>Quantity_NameOfColor</em> enumeration have been converted into linear RGB values within Quantity_Color construction.</li>
<li>Application may use new enumeration value <em>Quantity_TOC_sRGB</em> for passing/fetching colors in sRGB color space, which can be useful for interoperation with color picking widgets (returning 8-bit integer values within [0..255] range) or for porting colors constants within old application code without manual conversion.</li>
<li><em>Graphic3d_MaterialAspect</em> color components are now expected in linear RGB color space, and standard OCCT materials within <em>Graphic3d_NameOfMaterial</em> enumeration have been updated accordingly.</li>
<li>Texture mapping now handles new <em>Graphic3d_TextureRoot::IsColorMap()</em> for interpreting content in linear RGB or sRGB color space. It is responsibility of user specifying this flag correctly. The flag value is TRUE by default.</li>
<li>Method <em>Image_PixMap::PixelColor()</em> has been extended with a new Boolean flag for performing linearization of non-linear sRGB. This flag is FALSE by default; application should consider passing TRUE instead for further handling <em>Quantity_Color</em> properly as linear RGB values.</li>
</ul>
<h2><a class="anchor" id="upgrade_750_aspectwindow"></a>
Aspect_Window interface change</h2>
<p>Unexpected const-ness of Aspect_Window::DoResize() method has been removed, so that application classes implementing this interface should be updated accordingly.</p>
<h2><a class="anchor" id="upgrade_750_rename"></a>
Renaming of types</h2>
<p>Enumeration BRepOffset_Type is renamed to ChFiDS_TypeOfConcavity.</p>
<h2><a class="anchor" id="upgrade_750_BRepOffset_MakeOffset"></a>
change in construction of offset faces</h2>
<p>Now by default offset faces of non-planar faces may be planar faces if their originals can be approximated by planes.</p>
<h2><a class="anchor" id="upgrade_750_tkv3d"></a>
TKV3d/TKService toolkits changes</h2>
<p>The following changes could be highlighted while porting:</p><ul>
<li><em>Prs3d::GetDeflection()</em> has been moved to <em>StdPrs_ToolTriangulatedShape::GetDeflection()</em>.</li>
<li><em>Prs3d_ShapeTool</em> has been moved to <em>StdPrs_ShapeTool</em>.</li>
<li><em>StdSelect_ViewerSelector3d</em> has been moved to <em>SelectMgr_ViewerSelector3d</em>.</li>
<li><em>Font_BRepFont</em> has been moved to <em>StdPrs_BRepFont</em>.</li>
<li>Visualization classes now use <em>TopLoc_Datum3D</em> (from <em>TKMath</em>) instead of <em>Geom_Transformation</em> (from <em>TKG3d</em>) as smart pointer to <em>gp_Trsf</em>. This is rather an internal change, but some applications might need to be updated.</li>
</ul>
<h2><a class="anchor" id="upgrade_750_hlrangle"></a>
Prs3d_Drawer deviation angle</h2>
<p>Properties Prs3d_Drawer::HLRAngle() and Prs3d_Drawer::HLRDeviationCoefficient() have been removed from classes <em>Prs3d_Drawer</em>, <em>AIS_Shape</em> and <em>AIS_InteractiveContext</em>. Prs3d_Drawer::DeviationAngle() should be now used instead of Prs3d_Drawer::HLRAngle() and Prs3d_Drawer::DeviationCoefficient() instead of Prs3d_Drawer::HLRDeviationCoefficient(). The default value of Prs3d_Drawer::DeviationAngle() property has been changed from 12 to 20 degrees to match removed Prs3d_Drawer::HLRAngle(), previously used as input for triangulation algorithm.</p>
<h2><a class="anchor" id="upgrade_750_hlrprs"></a>
Changes in HLR presentation API</h2>
<p>Methods computing HLR presentation within <em>PrsMgr_PresentableObject::Compute()</em> have been renamed to <em>PrsMgr_PresentableObject::computeHLR()</em> and now accept <em>Graphic3d_Camera</em> object instead of removed <em>Prs3d_Projector</em>.</p>
<h2><a class="anchor" id="upgrade_750_dimensions"></a>
Dimension and Relation presentations moved from AIS to PrsDim</h2>
<p>Presentation classes displaying Dimensions and Relations have been moved from <em>AIS</em> package to <em>PrsDim</em>. Corresponding classes should be renamed in application code (like <em>AIS_LengthDimension</em> -&gt; <em>PrsDim_LengthDimension</em>).</p>
<h2><a class="anchor" id="upgrade_750_sensitiveEntity"></a>
Select3D_SensitiveEntity interface change</h2>
<p>The method Select3D_SensitiveEntity::NbSubElements() has been changed to be constant. Select3D_SensitiveEntity subclasses at application level should be updated accordingly.</p>
<h2><a class="anchor" id="upgrade_750_Booleans"></a>
Changes in Boolean operations algorithm</h2>
<ul>
<li>TreatCompound method has been moved from <em>BOPAlgo_Tools</em> to <em>BOPTools_AlgoTools</em>. Additionally, the map parameter became optional: <div class="fragment"><div class="line"><span class="keywordtype">void</span> BOPTools_AlgoTools::TreatCompound (<span class="keyword">const</span> TopoDS_Shape&amp; theS,</div>
<div class="line">                                        TopTools_ListOfShape&amp; theLS,</div>
<div class="line">                                        TopTools_MapOfShape* theMap = NULL);</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="upgrade_750_Adaptor2d_OffsetCurve"></a>
Offset direction change</h2>
<p>Offset direction, which used in class Adaptor2d_OffsetCurve for evaluating values and derivatives of offset curve is unified for offset direction used in class Geom2d_OffsetCurve: now offset direction points to outer ("right") side of base curve instead of the previously used inner ("left") side. Old usage of class in any application should be changed something like that:</p>
<p>Adaptor2d_OffsetCurve aOC(BaseCurve, Offset) --&gt; Adaptor2d_OffsetCurve aOC(BaseCurve, -Offset)</p>
<h2><a class="anchor" id="upgrade_750_ProgressIndicator"></a>
Change of progress indication API</h2>
<p>The progress indication mechanism has been revised to eliminate its weak points in previous design (leading to implementation mistakes). Redesign also allows using progress indicator in multi-threaded algorithms in more straight-forward way with minimal overhead. Note however, that multi-threaded algorithm should pre-allocate per-task progress ranges in advance to ensure thread-safety - see examples in documentation of class Message_ProgressScope for details.</p>
<p>Classes Message_ProgressSentry and Message_ProgressScale have been removed. New classes Message_ProgressScope and Message_ProgressRange should be used as main API classes to organize progress indication in the algorithms. Instances of the class Message_ProgressRange are used to pass the progress capability to nested levels of the algorithm, and an instance of the class Message_ProgressScope is to be created (preferably as local variable) to manage progress at each level of the algorithm. The instance of Message_ProgressIndicator is not passed anymore to sub-algorithms. See documentation of the class Message_ProgressScope for more details and examples.</p>
<p>Methods to deal with progress scopes and to advance progress are removed from class Message_ProgressIndicator; now it only provides interface to the application-level progress indicator. Virtual method Message_ProgressIndicator::Show() has changed its signature and should be updated accordingly in descendants of Message_ProgressIndicator. The scope passed as argument to this method can be used to obtain information on context of the current process (instead of calling method GetScope() in previous implementation). Methods Show(), UserBreak(), and Reset() are made protected in class Message_ProgressIndicator; methods More() or UserBreak() of classes Message_ProgressScope or Message_ProgressRange should be used to know if the cancel event has come. See documentation of the class Message_ProgressIndicator for more details and implementation of Draw_ProgressIndicator for an example.</p>
<p>Let's take a look onto typical algorithm using an old API: </p><div class="fragment"><div class="line">class MyAlgo</div>
<div class="line">{</div>
<div class="line">public:</div>
<div class="line">  //! Algorithm entry point taking an optional Progress Indicator.</div>
<div class="line">  bool Perform (const TCollection_AsciiString&amp; theFileName,</div>
<div class="line">                const Handle(Message_ProgressIndicator)&amp; theProgress = Handle(Message_ProgressIndicator)())</div>
<div class="line">  {</div>
<div class="line">    Message_ProgressSentry aPSentry (theProgress, (TCollection_AsciiString(&quot;Processing &quot;) + theFileName).ToCString(), 2);</div>
<div class="line">    {</div>
<div class="line">      Message_ProgressSentry aPSentry1 (theProgress, &quot;Stage 1&quot;, 0, 153, 1);</div>
<div class="line">      for (int anIter = 0; anIter &lt; 153; ++anIter, aPSentry1.Next())</div>
<div class="line">      { </div>
<div class="line">        if (!aPSentry1.More()) { return false; } </div>
<div class="line">        // do some job here...</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    aPSentry.Next();</div>
<div class="line">    {</div>
<div class="line">      perform2 (theProgress);</div>
<div class="line">    }</div>
<div class="line">    aPSentry.Next();</div>
<div class="line">    bool wasAborted = !theProgress.IsNull() &amp;&amp; theProgress-&gt;UserBreak();</div>
<div class="line">    return !wasAborted;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">private:</div>
<div class="line">  //! Nested sub-algorithm taking Progress Indicator.</div>
<div class="line">  bool perform2 (const Handle(Message_ProgressIndicator)&amp; theProgress)</div>
<div class="line">  {</div>
<div class="line">    Message_ProgressSentry aPSentry2 (theProgress, &quot;Stage 2&quot;, 0, 100, 1);</div>
<div class="line">    for (int anIter = 0; anIter &lt; 100 &amp;&amp; aPSentry2.More(); ++anIter, aPSentry2.Next()) {}</div>
<div class="line">    return !aPSentry2.UserBreak();</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">// application executing an algorithm</div>
<div class="line">Handle(Message_ProgressIndicator) aProgress = new MyProgress();</div>
<div class="line">MyAlgo anAlgo;</div>
<div class="line">anAlgo.Perform (&quot;FileName&quot;, aProgress);</div>
</div><!-- fragment --><p>The following guidance can be used to update such code:</p><ul>
<li>Replace <code>const Handle(Message_ProgressIndicator)&amp;</code> with <code>const Message_ProgressRange&amp;</code> in arguments of the methods that support progress indication. Message_ProgressIndicator object should be now created only at place where application starts algorithms.</li>
<li>Replace <code>Message_ProgressSentry</code> with <code>Message_ProgressScope</code>. Take note that Message_ProgressScope has less arguments (no "minimal value"). In other aspects, Message_ProgressScope mimics an iterator-style interface (with methods More() and Next()) close to the old Message_ProgressSentry (pay attention to extra functionality of Message_ProgressScope::Next() method below). Note that method Message_ProgressScope::Close() is equivalent of the method Relieve() of Message_ProgressSentry in previous version. Class Message_ProgressSentry is still defined (marked as deprecated) providing API more close to old one, and can be still used to reduce porting efforts.</li>
<li>Each Message_ProgressScope should take the next Range object to work with. Within old API, Message_ProgressSentry received the root Progress Indicator object which maintained the sequence of ranges internally. Message_ProgressScope in new API takes Message_ProgressRange, which should be returned by Message_ProgressScope::Next() method of the parent scope. Do not use the same Range passed to the algorithm for all sub-Scopes like it was possible in old API; each range object may be used only once.</li>
</ul>
<p>Take a look onto ported code and compare with code above to see differences:</p>
<div class="fragment"><div class="line">class MyAlgo</div>
<div class="line">{</div>
<div class="line">public:</div>
<div class="line">  //! Algorithm entry point taking an optional Progress Range.</div>
<div class="line">  bool Perform (const TCollection_AsciiString&amp; theFileName,</div>
<div class="line">                const Message_ProgressRange&amp; theProgress = Message_ProgressRange())</div>
<div class="line">  {</div>
<div class="line">    Message_ProgressScope aPSentry (theProgress, TCollection_AsciiString(&quot;Processing &quot;) + theFileName, 2);</div>
<div class="line">    {</div>
<div class="line">      Message_ProgressScope aPSentry1 (aPSentry.Next(), &quot;Stage 1&quot;, 153);</div>
<div class="line">      for (int anIter = 0; anIter &lt; 153; ++anIter, aPSentry1.Next())</div>
<div class="line">      { </div>
<div class="line">        if (!aPSentry1.More()) { return false; };</div>
<div class="line">        // do some job here...</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    {</div>
<div class="line">      perform2 (aPSentry.Next());</div>
<div class="line">    }</div>
<div class="line">    bool wasAborted = aPSentry.UserBreak();</div>
<div class="line">    return !wasAborted;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  //! Nested sub-algorithm taking Progress sub-Range.</div>
<div class="line">  bool perform2 (const Message_ProgressRange&amp; theProgress)</div>
<div class="line">  {</div>
<div class="line">    Message_ProgressScope aPSentry2 (theProgress, &quot;Stage 2&quot;, 100);</div>
<div class="line">    for (int anIter = 0; anIter &lt; 100 &amp;&amp; aPSentry2.More(); ++anIter, aPSentry2.Next()) {}</div>
<div class="line">    return !aPSentry2.UserBreak();</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">// application executing an algorithm</div>
<div class="line">Handle(Message_ProgressIndicator) aProgress = new MyProgress();</div>
<div class="line">MyAlgo anAlgo;</div>
<div class="line">anAlgo.Perform (&quot;FileName&quot;, aProgress-&gt;Start());</div>
</div><!-- fragment --><h2><a class="anchor" id="upgrade_750_message_messenger"></a>
Message_Messenger interface change</h2>
<p>Operators &lt;&lt; with left argument <em>Handle(Message_Messenger)</em>, used to output messages with a stream-like interface, have been removed. This functionality is provided now by separate class <em>Message_Messenger::StreamBuffer</em>. That class contains a stringstream buffer which can be filled using standard stream operators. The string is sent to a messenger on destruction of the buffer object, call of its method Flush(), or using operator &lt;&lt; with one of ostream manipulators (<em>std::endl, std::flush, std::ends</em>). Manipulator <em>Message_EndLine</em> has been removed, <em>std::endl</em> should be used instead.</p>
<p>New methods <em>SendFail(), SendAlarm(), SendWarning(), SendInfo()</em>, and <em>SendTrace()</em> are provided in both <em>Message_Messenger</em> class and as static functions in <em>Message</em> package (short-cuts to default messenger), returning buffer object for the output of corresponding type of the message.</p>
<p>The code that used operator &lt;&lt; for messenger, should be ported as follows.</p>
<p>Before the change: </p><div class="fragment"><div class="line">Handle(Message_Messenger) theMessenger = ...;</div>
<div class="line">theMessenger &lt;&lt; <span class="stringliteral">&quot;Value = &quot;</span> &lt;&lt; anInteger &lt;&lt; Message_EndLine;</div>
</div><!-- fragment --><p>After the change, single-line variant: </p><div class="fragment"><div class="line">Handle(Message_Messenger) theMessenger = ...;</div>
<div class="line">theMessenger-&gt;SendInfo() &lt;&lt; <span class="stringliteral">&quot;Value = &quot;</span> &lt;&lt; anInteger &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>After the change, extended variant: </p><div class="fragment"><div class="line">Handle(Message_Messenger) theMessenger = ...;</div>
<div class="line">Message_Messenger::StreamBuffer aSender = theMessenger-&gt;SendInfo();</div>
<div class="line">aSender &lt;&lt; <span class="stringliteral">&quot;Array: [ &quot;</span>;</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; aNb; ++i) { aSender &lt;&lt; anArray[i] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>; }</div>
<div class="line">aSender &lt;&lt; <span class="stringliteral">&quot;]&quot;</span> &lt;&lt; std::endl; <span class="comment">// aSender can be used further for other messages</span></div>
</div><!-- fragment --><h2><a class="anchor" id="upgrade_750_message_printer"></a>
Message_Printer interface change</h2>
<p>Previously, sub-classes of <em>Message_Printer</em> have to provide a triplet of <em>Message_Printer::Send()</em> methods accepting different string representations: TCollection_AsciiString, TCollection_ExtendedString and Standard_CString. <em>Message_Printer</em> interface has been changed, so that sub-classes now have to implement only single method <em>Message_Printer::send()</em> accepting TCollection_AsciiString argument and having no Endl flag, which has been removed. Old three Message_Printer::Send() methods remain defined virtual with unused last argument and redirecting to new send() method by default.</p>
<h2><a class="anchor" id="upgrade_750_prd3d_root"></a>
Prs3d_Root deprecation</h2>
<p>Redundant class Prs3d_Root has been marked as deprecated - Prs3d_Presentation::NewGroup() should be called directly.</p>
<h2><a class="anchor" id="upgrade_750_cdf_session"></a>
Support of multiple OCAF application instances</h2>
<p>Class <em>CDF_Session</em> has been removed. That class was used to store global instance of OCAF application (object of class <em>CDM_Application</em> or descendant, typically <em>TDataStd_Application</em>). Global directory of all opened OCAF documents has been removed as well; such directory is maintained now by each instance of the <em>CDM_Application</em> class.</p>
<p>This allows creating programs that work with different OCAF documents concurrently in parallel threads, provided that each thread deals with its own instance of <em>TDataStd_Application</em> and documents managed by this instance.</p>
<p>Note that neither <em>TDataStd_Application</em> nor <em>TDocStd_Document</em> is protected from concurrent access from several threads. Such protection, if necessary, shall be implemented on the application level. For an example, access to labels and attributes could be protected by mutex if there is a probability that different threads access the same labels / attributes: </p><div class="fragment"><div class="line">{</div>
<div class="line">  Standard_Mutex::Sentry aSentry (myMainLabelAccess);</div>
<div class="line">  TDF_Label aChildLab = aDocument-&gt;Main().NewChild();</div>
<div class="line">  TDataStd_Integer::Set(aChildLab, 0);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="upgrade_750_draw_hotkeys"></a>
Draw Harness hotkeys</h2>
<p>Draw Harness hotkeys <b>W</b> (Wireframe) and <b>S</b> (Shaded) have been re-mapped to <b>Ctrl+W</b> and <b>Ctrl+S</b>. Hotkey <b>A</b> has been remapped to <b>Backspace</b>. Hotkeys WASD and Arrays are now mapped for walk-through navigation in 3D Viewer.</p>
<h2><a class="anchor" id="upgrade_750_msgfile_utf8"></a>
Utf-8 encoding for message files</h2>
<p>Message files (with extension .msg) are now expected to be in UTF-8 encoding (unless they have UTF-16 BOM in which case UTF-16 is expected). This allows using arbitrary Unicode symbols for localization of messages.</p>
<p>Existing message files containing 8-bit characters (previously interpreted as characters from Latin-1 code block) should be converted to UTF-8.</p>
<h1><a class="anchor" id="upgrade_occt760"></a>
Upgrade to OCCT 7.6.0</h1>
<h2><a class="anchor" id="upgrade_760_handle_adaptors"></a>
Simplification of surface/curve adaptor</h2>
<p>Interfaces <em>Adaptor2d_Curve2d</em>, <em>Adaptor3d_Curve</em> and <em>Adaptor3d_Surface</em> now inherit Standard_Transient and can be Handle-managed. No more necessary parallel hiererchy of classes <em>Adaptor2d_HCurve2d</em>, <em>Adaptor3d_HCurve</em> and <em>Adaptor3d_HSurface</em> (generated from generic templates by WOK) has been eliminated. Existing code using old Handle classes should be updated to:</p><ul>
<li>Rename occurrences of old names (remove H suffix); upgrade.bat could be used for that purpose.</li>
<li>Replace redundant calls to previously declared methods .GetCurve2d()/.GetCurve()/.GetSurface() with the common operator-&gt;() syntax.</li>
<li>Pay attention on code calling GetSurface()/GetCurve() methods of removed handle classes. Such places should be replaced with Handle dereference.</li>
</ul>
<h2><a class="anchor" id="upgrade_760_extendedstring_cout"></a>
Output of TCollection_ExtendedString to stream</h2>
<p>Behavior of the method TCollection_ExtendedString::Print(Standard_OStream&amp;) and corresponding operator &lt;&lt; has changed. Previously it printed all Latin-1 symbols (those in range 0x80-0xff) as '\0' (effectively losing them); symbols above 0xff were converted to hex representation (formatted like XML Numeric Character Reference). Now all symbols are sent to stream as UTF-8 byte sequences. Existing code relying on old behavior, if any, shall be rewritten.</p>
<h2><a class="anchor" id="upgrade_760_trimming_surface"></a>
Trimming surface</h2>
<p>Geom_RectangularTrimmedSurface sequentially trimming in U and V directions already no longer loses the first trim. For example: </p><div class="fragment"><div class="line">Handle(Geom_RectangularTrimmedSurface) ST  = <span class="keyword">new</span> Geom_RectangularTrimmedSurface (Sbase, u1, u2, Standard_True); <span class="comment">// trim along U</span></div>
<div class="line">Handle(Geom_RectangularTrimmedSurface) ST1 = <span class="keyword">new</span> Geom_RectangularTrimmedSurface (ST, v1, v2, Standard_False); <span class="comment">// trim along V</span></div>
</div><!-- fragment --><p>gives different result. In current version ST1 - surface trimmed only along V, U trim is removed; After modification ST1 - surface trimmed along U and V, U trim is kept.</p>
<h2><a class="anchor" id="upgrade_760_storageformatversion"></a>
Storage format version of OCAF document</h2>
<p>The methods <em>XmlLDrivers::StorageVersion()</em> and <em>BinLDrivers::StorageVersion()</em> were removed. Since now <em>TDocStd_Document</em> manipulates the storage format version of a document for both XML and binary file formats. For this the methods <em>StorageFormatVersion()</em> and <em>ChangeStorageFormatVersion()</em> were moved from <em>CDM_Document</em> to <em>TDocStd_Document</em>. The methods are used to get and set the storage format version of a document. A new enumeration <em>TDocStd_FormatVersion</em> lists the storage format versions of a document. By default, the document uses the latest (current) storage format version. In order to save a document in an older storage format version, call the method <em>ChangeStorageFormatVersion()</em> with one of the values from the enumeration. This value will be used by storage drivers of a corresponding OCAF file format (XML or binary) and the document will be saved following the rules of the specified storage format version (corresponding to an older version of Open CASCADE Technology). This way an application based on an old version of Open CASCADE Technology may read documents saved by new applications (based on newer version of Open CASCADE Technology).</p>
<h2><a class="anchor" id="upgrade_760_createdocument"></a>
New OCAF document</h2>
<p>A new OCAF document may be created only by means of the method <em>NewDocument()</em> from CDF_Application (redefined in TDocStd_Application). The methods <em>CreateDocument()</em> are deleted in all retrieval drivers.</p>
<h2><a class="anchor" id="upgrade_760_changesInStorageOfShapes"></a>
Changes in storage of shapes</h2>
<p>Information about per-vertex triangulations normals is now stored in BinOCAF and XmlOCAF document, BRep and Binary BRep Shape formats (only in case of triangulation-only Faces, with no analytical geometry to restore normals).</p>
<p>Versions of formats have been changed (11 for BinOCAF, 10 for XmlOCAF, 4 for BRep Shape and 3 for Binary BRep Shape). Files written with the new version will not be readable by applications of old versions.</p>
<h2><a class="anchor" id="upgrade_760_changesBinaryFormat"></a>
Changes in storage of binary document format</h2>
<p>All kinds of binary document formats since the new version 12 saved with support of partial reading (sub-set of labels and sub-set of attributes). For that the shapes data structures are stored with the related NamedShape attributes in the file, not in the particular section in the start of the document. Also, size allocated for each label is stored in the file. This allows to skip big parts of document in partial reading mode if needed.</p>
<p>As a result, the new binary files become some smaller, but default reading and writing of documents may take some more time (depenging on the environment), up to 15 percents slower in the worse cases. Backward compatibility (loading of old documents in the newer version) is still fully supported, as well as writing the older versions of the document.</p>
<h2><a class="anchor" id="upgrade_occt760_poly"></a>
Changes in &lt;em&gt;Poly&lt;/em&gt; package and &lt;em&gt;Poly_Triangulation&lt;/em&gt; class</h2>
<p><em>Poly_Triangulation</em> does no more provide access to internal array structures: methods Nodes(), ChangeNode(), Triangles(), ChangeTriangle(), UVNodes(), ChangeUVNode(), Normals() have been removed. Methods of <em>Poly_Triangulation</em> for accessing individual nodal properties / triangles by index and implementing copy semantics should be used instead. The same is applicable to <em>Poly_PolygonOnTriangulation</em> interface.</p>
<h2><a class="anchor" id="upgrade_occt760_glsl"></a>
Custom GLSL programs</h2>
<p>Accessors to standard materials have been modified within <em>Declarations.glsl</em> (<em>occFrontMaterial_Diffuse()</em> -&gt; <em>occMaterial_Diffuse(bool)</em> and similar). Applications defining custom GLSL programs should take into account syntax changes.</p>
<h2><a class="anchor" id="upgrade_occt760_noral_colors"></a>
Nodal color modulation</h2>
<p>Nodal color vertex attribute is now modulated in the same way as a color texture - color is multiplied by material coefficients (diffuse/ambient/specular in case of a common material definition). Existing code defining nodal colors should be updated to:</p><ul>
<li>Use <em>Graphic3d_TOSM_UNLIT</em> shading model when lighting is not needed.</li>
<li>Adjust diffuse/ambient material coefficients, which have been previously ignored.</li>
<li>Remove code multiplying nodal colors, intended to compensate over-brightness due to addition of specular color from material definition, as specular component is now also modulated by a vertex color.</li>
</ul>
<h2><a class="anchor" id="upgrade_occt760_tkopengles"></a>
TKOpenGles library</h2>
<p>OCCT now provides two separate toolkits - <em>TKOpenGl</em> depending on desktop OpenGL and <em>TKOpenGles</em> depending on OpenGL ES. Both libraries can be now built simultaneously on systems providing both APIs (like desktop Linux).</p>
<p>Existing applications depending on OpenGL ES (mobile projects first of all) should be adjusted to link against <em>TKOpenGles</em>. Note that both <em>TKOpenGl</em> and <em>TKOpenGles</em> keep exporting classes with the same name, so applications should not attempt to link both libraries simultaneously.</p>
<h2><a class="anchor" id="upgrade_occt760_fast_access_to_labels"></a>
Fast access to OCAF label</h2>
<p>Access to an OCAF label via its entry is accelerated. In order to activate it, call <em>TDF_Data::SetAccessByEntries()</em>. The method <em>TDF_Tool::Label()</em>, which returns a label by an entry, becomes faster for about 10 .. 20 times. It has sense for applications, which use an entry as a unique key to access the data in OCAF tree. Also, the method <em>TDF_Tool::Entry()</em>, which returns an entry for a label, is accelerated as well.</p>
<h2><a class="anchor" id="upgrade_occt760_bop_progress_indicator"></a>
Progress indicator in Boolean operations</h2>
<p>Method SetProgressIndicator() has been removed due to Progress indicator mechanism refactoring. To enable progress indicator and user break in Boolean operations user has to pass progress range as a parameter to Perform or Build method. For example: </p><div class="fragment"><div class="line">Handle(Draw_ProgressIndicator) aProgress = new Draw_ProgressIndicator(di, 1);</div>
<div class="line">BRepAlgoApi_Cut(S1, S2, aProgress-&gt;Start()); // method Start() creates range for usage in cut algorithm</div>
</div><!-- fragment --><h2><a class="anchor" id="upgrade_occt760_change_check_to_adaptors"></a>
Changes in BRepLib_CheckCurveOnSurface &amp; GeomLib_CheckCurveOnSurface interfaces</h2>
<p>Now the classes accept adaptors instead objects as input parameters. <em>BRepLib_CheckCurveOnSurface</em> does no more provide access to curves, surface and parameters: methods PCurve(), PCurve2(), Surface() and Range() have been removed. <em>BRepLib_CheckCurveOnSurface</em>: the default value of the <em>isMultiThread</em> parameter of the <em>Perform()</em> function has been changed from <em>true</em> to <em>false</em> <em>GeomLib_CheckCurveOnSurface</em> does no more provide access to curve, surface and parameters: methods Curve(), Surface() and Range() have been removed. <em>GeomLib_CheckCurveOnSurface</em>: the default value of the <em>isMultiThread</em> parameter of the <em>Perform()</em> function has been changed from <em>true</em> to <em>false</em></p>
<p>The following functions in <em>GeomLib_CheckCurveOnSurface</em> have been modified: </p><div class="fragment"><div class="line">GeomLib_CheckCurveOnSurface(<span class="keyword">const</span> Handle(Adaptor3d_Curve)&amp; theCurve,</div>
<div class="line">                            <span class="keyword">const</span> Standard_Real theTolRange);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Init (<span class="keyword">const</span> Handle(Adaptor3d_Curve)&amp; theCurve, <span class="keyword">const</span> Standard_Real theTolRange);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Perform(<span class="keyword">const</span> Handle(Adaptor3d_CurveOnSurface)&amp; theCurveOnSurface,</div>
<div class="line">             <span class="keyword">const</span> Standard_Boolean isMultiThread);</div>
</div><!-- fragment --><h2><a class="anchor" id="upgrade_occt760_old_bop_removed"></a>
Removal of old Boolean operations algorithm (BRepAlgo_BooleanOperation)</h2>
<ul>
<li>The method <em>BRepAlgo_Tool::Deboucle3D</em> has been removed as duplicating. The corresponding method from <em>BRepOffset_Tool</em> class has to be used instead.</li>
<li>The API classes from <em>BRepAlgo</em> package performing old Boolean operations algorithm have been removed:<ul>
<li><em>BRepAlgo_BooleanOperation</em></li>
<li><em>BRepAlgo_Fuse</em></li>
<li><em>BRepAlgo_Common</em></li>
<li><em>BRepAlgo_Cut</em></li>
<li><em>BRepAlgo_Section</em> The corresponding classes from the <em>BRepAlgoAPI</em> package have to be used instead.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="upgrade_occt770"></a>
Upgrade to OCCT 7.7.0</h1>
<p>Building OCCT now requires C++11-compliant compiler, so that some legacy compilers (Visual Studio 2010 and 2012) are no more supported. It is recommended using Visual Studio 2015 or newer for building OCCT on Windows platform.</p>
<h2><a class="anchor" id="upgrade_770_removed_features"></a>
Removed features</h2>
<ul>
<li>One of the constructors of the BRepExtrema_DistanceSS class (the one without deflection parameter) has been removed as excessive. The remaining constructor has to be used instead.</li>
</ul>
<h2><a class="anchor" id="upgrade_occt770_parallel_flag_removed"></a>
Removed parameter theIsParallel from Put/Compute/Perform</h2>
<p>theIsParallel parameter has been removed from Put/Compute/Perform from the next classes:</p><ul>
<li>BRepCheck_Analyzer</li>
<li>BRepCheck_Edge</li>
<li>BRepLib_ValidateEdge</li>
<li>GeomLib_CheckCurveOnSurface</li>
<li>BRepLib_CheckCurveOnSurface</li>
</ul>
<p>Now, to set this flag, it is necessary to use method SetParallel() For example: </p><div class="fragment"><div class="line">BRepLib_ValidateEdge aValidateEdge(myHCurve, ACS, SameParameter);</div>
<div class="line">aValidateEdge.SetParallel(toRunParallel);</div>
<div class="line">aValidateEdge.Process();</div>
</div><!-- fragment --><h2><a class="anchor" id="upgrade_occt770_drawer_aspects"></a>
Prs3d_Drawer aspects</h2>
<p><code>Prs3d_Drawer</code> getters no more implicitly create "default" aspects. If specific property has not been set before to this drawer instance nor to linked drawer instance, then NULL property will be returned. Make sure to set property beforehand or to call <code>SetOwn*</code> / <code>SetupOwn*</code> methods to derive from defaults.</p>
<h2><a class="anchor" id="upgrade_occt770_opengl"></a>
OpenGL functions</h2>
<p>Applications extending OCCT 3D Viewer and calling OpenGL functions directly (like <code>::glEnable()</code>, e.g. using global namespace) might be affected by changes in <code>OpenGl_GlFunctions.hxx</code>. This header, as well as <code>OpenGl_GlCore20.hxx</code> and similar, no more include system OpenGL / OpenGL ES headers to define function table. Application code calling OpenGL functions directly should be changed to either use <code>OpenGl_Context::core11fwd</code> (as designed) or to include system OpenGL headers in advance (with help of <code>OpenGl_GlNative.hxx</code>).</p>
<h2><a class="anchor" id="upgrade_occt770_tooltriangulatedshape"></a>
StdPrs_ToolTriangulatedShape</h2>
<p>Method <code>StdPrs_ToolTriangulatedShape::Normal()</code> has been removed. Please use <code>BRepLib_ToolTriangulatedShape::ComputeNormals()</code> to fill in normal attributes in triangulation and fetch them directly using <code>Poly_Triangulation::Normal()</code>.</p>
<h2><a class="anchor" id="upgrade_occt770_shapeproximity"></a>
BRepExtrema_ShapeProximity</h2>
<p>A new way of using the <code>BRepExtrema_ShapeProximity</code> class was provided for computing a proximity value between two shapes. If at initialization of the <code>BRepExtrema_ShapeProximity</code> class the <em>theTolerance</em> parameter is not defined (Precision::Infinite() by default), the proximity value will be computed.</p>
<h1><a class="anchor" id="upgrade_occt780"></a>
Upgrade to OCCT 7.8.0</h1>
<h2><a class="anchor" id="upgrade_780_recommendations"></a>
New Features and Recommendations</h2>
<p>The NCollection containers have been modernized to work with move semantics through the new <code>Move operator</code> and <code>Move constructor</code>. It is recommended to leverage this functionality in the development process.<br  />
 Backward compatibility with STL allocators has been implemented to use the OCCT memory manager with STL allocators (NCollection_Allocator, NCollection_OccAllocator).<br  />
 Additionally, utilities have been introduced to work with <code>shared_ptr</code> and <code>unique_ptr</code> using the OCCT memory manager (<code>Standard_MemoryUtils.hxx</code>).</p>
<h2><a class="anchor" id="upgrade_780_ncollection_update"></a>
Change in Default Clear Behavior for Containers</h2>
<p>NCollection container's <code>Clear(const bool theReleaseMemory = true)</code> have been changed to <code>Clear(const bool theReleaseMemory = false)</code>.<br  />
 Impacted classes include <code>IndexedMap</code>, <code>IndexedDataMap</code>, <code>Map</code>, <code>DataMap</code>, <code>DynamicArray(Vector)</code>, <code>IncAllocator</code>.<br  />
 This means that allocated memory for the container will be reused. In this case, it's necessary to be careful with <code>IncAllocator::Reset()</code> to control owners of memory blocks.</p>
<h2><a class="anchor" id="upgrade_780_hash_utils"></a>
Reworked Hash Mechanism for Hash Map (NCollection's map)</h2>
<p>The <code>HashCode(value, upperBound)</code> static method has been removed and <code>IsEqual(value1, value2)</code> is no longer used in the map.<br  />
 NCollection's map now operates on an STL-like hash mechanism: a struct with a public operator <code>size_t operator()(object&amp;) const</code> and <code>bool operator(object&amp;, object&amp;) const</code>.<br  />
 The difference between STL and OCCT is that the hash struct and comparator are combined into a single struct to reduce conflicts on OCCT's user side.<br  />
 Hash utils have been implemented to hash objects, returning <code>uint32_t</code> and <code>uint64_t</code> depending on the template (<code>Standard_HashUtils.hxx</code>). Algorithms used are <code>MurmurHash</code> and <code>FNVHash</code>.<br  />
 Benefits:</p><ul>
<li>x64 using 8 bytes to store the hash instead of 4 bytes.</li>
<li>OCCT classes will now be usable as elements in STL <code>unordered_map</code> and <code>unordered_set</code>.</li>
</ul>
<p>The migration problem will occur at compile time. Make sure that <code>int HashCode</code> has been changed anywhere to <code>size operator</code> and <code>bool IsEqual</code> to <code>bool operator</code>.</p>
<h2><a class="anchor" id="upgrade_780_removed_files"></a>
Removed Hash Specialization Classes</h2>
<p>The majority of include files containing only specialized hashes have been removed. Their functionality has been consolidated into the hashed object include file (in the "std" namespace).<br  />
 It is guaranteed that each removed hash class has been transferred to the native hash mechanism of the hashed class.</p>
<p>The migration problem may arise at compile time. Ensure that you remove any files that have been deprecated.</p>
<h2><a class="anchor" id="upgrade_780_tk_rework"></a>
Reorganized DE TK</h2>
<p>DE TK components have been combined or separated based on specific CAD formats to support plug-in ability.</p><ul>
<li>Components now have a "TKDE" prefix. The available list includes <code>TKDESTEP</code>, <code>TKDEOBJ</code>, <code>TKDEIGES</code>, <code>TKDEGLTF</code>, <code>TKDEVRML</code>, <code>TKDEPLY</code>, <code>TKDESTL</code>.</li>
<li>The DE DRAW TK has been updated in a similar way: DRAW components now have a "TKXSDRAW" prefix. The available list includes <code>TKXSDRAWSTEP</code>, <code>TKXSDRAWOBJ</code>, <code>TKXSDRAWIGES</code>, <code>TKXSDRAWGLTF</code>, <code>TKXSDRAWVRML</code>, <code>TKXSDRAWPLY</code>, <code>TKXSDRAWSTL</code>.</li>
</ul>
<p>Migration problems may occur during configuration time or compile time. Ensure that you update your project configuration accordingly.</p>
<h2><a class="anchor" id="upgrade_780_step_thread_safety"></a>
Implemented STEP Thread-safety Interface</h2>
<p>The STEP interface now uses Static_Interface to extract exchange settings.<br  />
 A new ability has been implemented to determine parameters in STEP, avoiding Static_Interface.</p><ul>
<li>For reading, use an additional argument with STEP's parameters in <code>ReadFile</code> or <code>Perform</code>.</li>
<li>For writing, use an additional argument with STEP's parameters in <code>Transfer</code> or <code>Perform</code>.</li>
</ul>
<h2><a class="anchor" id="upgrade_780_new_memory_manager"></a>
New Memory Management Functionality</h2>
<p><code>Standard.hxx</code> has a new method <code>AllocateOptimal</code> for allocating without post-processing (cleaning).<br  />
 New profiles to allocate memory (defined at configuration time):</p><ul>
<li><code>Native</code> - allocates with standard <code>malloc</code> and <code>calloc</code> functionality, performance depends on the OS.</li>
<li><code>TBB</code> - allocates with TBB's <code>scalable</code> allocator functionality.</li>
<li><code>JeMalloc</code> - allocates with <code>jemalloc</code> functions.</li>
<li><code>Flexible</code> - old-way allocation which defines allocation method in real-time by environment variables.<br  />
</li>
</ul>
<p>The most recommended manager is <code>JeMalloc</code>. To use it with a plugin system, like <code>DRAW</code>, please ensure that JeMalloc was built with the <code>--disable-initial-exec-tls</code> flag. For more details, visit <a href="http://jemalloc.net/">JeMalloc</a>.</p>
<h2><a class="anchor" id="upgrade_780_optimization_profiles"></a>
New CMake Variable for Optimization Profiles</h2>
<p><code>BUILD_OPT_PROFILE</code> is a new variable to define optimization level. Available profiles:</p><ul>
<li><code>Default</code> - specializes only in quality-dependent parameters for the compiler.</li>
<li><code>Production</code> - specializes in performance and quality-dependent parameters for the compiler and linker. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Dec 4 2023 13:54:33 for Open CASCADE Technology by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18 </li>
  </ul>
</div>
</body>
</html>

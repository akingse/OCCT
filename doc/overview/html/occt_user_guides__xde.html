<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Open CASCADE Technology: Extended Data Exchange (XDE)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Open CASCADE Technology"/>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="occ_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Open CASCADE Technology
   &#160;<span id="projectnumber">7.8.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.php" method="get">
              <img id="MSearchSelect" src="search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('occt_user_guides__xde.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Extended Data Exchange (XDE) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#occt_xde_1">Introduction</a><ul><li class="level2"><a href="#occt_xde_1_1">Basic terms</a></li>
<li class="level2"><a href="#occt_xde_1_2">XDE Organization</a></li>
<li class="level2"><a href="#occt_xde_1_3">Assemblies</a></li>
<li class="level2"><a href="#occt_xde_1_4">Validation Properties</a></li>
<li class="level2"><a href="#occt_xde_1_5">Names</a></li>
<li class="level2"><a href="#occt_xde_1_6">Colors and Layers</a></li>
<li class="level2"><a href="#occt_xde_1_7">Geometric Dimensions &amp; Tolerances (GD&amp;T)</a></li>
<li class="level2"><a href="#occt_xde_1_8">Clipping planes</a></li>
<li class="level2"><a href="#occt_xde_1_9">Saved views</a></li>
<li class="level2"><a href="#occt_xde_1_10">Custom notes</a></li>
</ul>
</li>
<li class="level1"><a href="#occt_xde_2_1">Getting started</a><ul><li class="level2"><a href="#occt_xde_2_1_1">Environment variables</a></li>
<li class="level2"><a href="#occt_xde_2_1_2">General Check</a></li>
<li class="level2"><a href="#occt_xde_2_1_3">Get an Application or an Initialized Document</a></li>
</ul>
</li>
<li class="level1"><a href="#occt_xde_2_2">Shapes and Assemblies</a><ul><li class="level2"><a href="#occt_xde_2_2_1">Initialize an XDE Document (Shapes)</a></li>
<li class="level2"><a href="#occt_xde_2_2_2">Get a Node considered as an Assembly</a></li>
<li class="level2"><a href="#occt_xde_2_2_3">Updating the Assemblies after Filling or Editing</a></li>
<li class="level2"><a href="#occt_xde_2_2_4">Adding or Setting Top Level Shapes</a></li>
<li class="level2"><a href="#occt_xde_2_2_5">Setting a given Shape at a given Label</a></li>
<li class="level2"><a href="#occt_xde_2_2_6">Getting a Shape from a Label</a></li>
<li class="level2"><a href="#occt_xde_2_2_7">Getting a Label from a Shape</a></li>
<li class="level2"><a href="#occt_xde_2_2_8">Other Queries on a Label</a><ul><li class="level3"><a href="#autotoc_md254">Main Shapes</a></li>
<li class="level3"><a href="#autotoc_md255">Assembly and Components</a></li>
</ul>
</li>
<li class="level2"><a href="#occt_xde_2_2_9">Instances and References for Components</a></li>
</ul>
</li>
<li class="level1"><a href="#occt_xde_2_3">Editing Shapes</a></li>
<li class="level1"><a href="#occt_xde_2_4">Management of Sub-Shapes</a></li>
<li class="level1"><a href="#occt_xde_2_5">Properties</a><ul><li class="level2"><a href="#occt_xde_2_5_1">Name</a></li>
<li class="level2"><a href="#occt_xde_2_5_2">Centroid</a></li>
<li class="level2"><a href="#occt_xde_2_5_3">Area</a></li>
<li class="level2"><a href="#occt_xde_2_5_4">Volume</a></li>
</ul>
</li>
<li class="level1"><a href="#occt_xde_2_6">Colors and Layers</a><ul><li class="level2"><a href="#occt_xde_2_6_1">Initialization</a></li>
<li class="level2"><a href="#occt_xde_2_6_2">Adding a Color</a></li>
<li class="level2"><a href="#occt_xde_2_6_3">Queries on Colors</a></li>
<li class="level2"><a href="#occt_xde_2_6_4">Editing Colors</a></li>
</ul>
</li>
<li class="level1"><a href="#occt_xde_2_7">Geometric Dimensions &amp; Tolerances (GD&amp;T)</a><ul><li class="level2"><a href="#occt_xde_2_7_1">Initialization</a></li>
<li class="level2"><a href="#occt_xde_2_7_2">Adding a GD&amp;T</a></li>
<li class="level2"><a href="#occt_xde_2_7_3">Editing a GD&amp;T</a></li>
<li class="level2"><a href="#occt_xde_2_7_4">Linking GD&amp;Ts</a></li>
<li class="level2"><a href="#occt_xde_2_7_5">Finding GD&amp;Ts and reference shapes</a></li>
<li class="level2"><a href="#occt_xde_2_7_6">Storing custom data</a></li>
</ul>
</li>
<li class="level1"><a href="#occt_xde_2_8">Clipping planes</a></li>
<li class="level1"><a href="#occt_xde_2_9">Saved views</a></li>
<li class="level1"><a href="#occt_xde_2_10">Custom notes</a><ul><li class="level2"><a href="#occt_xde_2_10_1">Initialization</a></li>
<li class="level2"><a href="#occt_xde_2_10_2">Creating Notes</a></li>
<li class="level2"><a href="#occt_xde_2_10_3">Editing a Note</a></li>
<li class="level2"><a href="#occt_xde_2_10_4">Adding Notes</a></li>
<li class="level2"><a href="#occt_xde_2_10_5">Finding Notes</a></li>
<li class="level2"><a href="#occt_xde_2_10_6">Removing Notes</a></li>
<li class="level2"><a href="#occt_xde_2_10_7">Deleting Notes</a></li>
</ul>
</li>
<li class="level1"><a href="#occt_xde_2_11">Reading and Writing STEP or IGES</a><ul><li class="level2"><a href="#occt_xde_2_11_1">Reading a STEP file</a></li>
<li class="level2"><a href="#occt_xde_2_11_2">Writing a STEP file</a></li>
<li class="level2"><a href="#occt_xde_2_11_3">Reading an IGES File</a></li>
<li class="level2"><a href="#occt_xde_2_11_4">Writing an IGES File</a></li>
</ul>
</li>
<li class="level1"><a href="#occt_xde_2_12">Using an XDE Document</a><ul><li class="level2"><a href="#occt_xde_2_12_1">XDE Data inside an Application Document</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="occt_xde_1"></a>
Introduction</h1>
<p>This manual explains how to use the <b>eXtended Data Exchange</b> (XDE). It provides basic documentation on setting up and using XDE.</p>
<p>The Extended Data Exchange (XDE) module allows extending the scope of exchange by translating additional data attached to geometric BREP data, thereby improving the interoperability with external software.</p>
<p>Data types such as colors, layers, assembly descriptions and validation properties (i.e. center of gravity, etc.) are supported. These data are stored together with shapes in an XCAF document. It is also possible to add a new types of data taking the existing tools as prototypes.</p>
<p>Finally, the XDE provides reader and writer tools for reading and writing the data supported by XCAF to and from IGES and STEP files.</p>
<div class="image">
<img src="646_xde_11_400.png" alt=""/>
<div class="caption">
Shape imported using XDE</div></div>
<p>The XDE component requires <a class="el" href="occt_user_guides__shape_healing.html">Shape Healing</a> toolkit for operation.</p>
<h2><a class="anchor" id="occt_xde_1_1"></a>
Basic terms</h2>
<p>For better understanding of XDE, certain key terms are defined:</p><ul>
<li><b>Shape</b> &ndash; a standalone shape, which does not belong to the assembly structure.</li>
<li><b>Instance</b> &ndash; a replication of another shape with a location that can be the same location or a different one.</li>
<li><b>Assembly</b> &ndash; a construction that is either a root or a sub-assembly.</li>
</ul>
<h2><a class="anchor" id="occt_xde_1_2"></a>
XDE Organization</h2>
<p>The basis of XDE, called XCAF, is a framework based on <a class="el" href="occt_user_guides__ocaf.html">OCAF</a> (Open CASCADE Technology Application Framework) and is intended to be used with assemblies and with various kinds of attached data (attributes). Attributes can be Individual attributes for a shape, specifying some characteristics of a shape, or they can be Grouping attributes, specifying that a shape belongs to a given group whose definition is specified apart from the shapes.</p>
<p>XDE works in an OCAF document with a specific organization defined in a dedicated XCAF module. This organization is used by various functions of XDE to exchange standardized data other than shapes and geometry.</p>
<p>The Assembly Structure and attributes assigned to shapes are stored in the OCAF tree. It is possible to obtain <code>TopoDS</code> representation for each level of the assembly in the form of <code>TopoDS_Compound</code> or <code>TopoDS_Shape</code> using the API.</p>
<p>Basic elements used by XDE are introduced in the XCAF sub-module by the package <code>XCAFDoc</code>. These elements consist in descriptions of commonly used data structures (apart from the shapes themselves) in normalized data exchanges. They are not attached to specific applications and do not bring specific semantics, but are structured according to the use and needs of data exchanges. The Document used by XDE usually starts as a <code>TDocStd_Document</code>.</p>
<h2><a class="anchor" id="occt_xde_1_3"></a>
Assemblies</h2>
<p>XDE supports assemblies by separating shape definitions and their locations. Shapes are simple OCAF objects without a location definition. An assembly consists of several components. Each of these components references one and the same specified shape with different locations. All this provides an increased flexibility in working on multi-level assemblies.</p>
<p>For example, a mechanical assembly can be defined as follows: </p><div class="image">
<img src="xde_image003.png" alt=""/>
<div class="caption">
Assembly Description</div></div>
<div class="image">
<img src="xde_image004.png" alt=""/>
<div class="caption">
Assembly View</div></div>
<p>XDE defines the specific organization of the assembly content. Shapes are stored on sub-labels of label <code>0:1:1</code>. There can be one or more roots (called free shapes) whether they are true trees or simple shapes. A shape can be considered to be an Assembly (such as <code>AS1</code> under <code>0:1:1:1</code> in Figure1) if it is defined with Components (sub-shapes, located or not).</p>
<p><code>XCAFDoc_ShapeTool</code> is a tool that allows managing the Shape section of the XCAF document. This tool is implemented as an attribute and located at the root label of the shape section.</p>
<h2><a class="anchor" id="occt_xde_1_4"></a>
Validation Properties</h2>
<p>Validation properties are geometric characteristics of Shapes (volume, centroid, surface area) written to STEP files by the sending system. These characteristics are read by the receiving system to validate the quality of the translation. This is done by comparing the values computed by the original system with the same values computed by the receiving system on the resulting model.</p>
<p>Advanced Data Exchange supports both reading and writing of validation properties, and provides a tool to check them.</p>
<div class="image">
<img src="xde_image005.png" alt=""/>
<div class="caption">
Validation Property Descriptions</div></div>
<p>Check logs contain deviations of computed values from the values stored in a STEP file. A typical example appears as follows:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Label </th><th class="markdownTableHeadLeft">Area defect </th><th class="markdownTableHeadLeft">Volume defect </th><th class="markdownTableHeadLeft">dX </th><th class="markdownTableHeadLeft">dY </th><th class="markdownTableHeadLeft">dZ </th><th class="markdownTableHeadLeft">Name  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>0:1:1:1</code> </td><td class="markdownTableBodyLeft">312.6 (0%) </td><td class="markdownTableBodyLeft">-181.7 (0%) </td><td class="markdownTableBodyLeft">0.00 </td><td class="markdownTableBodyLeft">0.00 </td><td class="markdownTableBodyLeft">0.00 </td><td class="markdownTableBodyLeft">"S1"  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>0:1:1:2</code> </td><td class="markdownTableBodyLeft">-4.6 (0%) </td><td class="markdownTableBodyLeft">-191.2 (0%) </td><td class="markdownTableBodyLeft">-0.00 </td><td class="markdownTableBodyLeft">0.00 </td><td class="markdownTableBodyLeft">-0.00 </td><td class="markdownTableBodyLeft">"MAINBODY"  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>0:1:1:3</code> </td><td class="markdownTableBodyLeft">-2.3 (0%) </td><td class="markdownTableBodyLeft">-52.5 (0%) </td><td class="markdownTableBodyLeft">-0.00 </td><td class="markdownTableBodyLeft">0.00 </td><td class="markdownTableBodyLeft">0.00 </td><td class="markdownTableBodyLeft">"MAIN_BODY_BACK"  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>0:1:1:4</code> </td><td class="markdownTableBodyLeft">-2.3 (0%) </td><td class="markdownTableBodyLeft">-51.6 (0%) </td><td class="markdownTableBodyLeft">0.00 </td><td class="markdownTableBodyLeft">0.00 </td><td class="markdownTableBodyLeft">-0.00 </td><td class="markdownTableBodyLeft">"MAIN_BODY_FRONT"  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>0:1:1:5</code> </td><td class="markdownTableBodyLeft">2.0 (0%) </td><td class="markdownTableBodyLeft">10.0 (0%) </td><td class="markdownTableBodyLeft">-0.00 </td><td class="markdownTableBodyLeft">0.00 </td><td class="markdownTableBodyLeft">-0.00 </td><td class="markdownTableBodyLeft">"HEAD"  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>0:1:1:6</code> </td><td class="markdownTableBodyLeft">0.4 (0%) </td><td class="markdownTableBodyLeft">0.0 (0%) </td><td class="markdownTableBodyLeft">0.00 </td><td class="markdownTableBodyLeft">-0.00 </td><td class="markdownTableBodyLeft">-0.00 </td><td class="markdownTableBodyLeft">"HEAD_FRONT"  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>0:1:1:7</code> </td><td class="markdownTableBodyLeft">0.4 (0%) </td><td class="markdownTableBodyLeft">0.0 (0%) </td><td class="markdownTableBodyLeft">0.00 </td><td class="markdownTableBodyLeft">-0.00 </td><td class="markdownTableBodyLeft">-0.00 </td><td class="markdownTableBodyLeft">"HEAD_BACK"  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>0:1:1:8</code> </td><td class="markdownTableBodyLeft">-320.6 (0%) </td><td class="markdownTableBodyLeft">10.9 (0%) </td><td class="markdownTableBodyLeft">-0.00 </td><td class="markdownTableBodyLeft">0.00 </td><td class="markdownTableBodyLeft">0.00 </td><td class="markdownTableBodyLeft">"TAIL"  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>0:1:1:9</code> </td><td class="markdownTableBodyLeft">0.0 (0%) </td><td class="markdownTableBodyLeft">0.0 (0%) </td><td class="markdownTableBodyLeft">-0.00 </td><td class="markdownTableBodyLeft">-0.00 </td><td class="markdownTableBodyLeft">0.00 </td><td class="markdownTableBodyLeft">"TAIL_MIDDLE"  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>0:1:1:10</code> </td><td class="markdownTableBodyLeft">-186.2 (0%) </td><td class="markdownTableBodyLeft">4.8 (0%) </td><td class="markdownTableBodyLeft">-0.00 </td><td class="markdownTableBodyLeft">0.00 </td><td class="markdownTableBodyLeft">-0.00 </td><td class="markdownTableBodyLeft">"TAIL_TURBINE"  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>0:1:1:11</code> </td><td class="markdownTableBodyLeft">0.3 (0%) </td><td class="markdownTableBodyLeft">-0.0 (0%) </td><td class="markdownTableBodyLeft">-0.00 </td><td class="markdownTableBodyLeft">-0.00 </td><td class="markdownTableBodyLeft">0.00 </td><td class="markdownTableBodyLeft">"FOOT"  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>0:1:1:12</code> </td><td class="markdownTableBodyLeft">0.0 (0%) </td><td class="markdownTableBodyLeft">-0.0 (0%) </td><td class="markdownTableBodyLeft">0.00 </td><td class="markdownTableBodyLeft">-0.00 </td><td class="markdownTableBodyLeft">-0.00 </td><td class="markdownTableBodyLeft">"FOOT_FRONT"  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>0:1:1:13</code> </td><td class="markdownTableBodyLeft">0.0 (0%) </td><td class="markdownTableBodyLeft">0.0 (0%) </td><td class="markdownTableBodyLeft">-0.00 </td><td class="markdownTableBodyLeft">0.00 </td><td class="markdownTableBodyLeft">0.00 </td><td class="markdownTableBodyLeft">"FOOT_BACK"  </td></tr>
</table>
<p>In our example, it can be seen that no errors were detected for either area, volume or positioning data.</p>
<h2><a class="anchor" id="occt_xde_1_5"></a>
Names</h2>
<p>XDE supports reading and writing the names of shapes to and from IGES and STEP file formats. This functionality can be switched off if you do not need this type of data, thereby reducing the size of the document.</p>
<div class="image">
<img src="614_xde_04_400.png" alt=""/>
<div class="caption">
Instance Names</div></div>
<h2><a class="anchor" id="occt_xde_1_6"></a>
Colors and Layers</h2>
<p>XDE can read and write colors and layers assigned to shapes or their subparts (down to the level of faces and edges) to and from both IGES and STEP formats. Three types of colors are defined in the enumeration <code>XCAFDoc_ColorType</code>:</p><ul>
<li>generic color (<code>XCAFDoc_ColorGen</code>)</li>
<li>surface color (<code>XCAFDoc_ColorSurf</code>)</li>
<li>curve color (<code>XCAFDoc_ColorCurv</code>)</li>
</ul>
<div class="image">
<img src="xde_image006.png" alt=""/>
<div class="caption">
Colors and Layers</div></div>
<h2><a class="anchor" id="occt_xde_1_7"></a>
Geometric Dimensions &amp; Tolerances (GD&amp;T)</h2>
<p>GD&amp;T are a type of <b>Product and Manufacturing Information</b> (<b>PMI</b>) that can be either computed automatically by a CAD system, or entered manually by the user. For detailed information use <a href="https://www.cax-if.org/documents/rec_pracs_pmi_v40.pdf">CAx-IF Recommended Practices for the Representation and Presentation of Product Manufacturing Information (PMI) (AP242)</a>.</p>
<p>XDE can read and write GD&amp;T data of the following types:</p><ul>
<li>dimensions, such as distance, length, radius and so on;</li>
<li>geometric tolerances;</li>
<li>datums, i.e theoretically exact geometric references, such as point, line or plane, to which toleranced features are related.</li>
</ul>
<p>XDE supports two presentations of GD&amp;T data:</p><ul>
<li>semantic presentation, i.e. data is stored in a machine-consumable way and includes all information required to understand the specification without the aid of any presentation elements;</li>
<li>tessellated presentation, i.e. data is displayed in a human-readable way.</li>
</ul>
<h2><a class="anchor" id="occt_xde_1_8"></a>
Clipping planes</h2>
<p>XDE supports reading from STEP and storing named planes used for clipping. Currently, XDE supports saving of clipping planes in XBF format only.</p>
<p>XDE provides capabilities for adding, editing and removing clipping planes.</p>
<h2><a class="anchor" id="occt_xde_1_9"></a>
Saved views</h2>
<p>XDE supports reading from STEP views. Views allow saving information about camera parameters (position, direction, zoom factor, etc.) and visible shapes, PMIs, used clipping planes and notes. Currently, XDE supports saving of clipping planes in XBF format only.</p>
<p>XDE provides the following view management capabilities:</p><ul>
<li>add/remove views;</li>
<li>set view camera parameters;</li>
<li>set visible shapes, PMIs, used clipping planes and notes.</li>
</ul>
<h2><a class="anchor" id="occt_xde_1_10"></a>
Custom notes</h2>
<p>Custom notes is a kind of application-specific data attached to assembly items, their attributes and sub-shapes. Basically, there are simple textual comments, binary data and other application-specific data. Each note is provided with a timestamp and the user who created it.</p>
<p>Notes API provides the following functionality:</p><ul>
<li>Returns the total number of notes and annotated items;</li>
<li>Returns labels for all notes and annotated items;</li>
<li>Creates notes:<ul>
<li>Comment note from a text string;</li>
<li>Binary data note from a file or byte array;</li>
</ul>
</li>
<li>Checks if an assembly item is annotated;</li>
<li>Finds a label for the annotated item;</li>
<li>Returns all note labels for the annotated item;</li>
<li>Adds a note to item(s):<ul>
<li>Assembly item;</li>
<li>Assembly item attribute;</li>
<li>Assembly item subshape index;</li>
</ul>
</li>
<li>Removes note(s) from an annotated assembly item; orphan note(s) might be deleted optionally (items without linked notes will be deleted automatically);</li>
<li>Deletes note(s) and removes them from annotated items;</li>
<li>Gets / deletes orphan notes.</li>
</ul>
<h1><a class="anchor" id="occt_xde_2_1"></a>
Getting started</h1>
<p>As explained in the last chapter, XDE uses <code>TDocStd_Documents</code> as a starting point. The general purpose of XDE is:</p><ul>
<li>Checking if an existing document is fit for XDE;</li>
<li>Getting an application and initialized document;</li>
<li>Initializing a document to fit it for XDE;</li>
<li>Adding, setting and finding data;</li>
<li>Querying and managing shapes;</li>
<li>Attaching properties to shapes.</li>
</ul>
<p>The Document used by XDE usually starts as a <code>TDocStd_Document</code>.</p>
<h2><a class="anchor" id="occt_xde_2_1_1"></a>
Environment variables</h2>
<p>To use XDE you have to set the environment variables properly. Make sure that two important environment variables are set as follows:</p><ul>
<li><code>CSF_PluginDefaults</code> points to sources of <code>$CASROOT/src/XCAFResources</code>.</li>
<li><code>CSF_XCAFDefaults</code> points to sources of <code>$CASROOT/src/XCAFResources</code>.</li>
</ul>
<h2><a class="anchor" id="occt_xde_2_1_2"></a>
General Check</h2>
<p>Before working with shapes, properties, and other types of information, the global organization of an XDE Document can be queried or completed to determine if an existing Document is actually structured for use with XDE.</p>
<p>To find out if an existing <code>TDocStd_Document</code> is suitable for XDE, use: </p><div class="fragment"><div class="line">Handle(TDocStd_Document) theDoc;</div>
<div class="line"><span class="keywordflow">if</span> (XCAFDoc_DocumentTool::IsXCAFDocument (theDoc)) { .. yes .. }</div>
</div><!-- fragment --><p>If the Document is suitable for XDE, you can perform operations and queries explained in this guide. However, if a Document is not fully structured for XDE, it must be initialized.</p>
<h2><a class="anchor" id="occt_xde_2_1_3"></a>
Get an Application or an Initialized Document</h2>
<p>If you want to retrieve an existing application or an existing document (known to be correctly structured for XDE), use: </p><div class="fragment"><div class="line">Handle(TDocStd_Document) aDoc;</div>
<div class="line">Handle(XCAFApp_Application) anApp = XCAFApp_Application::GetApplication(); </div>
<div class="line">BinXCAFDrivers::DefineFormat (anApp);</div>
<div class="line">XmlXCAFDrivers::DefineFormat (anApp);</div>
<div class="line">anApp-&gt;NewDocument (<span class="stringliteral">&quot;BinXCAF&quot;</span>, aDoc);</div>
</div><!-- fragment --><h1><a class="anchor" id="occt_xde_2_2"></a>
Shapes and Assemblies</h1>
<h2><a class="anchor" id="occt_xde_2_2_1"></a>
Initialize an XDE Document (Shapes)</h2>
<p>An XDE Document begins with a <code>TDocStd_Document</code>. Assuming you have a <code>TDocStd_Document</code> already created, you can ensure that it is correctly structured for XDE by initializing the XDE structure as follows: </p><div class="fragment"><div class="line">Handle(TDocStd_Document) theDoc = ...;</div>
<div class="line">Handle(XCAFDoc_ShapeTool) myAssembly = XCAFDoc_DocumentTool::ShapeTool (theDoc-&gt;Main());</div>
<div class="line">TDF_Label aLabel = myAssembly-&gt;NewShape();</div>
</div><!-- fragment --><p><b>Note</b> that the method <code>XCAFDoc_DocumentTool::ShapeTool</code> returns the <code>XCAFDoc_ShapeTool</code>. The first time this method is used, it creates the <code>XCAFDoc_ShapeTool</code>. In our example, a handle is used for the <code>TDocStd_Document</code>.</p>
<h2><a class="anchor" id="occt_xde_2_2_2"></a>
Get a Node considered as an Assembly</h2>
<p>To get a node considered as an Assembly from an XDE structure, you can use the Label of the node. Assuming that you have a properly initialized <code>TDocStd_Document</code>, use: </p><div class="fragment"><div class="line">Handle(TDocStd_Document) theDoc = ...;</div>
<div class="line">Handle(XCAFDoc_ShapeTool) myAssembly = XCAFDoc_DocumentTool::ShapeTool (aLabel); </div>
</div><!-- fragment --><p>In the previous example, you can also get the Main Item of an XDE document, which records the root shape representation (as a Compound if it is an Assembly) by using <code>XCAFDoc_DocumentTool::ShapeTool(theDoc-&gt;Main())</code> instead of <code>XCAFDoc_DocumentTool::ShapeTool(aLabel)</code>.</p>
<p>You can then query or edit this Assembly node, the Main Item or another one (<code>myAssembly</code> in our examples).</p>
<p><b>Note</b> that for the examples in the rest of this guide, <code>myAssembly</code> is always presumed to be accessed this way, so this information will not be repeated.</p>
<h2><a class="anchor" id="occt_xde_2_2_3"></a>
Updating the Assemblies after Filling or Editing</h2>
<p>Some actions in this chapter affect the content of the document, considered as an Assembly. As a result, you will sometimes need to update various representations (including the compounds).</p>
<p>To update the representations, use: </p><div class="fragment"><div class="line">myAssembly-&gt;UpdateAssemblies();</div>
</div><!-- fragment --><p>This call performs a top-down update of the Assembly compounds stored in the document.</p>
<p><b>Note</b> that you have to run this method manually to actualize your Assemblies after any low-level modifications on shapes.</p>
<h2><a class="anchor" id="occt_xde_2_2_4"></a>
Adding or Setting Top Level Shapes</h2>
<p>Shapes can be added as top-level shapes. Top level means that they can be added to an upper level assembly or added on their own at the highest level as a component or referred by a located instance. Therefore two types of top-level shapes can be added:</p><ul>
<li>shapes with upper level references;</li>
<li>free shapes (that correspond to roots) without any upper reference.</li>
</ul>
<p><b>Note</b> that several top-level shapes can be added to the same component.</p>
<p>A shape to be added can be defined as a compound (if required), with the following interpretations:</p><ul>
<li>If the Shape is a compound, according to the user choice, it may or may not be interpreted as representing an Assembly. If it is an Assembly, each of its sub-shapes defines a sub-label.</li>
<li>If the Shape is not a compound, it is taken as a whole, without breaking it down.</li>
</ul>
<p>To break down a Compound in the assembly structure, use: </p><div class="fragment"><div class="line"><span class="comment">// True to interpret a Compound as an Assembly, False to take it as a whole</span></div>
<div class="line"><span class="keywordtype">bool</span> toMakeAssembly = ...;</div>
<div class="line">TDF_Label aLabel = myAssembly-&gt;AddShape (aShape, toMakeAssembly);</div>
</div><!-- fragment --><p>Each node of the assembly therefore refers to its sub-shapes.</p>
<p>Concerning located instances of sub-shapes, the corresponding shapes (without location) appear at distinct sub-labels. They are referred to by a shape instance, which associates a location.</p>
<h2><a class="anchor" id="occt_xde_2_2_5"></a>
Setting a given Shape at a given Label</h2>
<p>A top-level shape can be changed. In this example, no interpretation of compound is performed: </p><div class="fragment"><div class="line"><span class="comment">// identifies the Label (form 0:i:j...)</span></div>
<div class="line"><span class="comment">// a label must be present</span></div>
<div class="line">TDF_Label aLabel = ...;</div>
<div class="line">TopoDS_Shape aShape = ...;</div>
<div class="line">myAssembly-&gt;SetShape (aLabel, aShape);</div>
</div><!-- fragment --><h2><a class="anchor" id="occt_xde_2_2_6"></a>
Getting a Shape from a Label</h2>
<p>To get a shape from its Label from the top-level, use: </p><div class="fragment"><div class="line">TDF_Label aLabel = ...;</div>
<div class="line"><span class="comment">// a label must be present</span></div>
<div class="line"><span class="keywordflow">if</span> (aLabel.IsNull())</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// no such label: abandon</span></div>
<div class="line">}</div>
<div class="line">TopoDS_Shape aShape = myAssembly-&gt;GetShape (aLabel);</div>
<div class="line"><span class="keywordflow">if</span> (aShape.IsNull())</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// this label is not for a Shape</span></div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Note</b> that if the label corresponds to an assembly, the result is a compound.</p>
<h2><a class="anchor" id="occt_xde_2_2_7"></a>
Getting a Label from a Shape</h2>
<p>To get a Label, which is attached to a Shape from the top-level, use: </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> toFindInstance = <span class="keyword">false</span>; <span class="comment">// this is default value</span></div>
<div class="line">TDF_Label aLabel = myAssembly-&gt;FindShape(aShape [,toFindInstance]);</div>
<div class="line"><span class="keywordflow">if</span> (aLabel.IsNull())</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// no label found for this shape</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>If <code>toFindInstance</code> is <code>True</code>, a search is made for the shape with the same location. If it is <code>False</code> (default value), a search is made among original, non-located shapes.</p>
<h2><a class="anchor" id="occt_xde_2_2_8"></a>
Other Queries on a Label</h2>
<p>Various other queries can be made from a Label within the Main Item of XDE:</p>
<h3><a class="anchor" id="autotoc_md254"></a>
Main Shapes</h3>
<p>To determine if a Shape is recorded (or not), use: </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (myAssembly-&gt;IsShape (aLabel)) { .. yes .. }</div>
</div><!-- fragment --><p>To determine if the shape is top-level, i.e. was added by the <code>XCAFDoc_ShapeTool::AddShape</code> method, use: </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (myAssembly-&gt;IsTopLevel (aLabel)) { .. yes .. }</div>
</div><!-- fragment --><p>To get a list of top-level shapes added by the <code>XCAFDoc_ShapeTool::AddShape</code> method, use: </p><div class="fragment"><div class="line">TDF_LabelSequence aFreeShapes;</div>
<div class="line">myAssembly-&gt;GetShapes (aFreeShapes);</div>
</div><!-- fragment --><p>To get all free shapes at once if the list above has only one item, use: </p><div class="fragment"><div class="line">TopoDS_Shape result = myAssembly-&gt;GetShape (aFreeShapes.First()); </div>
</div><!-- fragment --><p>If there is more than one item, you must create and fill a compound, use:</p>
<div class="fragment"><div class="line">TopoDS_Compound aComp;</div>
<div class="line">BRep_Builder aBuilder;</div>
<div class="line">aBuilder.MakeCompound (aComp);</div>
<div class="line"><span class="keywordflow">for</span> (TDF_LabelSequence::Iterator aLabIter (aFreeShapes); aLabIter.More(); aLabIter.Next())</div>
<div class="line">{</div>
<div class="line">  TopoDS_Shape aShape = myAssembly-&gt;GetShape (aLabIter.Value());</div>
<div class="line">  aBuilder.Add (aComp, aShape);</div>
<div class="line">}</div>
</div><!-- fragment --><p>In our example, the result is the compound <code>aComp</code>. To determine if a shape is a free shape (no reference or super-assembly), use:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (myAssembly-&gt;IsFree (aLabel)) { .. yes .. }</div>
</div><!-- fragment --><p>To get a list of Free Shapes (roots), use:</p>
<div class="fragment"><div class="line">TDF_LabelSequence aFreeShapes;</div>
<div class="line">myAssembly-&gt;GetFreeShapes (aFreeShapes);</div>
</div><!-- fragment --><p>To get the shapes, which use a given shape as a component, use: </p><div class="fragment"><div class="line">TDF_LabelSequence aUsers;</div>
<div class="line">Standard_Integer aNbUsers = myAssembly-&gt;GetUsers (aLabel, aUsers);</div>
</div><!-- fragment --><p>The count of <code>aUsers</code> is contained with <code>aNbUsers</code>. It contains <code>0</code> if there are no users.</p>
<h3><a class="anchor" id="autotoc_md255"></a>
Assembly and Components</h3>
<p>To determine if a label is attached to the main part or to a sub-part (component), use: </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (myAssembly-&gt;IsComponent (aLabel)) { .. yes .. }</div>
</div><!-- fragment --><p>To determine whether a label is a node of a (sub-) assembly or a simple shape, use: </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (myAssembly-&gt;IsAssembly (aLabel)) { .. yes .. }</div>
</div><!-- fragment --><p>If the label is a node of a (sub-) assembly, you can get the count of components, use: </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> subchilds = <span class="keyword">false</span>; <span class="comment">// default</span></div>
<div class="line">Standard_Integer nbc = myAssembly-&gt;NbComponents (aLabel [,subchilds]);</div>
</div><!-- fragment --><p>If <code>subchilds</code> is <code>True</code>, commands also consider sub-levels. By default, only level one is checked.</p>
<p>To get component Labels themselves, use: </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> subchilds = <span class="keyword">false</span>; <span class="comment">// default</span></div>
<div class="line">TDF_LabelSequence aComps;</div>
<div class="line"><span class="keywordtype">bool</span> isassembly = myAssembly-&gt;GetComponents (aLabel, aComps [,subchilds]);</div>
</div><!-- fragment --><h2><a class="anchor" id="occt_xde_2_2_9"></a>
Instances and References for Components</h2>
<p>To determine if a label is a simple shape, use: </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (myAssembly-&gt;IsSimpleShape (aLabel)) { .. yes .. }</div>
</div><!-- fragment --><p>To determine if a label is a located reference to another one, use: </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (myAssembly-&gt;IsReference (aLabel)) { .. yes .. }</div>
</div><!-- fragment --><p>If the label is a located reference, you can get the location, use: </p><div class="fragment"><div class="line">TopLoc_Location aLoc = myAssembly-&gt;GetLocation (aLabel);</div>
</div><!-- fragment --><p>To get the label of a referenced original shape (also tests if it is a reference), use: </p><div class="fragment"><div class="line">TDF_Label aRefLabel;</div>
<div class="line"><span class="keywordtype">bool</span> isRef = myAssembly-&gt;GetReferredShape (aLabel, aRefLabel);</div>
</div><!-- fragment --><p><b>Note</b> <code>isRef</code> returns <code>False</code> if <code>aLabel</code> is not for a reference.</p>
<h1><a class="anchor" id="occt_xde_2_3"></a>
Editing Shapes</h1>
<p>In addition to the previously described <code>AddShape</code> and <code>SetShape</code>, several shape edits are possible.</p>
<p>To remove a Shape, and all its sub-labels, use: </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> isRemoved = myAssembly-&gt;RemoveShape (aLabel);</div>
<div class="line"><span class="comment">// isRemoved is returned True if done </span></div>
</div><!-- fragment --><p>This operation will fail if the shape is neither free nor top level.</p>
<p>To add a Component to the Assembly, from a new shape, use: </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> toExpand = <span class="keyword">false</span>; <span class="comment">// default</span></div>
<div class="line">TDF_Label aLabel = myAssembly-&gt;AddComponent (aShape [,toExpand]); </div>
</div><!-- fragment --><p>If <code>toExpand</code> is <code>True</code> and <code>aShape</code> is a Compound, <code>aShape</code> is broken down to produce sub-components, one for each of its sub-shapes.</p>
<p>To add a component to the assembly, from a previously recorded shape (the new component is defined by the label of the reference shape, and its location), use: </p><div class="fragment"><div class="line">TDF_Label  aRefLabel = ...; <span class="comment">// the label of reference shape</span></div>
<div class="line">TopLoc_Location aLoc = ...; <span class="comment">// the desired location</span></div>
<div class="line">TDF_Label aLabel = myAssembly-&gt;AddComponent (aRefLabel, aLoc);</div>
</div><!-- fragment --><p>To remove a component from the assembly, use: </p><div class="fragment"><div class="line">myAssembly-&gt;RemoveComponent (aLabel);</div>
</div><!-- fragment --><h1><a class="anchor" id="occt_xde_2_4"></a>
Management of Sub-Shapes</h1>
<p>In addition to components of a (sub-)assembly, it is possible to have individual identification of some sub-shapes inside any shape. Therefore, you can attach specific attributes such as Colors. Some additional actions can be performed on sub-shapes that are neither top-level, nor components. To add a sub-shape to a given Label, use: </p><div class="fragment"><div class="line">TDF_Label aSubLabel = myAssembly-&gt;AddSubShape (aLabel, aSubShape);</div>
</div><!-- fragment --><p>To find the Label attached to a given sub-shape, use: </p><div class="fragment"><div class="line">TDF_Label aSubLabel; <span class="comment">// new label to be computed</span></div>
<div class="line"><span class="keywordflow">if</span> (myAssembly-&gt; FindSubShape (aLabel, aSubShape, aSubLabel)) { .. yes .. }</div>
</div><!-- fragment --><p>If the sub-shape is found (yes), <code>aSubLabel</code> is filled by the correct value.</p>
<p>To find the top-level simple shape (not a compound whether free or not), which contains a given sub-shape, use: </p><div class="fragment"><div class="line">TDF_Label aMainLabel = myAssembly-&gt;FindMainShape (aSubShape);</div>
</div><!-- fragment --><p><b>Note</b> that there should be only one shape for a valid model. In any case, the search stops on the first one found.</p>
<p>To get the sub-shapes of a shape, which are recorded under a label, use: </p><div class="fragment"><div class="line">TDF_LabelSequence aSubshapes;</div>
<div class="line"><span class="keywordtype">bool</span> hasSubshapes = myAssembly-&gt;GetSubShapes (aLabel, aSubShapes);</div>
</div><!-- fragment --><h1><a class="anchor" id="occt_xde_2_5"></a>
Properties</h1>
<p>Some properties can be attached directly to shapes. These properties are:</p><ul>
<li>Name (standard definition from OCAF);</li>
<li>Centroid (for validation of transfer);</li>
<li>Volume (for validation of transfer);</li>
<li>Area (for validation of transfer).</li>
</ul>
<p>Some other properties can also be attached, and are also managed by distinct tools for Colors and Layers. Colors and Layers are managed as an alternative way of organizing data (by providing a way of identifying groups of shapes). Colors are put into a table of colors while shapes refer to this table.</p>
<p>There are two ways of attaching a color to a shape:</p><ul>
<li>By attaching an item from the table;</li>
<li>Adding the color directly.</li>
</ul>
<p>When the color is added directly, a search is performed in the table of contents to determine if it contains the requested color. Once this search and initialize operation is done, the first way of attaching a color to a shape is used.</p>
<h2><a class="anchor" id="occt_xde_2_5_1"></a>
Name</h2>
<p>Name is implemented and used as a <code>TDataStd_Name</code>, which can be attached to any label. Before proceeding, consider that:</p><ul>
<li>In IGES, every entity can have a name with an optional numeric part called a Subscript Label. For example, <code>MYCURVE</code> is a name, and <code>MYCURVE(60)</code> is a name with a Subscript Label.</li>
<li>In STEP, there are two levels: Part Names and Entity Names:<ul>
<li>Part Names are attached to "main shapes" such as parts and assemblies. These Part Names are specifically supported by XDE.</li>
<li>Entity Names can be attached to every Geometric Entity. This option is rarely used, as it tends to overload the exploitation of the data structure. Only some specific cases justify using this option: for example, when the sending system can really ensure the stability of an entity name after each STEP writing. If such stability is ensured, you can use this option to send an Identifier for external applications using a database.</li>
</ul>
</li>
</ul>
<p><b>Note</b> that both IGES or STEP files handle names as pure ASCII strings.</p>
<p>These considerations are not specific to XDE. What is specific to data exchange is the way names are attached to entities.</p>
<p>To get the name attached to a label (as a reminder using OCAF), use: </p><div class="fragment"><div class="line">Handle(TDataStd_Name) aNameAttr;</div>
<div class="line"><span class="keywordflow">if</span> (!aLabel.FindAttribute (TDataStd_Name::GetID(), aNameAttr))</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// no name is attached</span></div>
<div class="line">}</div>
<div class="line">TCollection_ExtendedString aName = aNameAttr-&gt;Get();</div>
</div><!-- fragment --><p>Don't forget to consider Extended String as ASCII, for the exchange file.</p>
<p>To set a name to a label (as a reminder using OCAF), use: </p><div class="fragment"><div class="line">TCollection_ExtendedString aName = ...;</div>
<div class="line"><span class="comment">// contains the desired name for this Label (ASCII)</span></div>
<div class="line">TDataStd_Name::Set (aLabel, aName);</div>
</div><!-- fragment --><h2><a class="anchor" id="occt_xde_2_5_2"></a>
Centroid</h2>
<p>A Centroid is defined by a Point to fix its position. It is handled as a property, item of the class <code>XCAFDoc_Centroid</code>, sub-class of <code>TDF_Attribute</code>. However, global methods give access to the position itself.</p>
<p>This notion has been introduced in STEP, together with that of Volume, and Area, as defining the Validation Properties: this feature allows exchanging the geometries and some basic attached values, in order to perform a synthetic checking on how they are maintained after reading and converting the exchange file. This exchange depends on reliable exchanges of Geometry and Topology. Otherwise, these values can be considered irrelevant.</p>
<p>A centroid can be determined at any level of an assembly, thereby allowing a check of both individual simple shapes and their combinations including locations.</p>
<p>To get a Centroid attached to a Shape, use: </p><div class="fragment"><div class="line">gp_Pnt aPos;</div>
<div class="line">Handle(XCAFDoc_Centroid) aCentAttr;</div>
<div class="line">aLabel.FindAttribute (XCAFDoc_Centroid::GetID(), aCentAttr);</div>
<div class="line"><span class="keywordflow">if</span> (!aCentAttr.IsNull()) aPos = aCentAttr-&gt;Get();</div>
</div><!-- fragment --><p>To set a Centroid to a Shape, use: </p><div class="fragment"><div class="line">gp_Pnt aPos (X, Y, Z);</div>
<div class="line"><span class="comment">// the position previously computed for the centroid</span></div>
<div class="line">XCAFDoc_Centroid::Set (aLabel, aPos);</div>
</div><!-- fragment --><h2><a class="anchor" id="occt_xde_2_5_3"></a>
Area</h2>
<p>An Area is defined by a Real, it corresponds to the computed Area of a Shape, provided that it contains surfaces. It is handled as a property, item of the class <code>XCAFDoc_Area</code>, sub-class of <code>TDF_Attribute</code>. This notion has been introduced in STEP but it is usually disregarded for a Solid, as Volume is used instead. In addition, it is attached to simple shapes, not to assemblies.</p>
<p>To get an area attached to a Shape, use: </p><div class="fragment"><div class="line">Standard_Real anArea = 0.0;</div>
<div class="line">Handle(XCAFDoc_Area) anAreaAttr;</div>
<div class="line">aLabel.FindAttribute (XCAFDoc_Area::GetID(), anAreaAttr);</div>
<div class="line"><span class="keywordflow">if</span> (!anAreaAttr.IsNull()) anArea = anAreaAttr-&gt;Get();</div>
</div><!-- fragment --><p>To set an area value to a Shape, use: </p><div class="fragment"><div class="line"><span class="comment">// value previously computed for the area</span></div>
<div class="line">Standard_Real anArea = ...;</div>
<div class="line">XCAFDoc_Area::Set (aLabel, anArea);</div>
</div><!-- fragment --><h2><a class="anchor" id="occt_xde_2_5_4"></a>
Volume</h2>
<p>A Volume is defined by a Real and corresponds to the computed volume of a Shape, provided that it contains solids. It is handled as a property, an item of the class <code>XCAFDoc_Volume</code>, sub-class of <code>TDF_Attribute</code>. This notion has been introduced in STEP. It may be attached to simple shapes or their assemblies for computing cumulated volumes and centers of gravity.</p>
<p>To get a Volume attached to a Shape, use: </p><div class="fragment"><div class="line">Standard_Real aVolume = 0.0;</div>
<div class="line">Handle(XCAFDoc_Volume) aVolAttr;</div>
<div class="line">aLabel.FindAttribute (XCAFDoc_Volume::GetID(), aVolAttr);</div>
<div class="line"><span class="keywordflow">if</span> (!aVolAttr.IsNull()) aVolume = aVolAttr-&gt;Get();</div>
</div><!-- fragment --><p>To set a volume value to a Shape, use: </p><div class="fragment"><div class="line"><span class="comment">// value previously computed for the volume</span></div>
<div class="line">Standard_Real aVolume = ...;</div>
<div class="line">XCAFDoc_Volume::Set (aLabel, aVolume);</div>
</div><!-- fragment --><h1><a class="anchor" id="occt_xde_2_6"></a>
Colors and Layers</h1>
<p>XDE can read and write colors and layers assigned to shapes or their subparts (down to level of faces and edges) to and from both IGES and STEP formats.</p>
<div class="image">
<img src="239_xde_12_400.png" alt=""/>
<div class="caption">
Motor Head</div></div>
<p>In an XDE document, colors are managed by the class <code>XCAFDoc_ColorTool</code>. It works basing on the same principles as ShapeTool works with Shapes. This tool can be provided on the Main Label or on any sub-label. The Property itself is defined as an <code>XCAFDoc_Color</code>, sub-class of <code>TDF_Attribute</code>.</p>
<p>Colors are stored in a child of the starting document label: it is the second level (<code>0.1.2</code>), while Shapes are at the first level. Each color then corresponds to a dedicated label, the property itself is a <code>Quantity_Color</code>, which has a name and value for Red, Green, Blue. A Color may be attached to Surfaces (flat colors) or to Curves (wireframe colors), or to both. A Color may be attached to a sub-shape. In such a case, the sub-shape (and its own sub-shapes) takes its own Color as a priority.</p>
<p>Layers are handled using the same principles as Colors. In all operations described below you can simply replace <b>Color</b> with <b>Layer</b> when dealing with Layers. Layers are supported by the class <code>XCAFDoc_LayerTool</code>.</p>
<p>The class of the property is <code>XCAFDoc_Layer</code>, sub-class of <code>TDF_Attribute</code> while its definition is a <code>TCollection_ExtendedString</code>. Integers are generally used when dealing with Layers. The general cases are:</p><ul>
<li>IGES has <em>LevelList</em> as a list of Layer Numbers (not often used);</li>
<li>STEP identifies a Layer (not by a Number, but by a String), to be more general.</li>
</ul>
<p>Colors and Shapes are related to by Tree Nodes.</p>
<p>These definitions are common to various exchange formats, at least for STEP and IGES.</p>
<h2><a class="anchor" id="occt_xde_2_6_1"></a>
Initialization</h2>
<p>To query, edit, or initialize a Document to handle Colors of XCAF, use: </p><div class="fragment"><div class="line">Handle(XCAFDoc_ColorTool) myColors = XCAFDoc_DocumentTool::ColorTool (theDoc-&gt;Main()); </div>
</div><!-- fragment --><p>This call can be used at any time. The first time it is used, a relevant structure is added to the document. This definition is used for all the following color calls and will not be repeated for these.</p>
<h2><a class="anchor" id="occt_xde_2_6_2"></a>
Adding a Color</h2>
<p>There are two ways to add a color. You can:</p><ul>
<li>add a new Color defined as <code>Quantity_Color</code> and then directly set it to a Shape (anonymous Color);</li>
<li>define a new Property Color, add it to the list of Colors, and then set it to various shapes.</li>
</ul>
<p>When the Color is added by its value <code>Quantity_Color</code>, it is added only if it has not yet been recorded (same RGB values) in the Document.</p>
<p>To set a Color to a Shape using a label, use: </p><div class="fragment"><div class="line">Quantity_Color aCol (red, green, blue);</div>
<div class="line"><span class="comment">// Can take one of these values:</span></div>
<div class="line"><span class="comment">// XCAFDoc_ColorGen - all types of geometries;</span></div>
<div class="line"><span class="comment">// XCAFDoc_ColorSurf - surfaces only;</span></div>
<div class="line"><span class="comment">// XCAFDoc_ColorCurv - curves only.</span></div>
<div class="line">XCAFDoc_ColorType aColType = ...;</div>
<div class="line">myColors-&gt;SetColor (aLabel, aCol, aColType);</div>
</div><!-- fragment --><p>Alternately, the Shape can be designated directly, without using its label, use: </p><div class="fragment"><div class="line">myColors-&gt;SetColor (aShape, aCol, aColType);</div>
<div class="line"><span class="comment">// creating and Adding a Color, explicitly</span></div>
<div class="line">Quantity_Color aCol (red, green, blue);</div>
<div class="line">TDF_Label aColLabel = myColors-&gt;AddColor (aCol);</div>
</div><!-- fragment --><p><b>Note</b> that this Color can then be named, allowing later retrieval by its Name instead of its Value.</p>
<p>To set a Color, identified by its Label and already recorded, to a Shape, use: </p><div class="fragment"><div class="line">XCAFDoc_ColorType aColType = ...; <span class="comment">// see above</span></div>
<div class="line"><span class="keywordflow">if</span> (myColors-&gt;SetColors (aLabel, aColLabel, aColType)) {.. it is done .. }</div>
</div><!-- fragment --><p>In this example, <code>aLabel</code> can be replaced by <code>aShape</code> directly.</p>
<h2><a class="anchor" id="occt_xde_2_6_3"></a>
Queries on Colors</h2>
<p>Various queries can be performed on colors. However, only specific queries are included in this section, not general queries using names.</p>
<p>To determine if a Color is attached to a Shape, for a given color type (<code>aColType</code>), use: </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (myColors-&gt;IsSet (aLabel, aColType))</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// yes, there is one ..</span></div>
<div class="line">} </div>
</div><!-- fragment --><p>In this example, <code>aLabel</code> can be replaced by <code>aShape</code> directly.</p>
<p>To get the Color attached to a Shape (for any color type), use: </p><div class="fragment"><div class="line">Quantity_Color aCol;</div>
<div class="line"><span class="comment">// will receive the recorded value (if there is some)</span></div>
<div class="line"><span class="keywordflow">if</span> (!myColors-&gt;GetColor (aLabel, aCol))</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// sorry, no color ..</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>Color name can also be queried from <code>aCol.StringName</code> or <code>aCol.Name</code>. In this example, <code>aLabel</code> can be replaced by <code>aShape</code> directly.</p>
<p>To get the Color attached to a Shape, with a specific color type, use: </p><div class="fragment"><div class="line">XCAFDoc_ColorType aColType = ...;</div>
<div class="line">Quantity_Color aCol;</div>
<div class="line"><span class="comment">// will receive the recorded value (if there is some)</span></div>
<div class="line"><span class="keywordflow">if</span> (!myColors-&gt;GetColor (aLabel, aColType, aCol))</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// sorry, no color ..</span></div>
<div class="line">} </div>
</div><!-- fragment --><p>To get all the Colors recorded in the Document, use: </p><div class="fragment"><div class="line">TDF_LabelSequence aColLabels;</div>
<div class="line">myColors-&gt;GetColors (aColLabels);</div>
<div class="line"><span class="keywordflow">for</span> (TDF_LabelSequence::Iterator aColIter (aColLabels); aColIter.More(); aColIter.Next())</div>
<div class="line">{</div>
<div class="line">  Quantity_Color aCol; <span class="comment">// to receive the values</span></div>
<div class="line">  TDF_Label aColLabel = aColIter.Value();</div>
<div class="line">  <span class="keywordflow">if</span> (!myColors-&gt;GetColor (aColLabel, aCol)) { <span class="keywordflow">continue</span>; }</div>
<div class="line">} </div>
</div><!-- fragment --><p>To find a Color from its Value, use: </p><div class="fragment"><div class="line">Quantity_Color aCol (red, green, blue);</div>
<div class="line">TDF_Label aColLabel = myColors-&gt;FindColor (aCol);</div>
<div class="line"><span class="keywordflow">if</span> (!aColLabel.IsNull()) { .. found .. }</div>
</div><!-- fragment --><h2><a class="anchor" id="occt_xde_2_6_4"></a>
Editing Colors</h2>
<p>Besides adding colors, the following attribute edits can be made:</p>
<p>To unset a Color on a Shape, use: </p><div class="fragment"><div class="line"><span class="comment">// desired type (XCAFDoc_ColorGen for all ) </span></div>
<div class="line">XCAFDoc_ColorType aColType = ...;</div>
<div class="line">myColors-&gt;UnSetColor (aLabel, aColType);</div>
</div><!-- fragment --><p>To remove a Color and all the references to it (so that the related shapes will become colorless), use: </p><div class="fragment"><div class="line">myColors-&gt;RemoveColor (aColLabel);</div>
</div><!-- fragment --><h1><a class="anchor" id="occt_xde_2_7"></a>
Geometric Dimensions &amp; Tolerances (GD&amp;T)</h1>
<p>XDE can read and write GD&amp;T assigned to shapes or their subparts (down to the level of faces and edges) to and from STEP formats.</p>
<p>In an XDE document, GD&amp;T are managed by the class <code>XCAFDoc_DimTolTool</code>. It works basing on the same principles as ShapeTool works with Shapes. This tool can be provided on the Main Label or on any sub-label. The GD&amp;T entities themselves are defined as the following sub-classes of <code>TDF_Attribute</code>:</p><ul>
<li><code>XCAFDoc_Dimension</code> - for dimensions;</li>
<li><code>XCAFDoc_GeomTolerance</code> - for geometric tolerances;</li>
<li><code>XCAFDoc_Datum</code> - for geometric tolerance Datums.</li>
</ul>
<p>A GD&amp;T type is identified by the attributes listed above, i.e. <code>XCAFDoc_DimTolTool</code> methods working with particular entity types check for presence of the corresponding attributes in passed labels. One can use methods of <code>XCAFDoc_DimTolTool</code> beginning with 'Is' for this purpose.</p>
<p>GD&amp;T entities are stored in a child of the starting document label <code>0.1.4</code>. Each GD&amp;T entity then corresponds to the dedicated label, the property itself is one of access classes:</p><ul>
<li><code>XCAFDimTolObject_DimensionObject</code> - for dimensions;</li>
<li><code>XCAFDimTolObject_GeomToleranceObject</code> - for geometric tolerances;</li>
<li><code>XCAFDimTolObject_DatumObject</code> - for geometric tolerance Datums.</li>
</ul>
<p>GD&amp;Ts and Shapes are related by Graph Nodes.</p>
<p>These definitions are common to various exchange formats, at least for STEP.</p>
<h2><a class="anchor" id="occt_xde_2_7_1"></a>
Initialization</h2>
<p>To query, edit, or initialize a Document to handle GD&amp;Ts of XCAF, use: </p><div class="fragment"><div class="line">Handle(XCAFDoc_DimTolTool) myDimTolTool = XCAFDoc_DocumentTool::DimTolTool (theDoc-&gt;Main());</div>
</div><!-- fragment --><p>This call can be used at any time. When it is used for the first time, a relevant structure is added to the document. This definition is used for all later GD&amp;T calls and is not repeated for them.</p>
<h2><a class="anchor" id="occt_xde_2_7_2"></a>
Adding a GD&amp;T</h2>
<p><code>XCAFDoc_DimTolTool</code> provides methods to create GD&amp;T 'empty' entities:</p><ul>
<li><code>XCAFDoc_DimTolTool::AddDimension</code> - for a new dimension;</li>
<li><code>XCAFDoc_DimTolTool::AddGeomTolerance</code> - for a new geometric tolerance;</li>
<li><code>XCAFDoc_DimTolTool::AddDatum</code> - for a new geometric tolerance datum.</li>
</ul>
<p>All methods create a sub-label for the corresponding GD&amp;T entity of the tool master label and attach an attribute specific for the created entity.</p>
<p>Here is an example of adding a new dimension: </p><div class="fragment"><div class="line">TDF_Label aDimLabel = myDimTolTool-&gt;AddDimension();</div>
<div class="line"><span class="keywordflow">if</span> (!aDimLabel.IsNull())</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// error processing</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>A similar approach can be used for other GD&amp;T types.</p>
<h2><a class="anchor" id="occt_xde_2_7_3"></a>
Editing a GD&amp;T</h2>
<p>A newly added GD&amp;T entity is empty. To set its data a corresponding access object should be used as it is demonstrated below, where the dimension becomes a linear distance between two points. </p><div class="fragment"><div class="line">Handle(XCAFDoc_Dimension) aDimAttr;</div>
<div class="line">aDimLabel.FindAttribute (XCAFDoc_Dimension::GetID(), aDimAttr);</div>
<div class="line"><span class="keywordflow">if</span> (!aDimAttr.IsNull())</div>
<div class="line">{</div>
<div class="line">  Handle(XCAFDimTolObjects_DimensionObject) aDimObject = aDimAttr-&gt;GetObject();</div>
<div class="line">  <span class="comment">// set dimension data</span></div>
<div class="line">  aDimObject-&gt;SetType(XCAFDimTolObjects_DimensionType_Location_LinearDistance);</div>
<div class="line">  aDimObject-&gt;SetPoint(thePnt1);  <span class="comment">// the first reference point</span></div>
<div class="line">  aDimObject-&gt;SetPoint2(thePnt2); <span class="comment">// the second reference point</span></div>
<div class="line">  aDimObject-&gt;SetValue(theValue); <span class="comment">// the distance value</span></div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">  aDimAttr-&gt;SetObject(aDimObject);</div>
<div class="line">}</div>
</div><!-- fragment --><p>A similar approach can be used for other GD&amp;T types.</p>
<h2><a class="anchor" id="occt_xde_2_7_4"></a>
Linking GD&amp;Ts</h2>
<p>To link a GD&amp;T entity with other OCAF labels (e.g. representing shapes) one should use the following methods:</p><ul>
<li><code>XCAFDoc_DimTolTool::SetDimension</code> - for dimensions;</li>
<li><code>XCAFDoc_DimTolTool::SetGeomTolerance</code> - for geometric tolerances;</li>
<li><code>XCAFDoc_DimTolTool::SetDatum</code> - for geometric tolerance datums.</li>
</ul>
<p>These methods can take a single label or a sequence of labels. All previous links will be removed.</p>
<p>The example below demonstrates linking of a dimension to sequences of shape labels: </p><div class="fragment"><div class="line">TDF_LabelSequence aShapes1, aShapes2;</div>
<div class="line">aShapes1.Append (aShape11);</div>
<div class="line"><span class="comment">//...</span></div>
<div class="line">aShapes2.Append (aShape21);</div>
<div class="line"><span class="comment">//...</span></div>
<div class="line">aDGTTool-&gt;SetDimension (aShapes1, aShapes2, aDimLabel);</div>
</div><!-- fragment --><p>In addition, a special method <code>XCAFDoc_DimTolTool::SetDatumToGeomTol</code> should be used to link a datum with a geometric tolerance.</p>
<h2><a class="anchor" id="occt_xde_2_7_5"></a>
Finding GD&amp;Ts and reference shapes</h2>
<p><code>XCAFDimTolObjects_Tool</code> class provides basic capabilities for searching GD&amp;Ts linked to shapes. The tool provides sequences of dimensions, geometric tolerances and datums linked with a shape. A series of related datums is also returned for geometric tolerances.</p>
<p>To get reference shapes for a GD&amp;T entity one can use <code>XCAFDoc_DimTolTool::GetRefShapeLabel</code>.</p>
<p><code>XCAFDoc_DimTolTool</code> provides methods to get lists of all dimensions, geometric tolerances and datums.</p>
<h2><a class="anchor" id="occt_xde_2_7_6"></a>
Storing custom data</h2>
<p>Every GD&amp;T entity in XDE is represented as a label with attached attribute identifying entity type. All specific data is stored in sub-labels in standard OCAF attributes, such as <code>TDataStd_Integer</code>, <code>TDataStd_IntegerArray</code>, <code>TDataStd_RealArray</code> and so on. Sub-label tags are reserved for internal use and cannot be used for storing custom data. The following tag ranges are reserved for GD&amp;T entities:</p><ul>
<li>1 - 17 - for dimensions;</li>
<li>1 - 17 - for geometric tolerances;</li>
<li>1 - 19 - for datums.</li>
</ul>
<p>Custom data can be stored in labels with tags beyond the ranges listed above.</p>
<h1><a class="anchor" id="occt_xde_2_8"></a>
Clipping planes</h1>
<p>In an XDE document, Clipping planes are managed by the class <code>XCAFDoc_ClippingPlaneTool</code>. It works basing on the same principles as ShapeTool works with Shapes. This tool can be provided on the Main Label or on any sub-label. Clipping planes are stored in a child of the starting document label <code>0.1.8</code>, where planes themselves are defined as <code>TDataXtd_Plane</code> attribute. <code>TDataStd_Name</code> attribute is used for naming.</p>
<p>To query, edit, or initialize a Document to handle clipping planes of XCAF, use: </p><div class="fragment"><div class="line">Handle(XCAFDoc_ClippingPlaneTool) myClipPlaneTool = XCAFDoc_DocumentTool::ClippingPlaneTool (theDoc-&gt;Main());</div>
</div><!-- fragment --><p>This call can be used at any time. When it is used for the first time, a relevant structure is added to the document.</p>
<p>To add a clipping plane use one of overloaded methods <code>XCAFDoc_ClippingPlaneTool::AddClippingPlane</code>, e.g.: </p><div class="fragment"><div class="line">gp_Pln aPln = ...;</div>
<div class="line">Standard_Boolean aCapping = ...;</div>
<div class="line">TDF_Label aClipPlnLbl = myClipPlaneTool-&gt;AddClippingPlane (aPln, <span class="stringliteral">&quot;Name of plane&quot;</span>, aCapping);</div>
<div class="line"><span class="keywordflow">if</span> (aClipPlnLbl.IsNull())</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// error processing</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>To remove a plane use <code>XCAFDoc_ClippingPlaneTool::RemoveClippingPlane</code> method, e.g.: </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (!myClipPlaneTool-&gt;RemoveClippingPlane (aClipPlnLbl))</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// not removed</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>The plane will not be removed if it is referenced in at least one view.</p>
<p>To change the clipping plane and its name use <code>XCAFDoc_ClippingPlaneTool::UpdateClippingPlane</code> method, e.g.: </p><div class="fragment"><div class="line">gp_Pln aPln = ...;</div>
<div class="line">myClipPlaneTool-&gt;UpdateClippingPlane (aClipPlnLbl, aPln, <span class="stringliteral">&quot;New name of plane&quot;</span>);</div>
</div><!-- fragment --><p>Capping property can be changed using <code>XCAFDoc_ClippingPlaneTool::SetCapping</code> method, e.g.: </p><div class="fragment"><div class="line">Standard_Boolean aCapping = ...;</div>
<div class="line">myClipPlaneTool-&gt;SetCapping (aClipPlnLbl, aCapping);</div>
</div><!-- fragment --><p><code>XCAFDoc_ClippingPlaneTool</code> can be used to get all clipping plane labels and to check if a label belongs to the <em>ClippingPlane table</em>, e.g.: </p><div class="fragment"><div class="line">TDF_LabelSequence aClipPlaneLbls;</div>
<div class="line">myClipPlaneTool-&gt;GetClippingPlanes(aClipPlaneLbls);</div>
<div class="line">...</div>
<div class="line">for (TDF_LabelSequence::Iterator anIt(aClipPlaneLbls); anIt.More(); anIt.Next())</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span> (myClipPlaneTool-&gt;IsClippingPlane(anIt.Value()))</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// the label is a clipping plane</span></div>
<div class="line">    gp_Pln aPln;</div>
<div class="line">    TCollection_ExtendedString aName;</div>
<div class="line">    Standard_Boolean aCapping;</div>
<div class="line">    <span class="keywordflow">if</span> (!myClipPlaneTool-&gt;GetClippingPlane(anIt.Value(), aPln, aName, aCapping))</div>
<div class="line">    {</div>
<div class="line">      <span class="comment">// error processing</span></div>
<div class="line">    }</div>
<div class="line">    ...</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="occt_xde_2_9"></a>
Saved views</h1>
<p>In an XDE document, Views are managed by the class <code>XCAFDoc_ViewTool</code>. It works basing on the same principles as ShapeTool works with Shapes. This tool can be provided on the Main Label or on any sub-label. Views are stored in a child of the starting document label <code>0.1.7</code>, where a view itself is defined as <code>XCAFDoc_View</code> sub-class of <code>TDF_Attribute</code>. Views and selected shapes, clipping planes, GD&amp;Ts and notes are related by Graph Nodes.</p>
<p>To query, edit, or initialize a Document to handle views of XCAF, use: </p><div class="fragment"><div class="line">Handle(XCAFDoc_ViewTool) myViewTool = XCAFDoc_DocumentTool::ViewTool (theDoc-&gt;Main());</div>
</div><!-- fragment --><p>This call can be used at any time. When it is used for the first time, a relevant structure is added to the document.</p>
<p>To add a view use <code>XCAFDoc_ViewTool::AddView</code> method and an access <code>XCAFView_Object</code> object to set camera parameters, e.g.: </p><div class="fragment"><div class="line">TDF_Label aViewLbl = myViewTool-&gt;AddView();</div>
<div class="line"><span class="keywordflow">if</span> (aViewLbl.IsNull())</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// error processing</span></div>
<div class="line">}</div>
<div class="line">Handle(XCAFDoc_View) aViewAttr;</div>
<div class="line">aViewLbl.FindAttribute(XCAFDoc_View::GetID(), aViewAttr);</div>
<div class="line"><span class="keywordflow">if</span> (!aViewAttr.IsNull())</div>
<div class="line">{</div>
<div class="line">  Handle(XCAFView_Object) aViewObject = aViewAttr-&gt;GetObject();</div>
<div class="line">  <span class="comment">// set view data</span></div>
<div class="line">  aViewObject-&gt;SetType(XCAFView_ProjectionType_Parallel);</div>
<div class="line">  aViewObject-&gt;SetViewDirection(theViewDir);</div>
<div class="line">  aViewObject-&gt;SetZoomFactor(2.0);</div>
<div class="line">  ...</div>
<div class="line">  aViewAttr-&gt;SetObject(aViewObject);</div>
<div class="line">}</div>
</div><!-- fragment --><p>To set shapes, clipping planes, GD&amp;Ts and notes selected for the view use one of overloaded <code>SetView</code> methods of <code>XCAFDoc_ViewTool</code>. To set only clipping planes one should use <code>XCAFDoc_ViewTool::SetClippingPlanes</code> method. </p><div class="fragment"><div class="line">TDF_LabelSequence aShapes; ...</div>
<div class="line">TDF_LabelSequence aGDTs; ...</div>
<div class="line">myViewTool-&gt;SetView(aShapes, aGDTs, aViewLbl);</div>
<div class="line">TDF_LabelSequence aClippingPlanes; ...</div>
<div class="line">myViewTool-&gt;SetClippingPlanes(aClippingPlanes, aViewLbl);</div>
</div><!-- fragment --><p>To remove a view use <code>XCAFDoc_ViewTool::RemoveView</code> method.</p>
<p>To get all view labels and check if a label belongs to the View table use: </p><div class="fragment"><div class="line">TDF_LabelSequence aViewLbls;</div>
<div class="line">myViewTool-&gt;GetViewLabels(aViewLbls);</div>
<div class="line">...</div>
<div class="line">for (TDF_LabelSequence::Iterator anIt(aViewLbls); anIt.More(); anIt.Next())</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span> (myViewTool-&gt;IsView(anIt.Value()))</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// the label is a view</span></div>
<div class="line">    ...</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>To get shapes, clipping planes, GD&amp;Ts or notes associated with a particular view use the following methods:</p><ul>
<li><code>XCAFDoc_ViewTool::GetRefShapeLabel</code> - returns a sequence of associated shape labels;</li>
<li><code>XCAFDoc_ViewTool::GetRefGDTLabel</code> - returns a sequence of associated GDT labels;</li>
<li><code>XCAFDoc_ViewTool::GetRefClippingPlaneLabel</code> - returns a sequence of associated clipping plane labels;</li>
<li><code>XCAFDoc_ViewTool::GetRefNoteLabel</code> - returns a sequence of associated note labels;</li>
<li><code>XCAFDoc_ViewTool::GetRefAnnotationLabel</code> - returns a sequence of associated annotated labels.</li>
</ul>
<p>And vice versa, to get views that display a particular clipping plane, GD&amp;T or note use the following methods:</p><ul>
<li><code>XCAFDoc_ViewTool::GetViewLabelsForShape</code> - returns a sequence of view labels associated with a shape;</li>
<li><code>XCAFDoc_ViewTool::GetViewLabelsForGDT</code> - returns a sequence of view labels associated with a GD&amp;T;</li>
<li><code>XCAFDoc_ViewTool::GetViewLabelsForClippingPlane</code> - returns a sequence of view labels associated with a clipping plane;</li>
<li><code>XCAFDoc_ViewTool::GetViewLabelsForNote</code> - returns a sequence of view labels associated with a note;</li>
<li><code>XCAFDoc_ViewTool::GetViewLabelsForAnnotation</code> - returns a sequence of view labels associated with an annotated label.</li>
</ul>
<h1><a class="anchor" id="occt_xde_2_10"></a>
Custom notes</h1>
<p>In an XDE document, custom notes are managed by the class <code>XCAFDoc_NotesTool</code>. It works basing on the same principles as ShapeTool works with Shapes. This tool can be provided on the Main Label or on any sub-label. The Property itself is defined as sub-class of <code>XCAFDoc_Note</code> abstract class, which is a sub-class of <code>TDF_Attribute</code> one.</p>
<p>Custom notes are stored in a child of the <code>XCAFDoc_NotesTool</code> label, at label <code>0.1.9.1</code>. Each note then corresponds to a dedicated label. A note may be attached to a document item identified by a label, a sub-shape identified by integer index or an attribute identified by GUID. Annotations are stored in a child of the <code>XCAFDoc_NotesTool</code> label, at label <code>0.1.9.2</code>. Notes binding is done through <code>XCAFDoc_GraphNode</code> attribute.</p>
<div class="image">
<img src="xde_notes001.png" alt=""/>
<div class="caption">
Structure of notes part of XCAF document</div></div>
<h2><a class="anchor" id="occt_xde_2_10_1"></a>
Initialization</h2>
<p>To query, edit, or initialize a Document to handle custom notes of XCAF, use: </p><div class="fragment"><div class="line">Handle(XCAFDoc_NotesTool) myNotes = XCAFDoc_DocumentTool::NotesTool (theDoc-&gt;Main());</div>
</div><!-- fragment --><p>This call can be used at any time. The first time it is used, a relevant structure is added to the document. This definition is used for all later notes calls and will not be repeated for them.</p>
<h2><a class="anchor" id="occt_xde_2_10_2"></a>
Creating Notes</h2>
<p>Before annotating a Document item a note must be created using one of the following methods of <code>XCAFDoc_NotesTool</code> class:</p><ul>
<li><code>XCAFDoc_NotesTool::CreateComment</code>: creates a note with a textual comment;</li>
<li><code>XCAFDoc_NotesTool::CreateBinData</code>: creates a note with arbitrary binary data, e.g. contents of a file.</li>
</ul>
<p>Both methods return an instance of <code>XCAFDoc_Note</code> class. </p><div class="fragment"><div class="line">Handle(XCAFDoc_NotesTool) myNotes = ...;</div>
<div class="line">Handle(XCAFDoc_Note) myNote = myNotes-&gt;CreateComment (<span class="stringliteral">&quot;User&quot;</span>, <span class="stringliteral">&quot;Timestamp&quot;</span>, <span class="stringliteral">&quot;Hello, World!&quot;</span>);</div>
</div><!-- fragment --><p>This code adds a child label to label <code>0.1.9.1</code> with <code>XCAFDoc_NoteComment</code> attribute.</p>
<h2><a class="anchor" id="occt_xde_2_10_3"></a>
Editing a Note</h2>
<p>An instance of <code>XCAFDoc_Note</code> class can be used for note editing. One may change common note data. </p><div class="fragment"><div class="line">myNote-&gt;Set(<span class="stringliteral">&quot;New User&quot;</span>, <span class="stringliteral">&quot;New Timestamp&quot;</span>);</div>
</div><!-- fragment --><p>To change specific data one needs to down cast <code>myNote</code> handle to the appropriate sub-class: </p><div class="fragment"><div class="line">Handle(XCAFDoc_NoteComment) myCommentNote = Handle(XCAFDoc_NoteComment)::DownCast(myNote);</div>
<div class="line"><span class="keywordflow">if</span> (!myCommentNote.IsNull())</div>
<div class="line">{</div>
<div class="line">  myCommentNote-&gt;Set(<span class="stringliteral">&quot;New comment&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>In order to edit auxiliary note data such as text and attachment position, plane for rendering and tessellated presentation, one should use a transfer object <code>XCAFNoteObjects_NoteObject</code> by GetObject and SetObject methods of <code>XCAFDoc_Note</code> class. <code>XCAFNoteObjects_NoteObject</code> class provides the following functionality:</p><ul>
<li><code>HasPlane</code>, <code>GetPlane</code> and <code>SetPlane</code> methods test, get and set plane for note rendering;</li>
<li><code>HasPoint</code>, <code>GetPoint</code> and <code>SetPoint</code> methods test, get and set note attachment position on the annotated object;</li>
<li><code>HasPointText</code>, <code>GetPointText</code>, <code>SetPointText</code> methods test, get and set test position;</li>
<li><code>GetPresentation</code> and <code>SetPresentation</code> methods allow to test for and specify tessellated presentation.</li>
</ul>
<p>After getting, the transfer object can be edited and set back to the note: </p><div class="fragment"><div class="line">Handle(XCAFNoteObjects_NoteObject) aNoteObj = myNote-&gt;GetObject();</div>
<div class="line"><span class="keywordflow">if</span> (!aNoteObj.IsNull())</div>
<div class="line">{</div>
<div class="line">  gp_Pnt aPntTxt (...);</div>
<div class="line">  aNoteObj-&gt;SetPointText (aPntTxt);</div>
<div class="line">  TopoDS_Shape aS = ...;</div>
<div class="line">  aNoteObj-&gt;SetPresentation (aS);</div>
<div class="line">  myNote-&gt;SetObject (aNoteObj);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="occt_xde_2_10_4"></a>
Adding Notes</h2>
<p>Once a note has been created it can be bound to a Document item using the following <code>XCAFDoc_NotesTool</code> methods:</p><ul>
<li><code>XCAFDoc_NotesTool::AddNote</code>: binds a note to a label;</li>
<li><code>XCAFDoc_NotesTool::AddNoteToAttr</code>: binds a note to a label's attribute;</li>
<li><code>XCAFDoc_NotesTool::AddNoteToSubshape</code>: binds a note to a sub-shape.</li>
</ul>
<p>All methods return a pointer to <code>XCAFDoc_AssemblyItemRef</code> attribute identifying the annotated item. </p><div class="fragment"><div class="line">Handle(XCAFDoc_NotesTool) myNotes = ...;</div>
<div class="line">Handle(XCAFDoc_Note) myNote = ...;</div>
<div class="line">TDF_Label theLabel = ...;</div>
<div class="line">Handle(XCAFDoc_AssemblyItemRef) myRef = myNotes-&gt;AddNote(myNote-&gt;Label(), theLabel);</div>
<div class="line">Standard_GUID theAttrGUID = ...;</div>
<div class="line">Handle(XCAFDoc_AssemblyItemRef) myRefAttr = myNotes-&gt;AddNoteToAttr(myNote-&gt;Label(), theAttrGUID);</div>
<div class="line">Standard_Integer theSubshape = 1;</div>
<div class="line">Handle(XCAFDoc_AssemblyItemRef) myRefSubshape = myNotes-&gt;AddNoteToSubshape(myNote-&gt;Label(), theSubshape);</div>
</div><!-- fragment --><p>This code adds three child labels with <code>XCAFDoc_AssemblyItemRef</code> attribute to label <code>0.1.9.2</code>. <code>XCAFDoc_GraphNode</code> attributes are added to the child labels and note labels.</p>
<h2><a class="anchor" id="occt_xde_2_10_5"></a>
Finding Notes</h2>
<p>To find annotation labels under label <code>0.1.9.2</code> use the following <code>XCAFDoc_NotesTool</code> methods:</p><ul>
<li><code>XCAFDoc_NotesTool::FindAnnotatedItem</code>: returns an annotation label for a label;</li>
<li><code>XCAFDoc_NotesTool::FindAnnotatedItemAttr</code>: returns an annotation label for a label's attribute;</li>
<li><code>XCAFDoc_NotesTool::FindAnnotatedItemSubshape</code>: returns an annotation label for a sub-shape.</li>
</ul>
<div class="fragment"><div class="line">Handle(XCAFDoc_NotesTool) myNotes = ...;</div>
<div class="line">TDF_Label theLabel = ...;</div>
<div class="line">TDF_Label myLabel = myNotes-&gt;FindAnnotatedItem(theLabel);</div>
<div class="line">Standard_GUID theAttrGUID = ...;</div>
<div class="line">TDF_Label myLabelAttr = myNotes-&gt;FindAnnotatedItemAttr(theLabel, theAttrGUID);</div>
<div class="line">Standard_Integer theSubshape = 1;</div>
<div class="line">TDF_Label myLabelSubshape = myNotes-&gt;FindAnnotatedItemSubshape(theLabel, theSubshape);</div>
</div><!-- fragment --><p>Null label will be returned if there is no corresponding annotation.</p>
<p>To get all notes of the Document item use the following <code>XCAFDoc_NotesTool</code> methods:</p><ul>
<li><code>XCAFDoc_NotesTool::GetNotes</code>: outputs a sequence of note labels bound to a label;</li>
<li><code>XCAFDoc_NotesTool::GetAttrNotes</code>: outputs a sequence of note labels bound to a label's attribute;</li>
<li><code>XCAFDoc_NotesTool::GetAttrSubshape</code>: outputs a sequence of note labels bound to a sub-shape.</li>
</ul>
<p>All these methods return the number of notes. </p><div class="fragment"><div class="line">Handle(XCAFDoc_NotesTool) myNotes = ...;</div>
<div class="line">TDF_Label theLabel = ...;</div>
<div class="line">TDF_LabelSequence theNotes;</div>
<div class="line">myNotes-&gt;GetNotes(theLabel, theNotes);</div>
<div class="line">Standard_GUID theAttrGUID = ...;</div>
<div class="line">TDF_LabelSequence theNotesAttr;</div>
<div class="line">myNotes-&gt;GetAttrNotes(theLabel, theAttrGUID, theNotesAttr);</div>
<div class="line">Standard_Integer theSubshape = 1;</div>
<div class="line">TDF_LabelSequence theNotesSubshape;</div>
<div class="line">myNotes-&gt;GetAttrSubshape(theLabel, theSubshape, theNotesSubshape);</div>
</div><!-- fragment --><h2><a class="anchor" id="occt_xde_2_10_6"></a>
Removing Notes</h2>
<p>To remove a note use one of the following <code>XCAFDoc_NotesTool</code> methods:</p><ul>
<li><code>XCAFDoc_NotesTool::RemoveNote</code>: unbinds a note from a label;</li>
<li><code>XCAFDoc_NotesTool::RemoveAttrNote</code>: unbinds a note from a label's attribute;</li>
<li><code>XCAFDoc_NotesTool::RemoveSubshapeNote</code>: unbinds a note from a sub-shape.</li>
</ul>
<div class="fragment"><div class="line">Handle(XCAFDoc_Note) myNote = ...;</div>
<div class="line">TDF_Label theLabel = ...;</div>
<div class="line">myNotes-&gt;RemoveNote(myNote-&gt;Label(), theLabel);</div>
<div class="line">Standard_GUID theAttrGUID = ...;</div>
<div class="line">myRefAttr = myNotes-&gt;RemoveAttrNote(myNote-&gt;Label(), theAttrGUID);</div>
<div class="line">Standard_Integer theSubshape = 1;</div>
<div class="line">myNotes-&gt;RemoveSubshapeNote(myNote-&gt;Label(), theSubshape);</div>
</div><!-- fragment --><p>A note will not be deleted automatically. Counterpart methods to remove all notes are available, too.</p>
<h2><a class="anchor" id="occt_xde_2_10_7"></a>
Deleting Notes</h2>
<p>To delete note(s) use the following <code>XCAFDoc_NotesTool</code> methods:</p><ul>
<li><code>XCAFDoc_NotesTool::DeleteNote</code>: deletes a single note;</li>
<li><code>XCAFDoc_NotesTool::DeleteNotes</code>: deletes a sequence of notes;</li>
<li><code>XCAFDoc_NotesTool::DeleteAllNotes</code>: deletes all Document notes;</li>
<li><code>XCAFDoc_NotesTool::DeleteOrphanNotes</code>: deletes notes not bound to Document items.</li>
</ul>
<p>All these methods except for the last one break all links with Document items as well.</p>
<h1><a class="anchor" id="occt_xde_2_11"></a>
Reading and Writing STEP or IGES</h1>
<p>Note that saving and restoring the document itself are standard OCAF operations. As the various previously described definitions enter into this frame, they will not be explained any further. The same can be said for Viewing: presentations can be defined from Shapes and Colors.</p>
<p>There are several important points to consider:</p><ul>
<li>Previously defined Readers and Writers for dealing with Shapes only, whether Standard or Advanced, remain unchanged in their form and in their dependencies. In addition, functions other than mapping are also unchanged.</li>
<li>XDE provides mapping with data other than Shapes. Names, Colors, Layers, GD&amp;T, Clipping planes, Views, Validation Properties (Centroid, Volume, Area), and Assembly Structure are hierarchic with rigid motion. Currently, Clipping planes and Views writing supported for XBF format only.</li>
<li>XDE mapping is relevant for use within the Advanced level of Data Exchanges, rather than Standard ones, because a higher level of information is better suited to a higher quality of shapes. In addition, this allows to avoid the multiplicity of combinations between various options. Note that this choice is not one of architecture but of practical usage and packaging.</li>
<li>Reader and Writer classes for XDE are generally used like those for Shapes. However, their use is adapted to manage a Document rather than a Shape.</li>
</ul>
<p>The packages to manage this are <code>IGESCAFControl</code> for IGES, and <code>STEPCAFControl</code> for STEP.</p>
<h2><a class="anchor" id="occt_xde_2_11_1"></a>
Reading a STEP file</h2>
<p>To read a STEP file by itself, use:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* theFilename = ...;</div>
<div class="line">STEPCAFControl_Reader aReader;</div>
<div class="line">IFSelect_ReturnStatus aReadStat = aReader.ReadFile (theFilename);</div>
<div class="line"><span class="keywordflow">if</span> (aReadStat != IFSelect_RetDone) { .. reader/parser error .. }</div>
<div class="line"><span class="comment">// the various ways of reading a file are available here too:</span></div>
<div class="line"><span class="comment">// to read it by the reader, to take it from a WorkSession ...</span></div>
<div class="line">Handle(TDocStd_Document) aDoc = ...;</div>
<div class="line"><span class="comment">// the document referred to is already defined and properly initialized; now, the transfer itself</span></div>
<div class="line"><span class="keywordflow">if</span> (!aReader.Transfer (aDoc))</div>
<div class="line">{</div>
<div class="line">  Message::SendFail() &lt;&lt; <span class="stringliteral">&quot;Cannot read any relevant data from the STEP file&quot;</span>;</div>
<div class="line">  <span class="comment">// abandon ..</span></div>
<div class="line">}</div>
<div class="line"><span class="comment">// here, the Document has been filled from a STEP file, it is ready to use</span></div>
</div><!-- fragment --><p>In addition, the reader provides methods that are applicable to document transfers and for directly querying of the data produced.</p>
<h2><a class="anchor" id="occt_xde_2_11_2"></a>
Writing a STEP file</h2>
<p>To write a STEP file by itself, use:</p>
<div class="fragment"><div class="line"><span class="comment">// AsIs is the recommended value, others are available;</span></div>
<div class="line">STEPControl_StepModelType aMode = STEPControl_AsIs;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// the user can work with an already prepared WorkSession or create a new one</span></div>
<div class="line"><span class="comment">//bool aScratch = false;</span></div>
<div class="line"><span class="comment">//STEPCAFControl_Writer aWriter (WS, aScratch);</span></div>
<div class="line">STEPCAFControl_Writer aWriter;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// firstly, perform the conversion to STEP entities</span></div>
<div class="line"><span class="keywordflow">if</span> (!aWriter.Transfer (aDoc, aMode))</div>
<div class="line">{</div>
<div class="line">  Message::SendFail() &lt;&lt; <span class="stringliteral">&quot;The document cannot be translated or gives no result&quot;</span>;</div>
<div class="line">  <span class="comment">// abandon .. </span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// writing the File</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* theFilename = ...;</div>
<div class="line">IFSelect_ReturnStatus aStat = aWriter.Write (theFilename);</div>
<div class="line"><span class="keywordflow">if</span> (aStat != IFSelect_RetDone) { .. writing failed .. }</div>
</div><!-- fragment --><h2><a class="anchor" id="occt_xde_2_11_3"></a>
Reading an IGES File</h2>
<p>Use the same procedure as for a STEP file but with <code>IGESCAFControl</code> instead of <code>STEPCAFControl</code>.</p>
<h2><a class="anchor" id="occt_xde_2_11_4"></a>
Writing an IGES File</h2>
<p>Use the same procedure as for a STEP file but with <code>IGESCAFControl</code> instead of <code>STEPCAFControl</code>.</p>
<h1><a class="anchor" id="occt_xde_2_12"></a>
Using an XDE Document</h1>
<p>There are several ways of exploiting XDE data from an application, you can:</p><ol type="1">
<li>Get the data relevant for the application by mapping XDE/Appli, then discard the XDE data once it has been used.</li>
<li>Create a reference from the Application Document to the XDE Document, to have its data available as external data.</li>
<li>Embed XDE data inside the Application Document (see the following section for details).</li>
<li>Directly exploit XDE data such as when using file checkers.</li>
</ol>
<h2><a class="anchor" id="occt_xde_2_12_1"></a>
XDE Data inside an Application Document</h2>
<p>To have XCAF data elsewhere than under label <code>0.1</code>, you use the DocLabel of XDE. The method <code>XCAFDoc_DocumentTool::DocLabel</code> determines the relevant Label for XCAF. However, note that the default is <code>0.1</code>.</p>
<p>In addition, as XDE data is defined and managed in a modular way, you can consider exclusively Assembly Structure, only Colors, and so on.</p>
<p>As XDE provides an extension of the data structure, for relevant data in standardized exchanges, note the following:</p><ul>
<li>This data structure is fitted for data exchange, rather than for use by the final application;</li>
<li>The provided definitions are general, for common use and therefore do not bring strongly specific semantics.</li>
</ul>
<p>As a result, if an application works on Assemblies, on Colors or Layers, on Validation Properties (as defined in STEP), it can rely on all or a part of the XDE definitions, and include them in its own data structure.</p>
<p>In addition, if an application has a data structure far from these notions, it can get data (such as Colors and Names on Shapes) according to its needs, but without having to consider the whole. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Dec 4 2023 13:54:35 for Open CASCADE Technology by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18 </li>
  </ul>
</div>
</body>
</html>
